<div class="dashboard" [class.sidebar-collapsed]="sidebarCollapsed">
  <!-- Sidebar -->
  <nav class="dashboard__sidebar">
    <div class="sidebar__header">
      <a class="sidebar__brand" href="/">
        <img src="/images/logo_test.svg" alt="Cosecha en Cope" width="120">
      </a>
      <button 
        class="sidebar__toggle"
        (click)="toggleSidebar()"
        [attr.aria-label]="sidebarCollapsed ? 'Expandir menú' : 'Contraer menú'">
        <i class="fas" [class.fa-bars]="sidebarCollapsed" [class.fa-times]="!sidebarCollapsed"></i>
      </button>
    </div>

    <div class="sidebar__user" *ngIf="cliente">
      <div class="user__avatar">
        {{ (cliente.nombre || 'C')[0] | uppercase }}
      </div>
      <div class="user__info" *ngIf="!sidebarCollapsed">
        <h3>{{ cliente.nombre || 'Cliente' }}</h3>
        <p>{{ currentUser?.email }}</p>
      </div>
    </div>

    <ul class="sidebar__menu">
      <li>
        <a routerLink="/cliente/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <i class="fas fa-home"></i>
          <span *ngIf="!sidebarCollapsed">Inicio</span>
        </a>
      </li>
      <li>
        <a routerLink="/cliente/perfil" routerLinkActive="active">
          <i class="fas fa-user"></i>
          <span *ngIf="!sidebarCollapsed">Mi Perfil</span>
        </a>
      </li>
      <li>
        <a routerLink="/cliente/pedidos" routerLinkActive="active">
          <i class="fas fa-box"></i>
          <span *ngIf="!sidebarCollapsed">Mis Pedidos</span>
        </a>
      </li>
      <li>
        <a routerLink="/articulos">
          <i class="fas fa-store"></i>
          <span *ngIf="!sidebarCollapsed">Productos</span>
        </a>
      </li>
      <li>
        <a routerLink="/carrito">
          <i class="fas fa-shopping-cart"></i>
          <span *ngIf="!sidebarCollapsed">Mi Carrito</span>
        </a>
      </li>
    </ul>

    <div class="sidebar__footer">
      <button class="btn-logout" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span *ngIf="!sidebarCollapsed">Cerrar Sesión</span>
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="dashboard__main">
    <header class="main__header">
      <div class="header__title">
        <h1>Hola, {{ cliente?.nombre || 'Cliente' }}</h1>
        <p class="subtitle">Bienvenido a tu panel de cliente</p>
      </div>
      <button class="btn btn--primary" routerLink="/articulos">
        Explorar Productos
      </button>
    </header>

    <div class="main__content" *ngIf="!loading; else loadingTemplate">
      
      <!-- Estadísticas -->
      <section class="stats-section" *ngIf="estadisticas">
        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-value">{{ estadisticas.totalPedidos }}</span>
            <span class="stat-label">Pedidos totales</span>
          </div>
          <div class="stat-card">
            <span class="stat-value">{{ estadisticas.pedidosPendientes }}</span>
            <span class="stat-label">En curso</span>
          </div>
          <div class="stat-card">
            <span class="stat-value">{{ estadisticas.pedidosEntregados }}</span>
            <span class="stat-label">Entregados</span>
          </div>
          <div class="stat-card stat-card--highlight">
            <span class="stat-value">{{ estadisticas.totalGastado | number:'1.2-2' }}€</span>
            <span class="stat-label">Total gastado</span>
          </div>
        </div>
      </section>

      <!-- Último Pedido -->
      <section class="last-order" *ngIf="estadisticas?.ultimoPedido as ultimo">
        <div class="section-header">
          <h2>Último pedido</h2>
          <span class="badge" [ngClass]="getEstadoClass(ultimo.estadoPedido)">
            {{ getEstadoLabel(ultimo.estadoPedido) }}
          </span>
        </div>
        <div class="order-summary">
          <div class="order-meta">
            <span class="order-number">#{{ ultimo.idPedido }}</span>
            <span class="order-date">{{ ultimo.fechaPedido | date:'dd MMM yyyy' }}</span>
          </div>
          <div class="order-details">
            <span>{{ ultimo.detalles.length }} artículos</span>
            <span class="order-total">{{ ultimo.total | number:'1.2-2' }}€</span>
          </div>
          <a [routerLink]="['/cliente/pedidos', ultimo.idPedido]" class="btn btn--outline btn--small">
            Ver detalles
          </a>
        </div>
      </section>

      <!-- Accesos Rápidos -->
      <section class="quick-links">
        <h2>Accesos rápidos</h2>
        <div class="links-grid">
          <a routerLink="/articulos" class="link-card">
            <h3>Explorar productos</h3>
            <p>Descubre productos frescos de productores locales</p>
          </a>
          <a routerLink="/cliente/pedidos" class="link-card">
            <h3>Mis pedidos</h3>
            <p>Consulta el historial de tus compras</p>
          </a>
          <a routerLink="/cliente/perfil" class="link-card">
            <h3>Mi perfil</h3>
            <p>Actualiza tus datos de contacto</p>
          </a>
          <a routerLink="/carrito" class="link-card">
            <h3>Mi carrito</h3>
            <p>Revisa los productos añadidos</p>
          </a>
        </div>
      </section>

      <!-- Pedidos Recientes -->
      <section class="recent-orders" *ngIf="pedidosRecientes.length > 0">
        <div class="section-header">
          <h2>Pedidos recientes</h2>
          <a routerLink="/cliente/pedidos" class="link-all">Ver todos</a>
        </div>
        <div class="orders-table">
          <div class="order-row" *ngFor="let pedido of pedidosRecientes">
            <div class="order-info">
              <span class="order-number">#{{ pedido.idPedido }}</span>
              <span class="order-date">{{ pedido.fechaPedido | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="order-items">{{ pedido.detalles.length }} artículos</div>
            <div class="order-amount">{{ pedido.total | number:'1.2-2' }}€</div>
            <span class="badge badge--small" [ngClass]="getEstadoClass(pedido.estadoPedido)">
              {{ getEstadoLabel(pedido.estadoPedido) }}
            </span>
            <a [routerLink]="['/cliente/pedidos', pedido.idPedido]" class="btn btn--text">Ver</a>
          </div>
        </div>
      </section>

      <!-- Sin pedidos -->
      <section class="empty-state" *ngIf="pedidosRecientes.length === 0">
        <h3>Aún no tienes pedidos</h3>
        <p>Explora nuestros productos y realiza tu primera compra</p>
        <button class="btn btn--primary" routerLink="/articulos">
          Ver productos
        </button>
      </section>

    </div>

    <ng-template #loadingTemplate>
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Cargando...</p>
      </div>
    </ng-template>
  </main>
</div>
