<div class="dashboard" [class.sidebar-collapsed]="sidebarCollapsed">
  <!-- Sidebar -->
  <nav class="dashboard__sidebar">
    <div class="sidebar__header">
      <a class="sidebar__brand" href="/">
        <img src="/images/logo_test.svg" alt="Cosecha en Cope" width="120">
      </a>
      <button 
        class="sidebar__toggle"
        (click)="toggleSidebar()"
        [attr.aria-label]="sidebarCollapsed ? 'Expandir menú' : 'Contraer menú'">
        <i class="fas" [class.fa-bars]="sidebarCollapsed" [class.fa-times]="!sidebarCollapsed"></i>
      </button>
    </div>

    <div class="sidebar__user" *ngIf="cliente">
      <div class="user__avatar">
        <i class="fas fa-user-circle"></i>
      </div>
      <div class="user__info" *ngIf="!sidebarCollapsed">
        <h3>{{ cliente.nombre || 'Cliente' }}</h3>
        <p>{{ currentUser?.email }}</p>
      </div>
    </div>

    <ul class="sidebar__menu">
      <li>
        <a routerLink="/cliente/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
          <i class="fas fa-home"></i>
          <span *ngIf="!sidebarCollapsed">Inicio</span>
        </a>
      </li>
      <li>
        <a routerLink="/cliente/perfil" routerLinkActive="active">
          <i class="fas fa-user-edit"></i>
          <span *ngIf="!sidebarCollapsed">Mi Perfil</span>
        </a>
      </li>
      <li>
        <a routerLink="/cliente/pedidos" routerLinkActive="active">
          <i class="fas fa-shopping-bag"></i>
          <span *ngIf="!sidebarCollapsed">Mis Pedidos</span>
        </a>
      </li>
      <li>
        <a routerLink="/articulos">
          <i class="fas fa-store"></i>
          <span *ngIf="!sidebarCollapsed">Productos</span>
        </a>
      </li>
      <li>
        <a routerLink="/carrito">
          <i class="fas fa-shopping-cart"></i>
          <span *ngIf="!sidebarCollapsed">Mi Carrito</span>
        </a>
      </li>
    </ul>

    <div class="sidebar__footer">
      <button class="btn-logout" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span *ngIf="!sidebarCollapsed">Cerrar Sesión</span>
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="dashboard__main">
    <header class="main__header">
      <h1>Mi Panel</h1>
      <div class="header__actions">
        <button class="btn btn--primary" routerLink="/articulos">
          <i class="fas fa-store"></i>
          Explorar Productos
        </button>
      </div>
    </header>

    <div class="main__content" *ngIf="!loading; else loadingTemplate">
      <!-- Estadísticas Cards -->
      <div class="stats-grid" *ngIf="estadisticas">
        <div class="stat-card">
          <div class="stat-card__icon">
            <i class="fas fa-shopping-bag text-blue"></i>
          </div>
          <div class="stat-card__content">
            <h3>{{ estadisticas.totalPedidos }}</h3>
            <p>Total de Pedidos</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card__icon">
            <i class="fas fa-clock text-yellow"></i>
          </div>
          <div class="stat-card__content">
            <h3>{{ estadisticas.pedidosPendientes }}</h3>
            <p>Pedidos en Curso</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card__icon">
            <i class="fas fa-check-circle text-green"></i>
          </div>
          <div class="stat-card__content">
            <h3>{{ estadisticas.pedidosEntregados }}</h3>
            <p>Pedidos Entregados</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-card__icon">
            <i class="fas fa-euro-sign text-purple"></i>
          </div>
          <div class="stat-card__content">
            <h3>€{{ estadisticas.totalGastado | number:'1.2-2' }}</h3>
            <p>Total Gastado</p>
          </div>
        </div>
      </div>

      <!-- Último Pedido Destacado -->
      <div class="featured-order" *ngIf="estadisticas?.ultimoPedido as ultimo">
        <div class="featured-order__header">
          <h2>
            <i class="fas fa-star"></i>
            Último Pedido
          </h2>
          <span class="badge" [ngClass]="getEstadoClass(ultimo.estadoPedido)">
            {{ getEstadoLabel(ultimo.estadoPedido) }}
          </span>
        </div>
        <div class="featured-order__body">
          <div class="order-info">
            <div class="info-item">
              <i class="fas fa-calendar"></i>
              <span>{{ ultimo.fechaPedido | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="info-item">
              <i class="fas fa-hashtag"></i>
              <span>Pedido #{{ ultimo.idPedido }}</span>
            </div>
            <div class="info-item">
              <i class="fas fa-box"></i>
              <span>{{ ultimo.detalles.length }} artículos</span>
            </div>
            <div class="info-item">
              <i class="fas fa-euro-sign"></i>
              <strong>{{ ultimo.total | number:'1.2-2' }}€</strong>
            </div>
          </div>
          <button class="btn btn--outline" [routerLink]="['/cliente/pedidos', ultimo.idPedido]">
            Ver Detalles
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <!-- Acciones Rápidas -->
      <div class="quick-actions">
        <h2>Acciones Rápidas</h2>
        <div class="actions-grid">
          <a routerLink="/articulos" class="action-card">
            <i class="fas fa-shopping-basket"></i>
            <h3>Explorar Productos</h3>
            <p>Descubre productos frescos de productores locales</p>
          </a>

          <a routerLink="/cliente/pedidos" class="action-card">
            <i class="fas fa-history"></i>
            <h3>Ver Mis Pedidos</h3>
            <p>Revisa el historial completo de tus compras</p>
          </a>

          <a routerLink="/cliente/perfil" class="action-card">
            <i class="fas fa-user-cog"></i>
            <h3>Actualizar Perfil</h3>
            <p>Modifica tus datos personales y de contacto</p>
          </a>

          <a routerLink="/carrito" class="action-card">
            <i class="fas fa-shopping-cart"></i>
            <h3>Ver Mi Carrito</h3>
            <p>Revisa los productos que has añadido</p>
          </a>
        </div>
      </div>

      <!-- Pedidos Recientes -->
      <div class="recent-orders" *ngIf="pedidosRecientes.length > 0">
        <div class="section-header">
          <h2>Pedidos Recientes</h2>
          <a routerLink="/cliente/pedidos" class="btn btn--outline">Ver Todos</a>
        </div>
        <div class="orders-list">
          <div class="order-card" *ngFor="let pedido of pedidosRecientes">
            <div class="order-card__header">
              <div class="order-id">
                <i class="fas fa-receipt"></i>
                Pedido #{{ pedido.idPedido }}
              </div>
              <span class="badge" [ngClass]="getEstadoClass(pedido.estadoPedido)">
                {{ getEstadoLabel(pedido.estadoPedido) }}
              </span>
            </div>
            <div class="order-card__body">
              <div class="order-date">
                <i class="fas fa-calendar"></i>
                {{ pedido.fechaPedido | date:'dd/MM/yyyy HH:mm' }}
              </div>
              <div class="order-items">
                <i class="fas fa-box"></i>
                {{ pedido.detalles.length }} artículos
              </div>
              <div class="order-total">
                <strong>{{ pedido.total | number:'1.2-2' }}€</strong>
              </div>
            </div>
            <div class="order-card__footer">
              <button class="btn btn--small btn--outline" [routerLink]="['/cliente/pedidos', pedido.idPedido]">
                Ver Detalles
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Sin pedidos -->
      <div class="no-orders" *ngIf="pedidosRecientes.length === 0">
        <i class="fas fa-shopping-bag"></i>
        <h3>Aún no has realizado ningún pedido</h3>
        <p>¡Explora nuestros productos y haz tu primera compra!</p>
        <button class="btn btn--primary" routerLink="/articulos">
          <i class="fas fa-store"></i>
          Explorar Productos
        </button>
      </div>
    </div>

    <ng-template #loadingTemplate>
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Cargando tu panel...</p>
      </div>
    </ng-template>
  </main>
</div>
