<!-- Modal overlay -->
<div class="modal-overlay" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h2 class="modal-title">
        <i class="bi bi-lock-fill me-2"></i>
        Inicia sesión o regístrate
      </h2>
      <button 
        type="button" 
        class="btn-close" 
        (click)="onClose()"
        aria-label="Cerrar">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <!-- Tabs -->
    <div class="modal-tabs">
      <button 
        type="button"
        class="tab-btn"
        [class.active]="activeTab === 'login'"
        (click)="setTab('login')">
        <i class="bi bi-box-arrow-in-right me-1"></i>
        Iniciar Sesión
      </button>
      <button 
        type="button"
        class="tab-btn"
        [class.active]="activeTab === 'registro'"
        (click)="setTab('registro')">
        <i class="bi bi-person-plus me-1"></i>
        Registrarse
      </button>
    </div>

    <!-- Error global -->
    <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ errorMessage }}
    </div>

    <!-- Tab: Login -->
    <div *ngIf="activeTab === 'login'" class="tab-content">
      <form [formGroup]="loginForm" (ngSubmit)="onLogin()">
        <div class="form-group">
          <label for="login-email" class="form-label">
            Email <span class="text-danger">*</span>
          </label>
          <input 
            type="email" 
            id="login-email"
            class="form-control"
            [class.is-invalid]="loginForm.get('email')?.invalid && loginForm.get('email')?.touched"
            formControlName="email"
            placeholder="tu@email.com"
            autocomplete="email">
          <div class="invalid-feedback">
            {{ getErrorMessage('login', 'email') }}
          </div>
        </div>

        <div class="form-group">
          <label for="login-password" class="form-label">
            Contraseña <span class="text-danger">*</span>
          </label>
          <input 
            type="password" 
            id="login-password"
            class="form-control"
            [class.is-invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched"
            formControlName="password"
            placeholder="••••••••"
            autocomplete="current-password">
          <div class="invalid-feedback">
            {{ getErrorMessage('login', 'password') }}
          </div>
        </div>

        <button 
          type="submit" 
          class="btn btn-primary btn-block"
          [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          <i *ngIf="!loading" class="bi bi-box-arrow-in-right me-2"></i>
          {{ loading ? 'Iniciando sesión...' : 'Iniciar Sesión' }}
        </button>
      </form>

      <p class="text-center mt-3 text-muted">
        ¿No tienes cuenta? 
        <a href="javascript:void(0)" (click)="setTab('registro')" class="text-primary fw-bold">
          Regístrate gratis
        </a>
      </p>
    </div>

    <!-- Tab: Registro -->
    <div *ngIf="activeTab === 'registro'" class="tab-content">
      <p class="text-muted mb-3">
        <i class="bi bi-info-circle me-1"></i>
        Crea tu cuenta gratuita para continuar con tu pedido
      </p>

      <form [formGroup]="registroForm" (ngSubmit)="onRegistro()">
        <div class="form-group">
          <label for="reg-nombre" class="form-label">
            Nombre completo <span class="text-danger">*</span>
          </label>
          <input 
            type="text" 
            id="reg-nombre"
            class="form-control"
            [class.is-invalid]="registroForm.get('nombre')?.invalid && registroForm.get('nombre')?.touched"
            formControlName="nombre"
            placeholder="Juan Pérez"
            autocomplete="name">
          <div class="invalid-feedback">
            {{ getErrorMessage('registro', 'nombre') }}
          </div>
        </div>

        <div class="form-group">
          <label for="reg-email" class="form-label">
            Email <span class="text-danger">*</span>
          </label>
          <input 
            type="email" 
            id="reg-email"
            class="form-control"
            [class.is-invalid]="registroForm.get('email')?.invalid && registroForm.get('email')?.touched"
            formControlName="email"
            placeholder="tu@email.com"
            autocomplete="email">
          <div class="invalid-feedback">
            {{ getErrorMessage('registro', 'email') }}
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="reg-password" class="form-label">
                Contraseña <span class="text-danger">*</span>
              </label>
              <input 
                type="password" 
                id="reg-password"
                class="form-control"
                [class.is-invalid]="registroForm.get('password')?.invalid && registroForm.get('password')?.touched"
                formControlName="password"
                placeholder="••••••••"
                autocomplete="new-password">
              <div class="invalid-feedback">
                {{ getErrorMessage('registro', 'password') }}
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="reg-confirmar" class="form-label">
                Confirmar <span class="text-danger">*</span>
              </label>
              <input 
                type="password" 
                id="reg-confirmar"
                class="form-control"
                [class.is-invalid]="registroForm.get('confirmarPassword')?.invalid && registroForm.get('confirmarPassword')?.touched"
                formControlName="confirmarPassword"
                placeholder="••••••••"
                autocomplete="new-password">
              <div class="invalid-feedback">
                {{ getErrorMessage('registro', 'confirmarPassword') }}
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="reg-telefono" class="form-label">
            Teléfono <span class="text-danger">*</span>
          </label>
          <input 
            type="tel" 
            id="reg-telefono"
            class="form-control"
            [class.is-invalid]="registroForm.get('telefono')?.invalid && registroForm.get('telefono')?.touched"
            formControlName="telefono"
            placeholder="612345678"
            autocomplete="tel">
          <div class="invalid-feedback">
            {{ getErrorMessage('registro', 'telefono') }}
          </div>
        </div>

        <div class="form-group">
          <label for="reg-direccion" class="form-label">
            Dirección de envío <span class="text-danger">*</span>
          </label>
          <textarea 
            id="reg-direccion"
            class="form-control"
            [class.is-invalid]="registroForm.get('direccion')?.invalid && registroForm.get('direccion')?.touched"
            formControlName="direccion"
            placeholder="Calle Principal, 123, Málaga, 29001"
            rows="2"
            autocomplete="street-address"></textarea>
          <div class="invalid-feedback">
            {{ getErrorMessage('registro', 'direccion') }}
          </div>
        </div>

        <div class="form-check mb-3">
          <input 
            type="checkbox" 
            class="form-check-input" 
            id="reg-terminos"
            [class.is-invalid]="registroForm.get('aceptaTerminos')?.invalid && registroForm.get('aceptaTerminos')?.touched"
            formControlName="aceptaTerminos">
          <label class="form-check-label" for="reg-terminos">
            Acepto los <a href="/terminos" target="_blank">términos y condiciones</a> <span class="text-danger">*</span>
          </label>
          <div class="invalid-feedback">
            Debes aceptar los términos
          </div>
        </div>

        <button 
          type="submit" 
          class="btn btn-success btn-block"
          [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          <i *ngIf="!loading" class="bi bi-person-plus me-2"></i>
          {{ loading ? 'Registrando...' : 'Crear Cuenta Gratis' }}
        </button>
      </form>

      <p class="text-center mt-3 text-muted">
        ¿Ya tienes cuenta? 
        <a href="javascript:void(0)" (click)="setTab('login')" class="text-primary fw-bold">
          Inicia sesión
        </a>
      </p>
    </div>

    <!-- Footer info -->
    <div class="modal-footer-info">
      <i class="bi bi-shield-check text-success me-2"></i>
      <small class="text-muted">
        Tus datos están protegidos y seguros
      </small>
    </div>
  </div>
</div>
