"use strict";(self.webpackChunkcosecha_en_cope=self.webpackChunkcosecha_en_cope||[]).push([[677],{5677:(D,g,l)=>{l.r(g),l.d(g,{PerfilProductorComponent:()=>S});var a=l(2615),f=l(2200),c=l(4341),u=l(6176),m=l(980),_=l(9675),b=l(6562),P=l(9330),x=l(1985),v=l(5479);let h=(()=>{class o{http=(0,a.WQX)(P.Qq);getPresignedUrl(e){return this.http.post(v.Sn.UPLOAD.PRESIGNED_URL,e)}uploadToS3(e,r){return this.http.put(r,e,{headers:{"Content-Type":e.type}})}uploadFile(e,r="general"){return new x.c(t=>{this.getPresignedUrl({fileName:e.name,fileType:e.type,folder:r}).subscribe({next:s=>{this.uploadToS3(e,s.uploadUrl).subscribe({next:()=>{t.next({url:s.fileUrl,key:s.key}),t.complete()},error:p=>t.error(p)})},error:s=>t.error(s)})})}validateImageFile(e){return["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?e.size>5242880?{valid:!1,error:"La imagen no puede superar los 5MB"}:{valid:!0}:{valid:!1,error:"Solo se permiten im\xe1genes (JPEG, PNG, WebP)"}}static \u0275fac=function(r){return new(r||o)};static \u0275prov=a.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var n=l(3664);function C(o,d){1&o&&(n.j41(0,"div",33),n.nrm(1,"div",34),n.j41(2,"p"),n.EFF(3,"Subiendo imagen..."),n.k0s()())}function M(o,d){1&o&&(n.j41(0,"span"),n.EFF(1,"El nombre es obligatorio"),n.k0s())}function O(o,d){1&o&&(n.j41(0,"span"),n.EFF(1,"El nombre debe tener al menos 2 caracteres"),n.k0s())}function F(o,d){if(1&o&&(n.j41(0,"div",35),n.DNE(1,M,2,0,"span",36)(2,O,2,0,"span",36),n.k0s()),2&o){let e,r;const t=n.XpG(2);n.R7$(),n.Y8G("ngIf",null==(e=t.form.get("nombre"))||null==e.errors?null:e.errors.required),n.R7$(),n.Y8G("ngIf",null==(r=t.form.get("nombre"))||null==r.errors?null:r.errors.minlength)}}function k(o,d){1&o&&(n.j41(0,"span"),n.EFF(1,"La direcci\xf3n es obligatoria"),n.k0s())}function E(o,d){if(1&o&&(n.j41(0,"div",35),n.DNE(1,k,2,0,"span",36),n.k0s()),2&o){let e;const r=n.XpG(2);n.R7$(),n.Y8G("ngIf",null==(e=r.form.get("direccion"))||null==e.errors?null:e.errors.required)}}function j(o,d){1&o&&(n.j41(0,"span"),n.EFF(1,"El tel\xe9fono es obligatorio"),n.k0s())}function y(o,d){1&o&&(n.j41(0,"span"),n.EFF(1,"Introduce un tel\xe9fono v\xe1lido (9 d\xedgitos)"),n.k0s())}function I(o,d){if(1&o&&(n.j41(0,"div",35),n.DNE(1,j,2,0,"span",36)(2,y,2,0,"span",36),n.k0s()),2&o){let e,r;const t=n.XpG(2);n.R7$(),n.Y8G("ngIf",null==(e=t.form.get("telefono"))||null==e.errors?null:e.errors.required),n.R7$(),n.Y8G("ngIf",null==(r=t.form.get("telefono"))||null==r.errors?null:r.errors.pattern)}}function w(o,d){if(1&o&&(n.j41(0,"div",8)(1,"h2"),n.EFF(2,"Informaci\xf3n de la Cuenta"),n.k0s(),n.j41(3,"div",37)(4,"div",38)(5,"label"),n.EFF(6,"Email de la cuenta"),n.k0s(),n.j41(7,"p"),n.EFF(8),n.k0s()(),n.j41(9,"div",38)(10,"label"),n.EFF(11,"Fecha de registro"),n.k0s(),n.j41(12,"p"),n.EFF(13),n.nI1(14,"date"),n.k0s()(),n.j41(15,"div",38)(16,"label"),n.EFF(17,"Tipo de usuario"),n.k0s(),n.j41(18,"span",39),n.EFF(19),n.k0s()(),n.j41(20,"div",38)(21,"label"),n.EFF(22,"ID del productor"),n.k0s(),n.j41(23,"p"),n.EFF(24),n.k0s()()()()),2&o){const e=n.XpG(2);n.R7$(8),n.JRh(null==e.currentUser?null:e.currentUser.email),n.R7$(5),n.JRh(n.i5U(14,4,e.productor.fechaRegistro,"dd/MM/yyyy")),n.R7$(6),n.JRh(null==e.currentUser?null:e.currentUser.tipoUsuario),n.R7$(5),n.SpI("#",e.productor.idProductor)}}function U(o,d){1&o&&n.nrm(0,"i",40)}function R(o,d){1&o&&n.nrm(0,"div",41)}function G(o,d){if(1&o){const e=n.RV6();n.j41(0,"div",6)(1,"form",7),n.bIt("ngSubmit",function(){a.eBV(e);const t=n.XpG();return a.Njj(t.onSubmit())}),n.j41(2,"div",8)(3,"h2"),n.EFF(4,"Imagen de la Empresa"),n.k0s(),n.j41(5,"div",9)(6,"div",10),n.nrm(7,"img",11),n.DNE(8,C,4,0,"div",12),n.k0s(),n.j41(9,"div",13)(10,"input",14),n.bIt("change",function(t){a.eBV(e);const i=n.XpG();return a.Njj(i.onFileSelected(t))}),n.k0s(),n.j41(11,"label",15),n.nrm(12,"i",16),n.EFF(13," Cambiar Imagen "),n.k0s(),n.j41(14,"p",17),n.EFF(15," Formatos permitidos: JPG, PNG, WebP. M\xe1ximo 5MB. "),n.k0s()()()(),n.j41(16,"div",8)(17,"h2"),n.EFF(18,"Informaci\xf3n de la Empresa"),n.k0s(),n.j41(19,"div",18)(20,"div",19)(21,"label",20),n.EFF(22,"Nombre de la Empresa *"),n.k0s(),n.nrm(23,"input",21),n.DNE(24,F,3,2,"div",22),n.k0s()(),n.j41(25,"div",18)(26,"div",19)(27,"label",23),n.EFF(28,"Direcci\xf3n *"),n.k0s(),n.nrm(29,"textarea",24),n.DNE(30,E,2,1,"div",22),n.k0s()(),n.j41(31,"div",18)(32,"div",19)(33,"label",25),n.EFF(34,"Tel\xe9fono de Contacto *"),n.k0s(),n.nrm(35,"input",26),n.DNE(36,I,3,2,"div",22),n.k0s()()(),n.DNE(37,w,25,7,"div",27),n.j41(38,"div",28)(39,"button",29),n.bIt("click",function(){a.eBV(e);const t=n.XpG();return a.Njj(t.goBack())}),n.EFF(40," Cancelar "),n.k0s(),n.j41(41,"button",30),n.DNE(42,U,1,0,"i",31)(43,R,1,0,"div",32),n.EFF(44),n.k0s()()()()}if(2&o){let e,r,t;const i=n.XpG();n.R7$(),n.Y8G("formGroup",i.form),n.R7$(6),n.Y8G("src",i.imagePreview||"/images/default-producer.png",n.B4B),n.R7$(),n.Y8G("ngIf",i.uploading),n.R7$(16),n.Y8G("ngIf",(null==(e=i.form.get("nombre"))?null:e.touched)&&(null==(e=i.form.get("nombre"))?null:e.errors)),n.R7$(6),n.Y8G("ngIf",(null==(r=i.form.get("direccion"))?null:r.touched)&&(null==(r=i.form.get("direccion"))?null:r.errors)),n.R7$(6),n.Y8G("ngIf",(null==(t=i.form.get("telefono"))?null:t.touched)&&(null==(t=i.form.get("telefono"))?null:t.errors)),n.R7$(),n.Y8G("ngIf",i.productor),n.R7$(4),n.Y8G("disabled",i.form.invalid||i.saving||i.uploading),n.R7$(),n.Y8G("ngIf",!i.saving),n.R7$(),n.Y8G("ngIf",i.saving),n.R7$(),n.SpI(" ",i.saving?"Guardando...":"Guardar Cambios"," ")}}function T(o,d){1&o&&(n.j41(0,"div",42),n.nrm(1,"div",34),n.j41(2,"p"),n.EFF(3,"Cargando perfil..."),n.k0s()())}let S=(()=>{class o{fb=(0,a.WQX)(c.ok);userStore=(0,a.WQX)(_.w);productorService=(0,a.WQX)(b.o);uploadService=(0,a.WQX)(h);router=(0,a.WQX)(u.Ix);productor=null;loading=!0;saving=!1;uploading=!1;imagePreview=null;currentUser=this.userStore.snapshot();form=this.fb.nonNullable.group({nombre:["",[c.k0.required,c.k0.minLength(2)]],direccion:["",[c.k0.required]],telefono:["",[c.k0.required,c.k0.pattern(/^[0-9]{9}$/)]],imagenUrl:[""]});ngOnInit(){this.currentUser&&"PRODUCTOR"===this.currentUser.tipoUsuario?this.loadProductor():this.router.navigateByUrl("/login/productores")}loadProductor(){this.currentUser&&this.productorService.getProductorPorUsuario(this.currentUser.idUsuario).subscribe({next:e=>{this.productor=e,this.form.patchValue({nombre:e.nombre,direccion:e.direccion,telefono:e.telefono,imagenUrl:e.imagenUrl}),this.imagePreview=e.imagenUrl,this.loading=!1},error:()=>{this.loading=!1}})}onFileSelected(e){const t=e.target.files?.[0];if(!t)return;const i=this.uploadService.validateImageFile(t);if(!i.valid)return void alert(i.error);const s=new FileReader;s.onload=p=>{this.imagePreview=p.target?.result},s.readAsDataURL(t),this.uploading=!0,this.uploadService.uploadFile(t,"productores").subscribe({next:p=>{this.form.patchValue({imagenUrl:p.url}),this.uploading=!1},error:p=>{console.error("Error uploading image:",p),alert("Error al subir la imagen. Int\xe9ntalo de nuevo."),this.uploading=!1,this.imagePreview=this.form.value.imagenUrl||null}})}onSubmit(){if(this.form.invalid||!this.productor)return;this.saving=!0;const e=this.form.getRawValue();this.productorService.updateProductor(this.productor.idProductor,{idUsuario:this.currentUser.idUsuario,nombre:e.nombre,direccion:e.direccion,telefono:e.telefono,imagenUrl:e.imagenUrl}).pipe((0,m.j)(()=>this.saving=!1)).subscribe({next:t=>{this.productor=t,alert("Perfil actualizado correctamente")},error:t=>{console.error("Error updating profile:",t),alert("Error al actualizar el perfil. Int\xe9ntalo de nuevo.")}})}goBack(){this.router.navigateByUrl("/productor/dashboard")}static \u0275fac=function(r){return new(r||o)};static \u0275cmp=n.VBU({type:o,selectors:[["app-perfil-productor"]],decls:10,vars:2,consts:[["loadingTemplate",""],[1,"perfil-container"],[1,"perfil-header"],[1,"btn-back",3,"click"],[1,"fas","fa-arrow-left"],["class","perfil-content",4,"ngIf","ngIfElse"],[1,"perfil-content"],[1,"perfil-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"image-upload-container"],[1,"image-preview"],["alt","Vista previa",1,"preview-image",3,"src"],["class","upload-overlay",4,"ngIf"],[1,"upload-controls"],["type","file","id","imageInput","accept","image/*",1,"file-input",3,"change"],["for","imageInput",1,"btn","btn--outline"],[1,"fas","fa-camera"],[1,"upload-hint"],[1,"form-row"],[1,"form-group"],["for","nombre"],["type","text","id","nombre","formControlName","nombre","placeholder","Ej: Huerta Los Olivos",1,"form-control"],["class","field-error",4,"ngIf"],["for","direccion"],["id","direccion","formControlName","direccion","rows","3","placeholder","Direcci\xf3n completa de la empresa o finca",1,"form-control"],["for","telefono"],["type","tel","id","telefono","formControlName","telefono","placeholder","123456789",1,"form-control"],["class","form-section",4,"ngIf"],[1,"form-actions"],["type","button",1,"btn","btn--outline",3,"click"],["type","submit",1,"btn","btn--primary",3,"disabled"],["class","fas fa-save",4,"ngIf"],["class","button-spinner",4,"ngIf"],[1,"upload-overlay"],[1,"spinner"],[1,"field-error"],[4,"ngIf"],[1,"info-grid"],[1,"info-item"],[1,"badge","badge--green"],[1,"fas","fa-save"],[1,"button-spinner"],[1,"loading-container"]],template:function(r,t){if(1&r){const i=n.RV6();n.j41(0,"div",1)(1,"div",2)(2,"button",3),n.bIt("click",function(){return a.eBV(i),a.Njj(t.goBack())}),n.nrm(3,"i",4),n.EFF(4," Volver al Dashboard "),n.k0s(),n.j41(5,"h1"),n.EFF(6,"Mi Perfil de Productor"),n.k0s()(),n.DNE(7,G,45,11,"div",5)(8,T,4,0,"ng-template",null,0,n.C5r),n.k0s()}if(2&r){const i=n.sdS(9);n.R7$(7),n.Y8G("ngIf",!t.loading)("ngIfElse",i)}},dependencies:[f.MD,f.bT,c.X1,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,f.vh],styles:[".perfil-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#f8fafc;padding:20px}.perfil-header[_ngcontent-%COMP%]{margin-bottom:30px}.perfil-header[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]{background:none;border:none;color:#64748b;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:8px;margin-bottom:15px;padding:8px 0;transition:color .3s ease}.perfil-header[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]:hover{color:#4caf50}.perfil-header[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.perfil-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#1a202c;margin:0}.perfil-content[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.perfil-form[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000001a;overflow:hidden}.form-section[_ngcontent-%COMP%]{padding:30px;border-bottom:1px solid #e2e8f0}.form-section[_ngcontent-%COMP%]:last-child{border-bottom:none}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#1a202c;margin:0 0 25px;padding-bottom:10px;border-bottom:2px solid #4caf50;display:inline-block}.image-upload-container[_ngcontent-%COMP%]{display:flex;gap:30px;align-items:flex-start}@media (max-width: 768px){.image-upload-container[_ngcontent-%COMP%]{flex-direction:column;gap:20px}}.image-preview[_ngcontent-%COMP%]{position:relative;width:200px;height:200px;border-radius:12px;overflow:hidden;border:3px solid #e2e8f0;background-color:#f8fafc}.image-preview[_ngcontent-%COMP%]   .preview-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.image-preview[_ngcontent-%COMP%]   .upload-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#000000b3;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff}.image-preview[_ngcontent-%COMP%]   .upload-overlay[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:30px;height:30px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:10px}.image-preview[_ngcontent-%COMP%]   .upload-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;margin:0}.upload-controls[_ngcontent-%COMP%]{flex:1}.upload-controls[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{display:none}.upload-controls[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;cursor:pointer;margin-bottom:15px}.upload-controls[_ngcontent-%COMP%]   .upload-hint[_ngcontent-%COMP%]{font-size:14px;color:#64748b;margin:0;line-height:1.4}.form-row[_ngcontent-%COMP%]{margin-bottom:25px}.form-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:600;color:#374151;margin-bottom:8px}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:2px solid #e2e8f0;border-radius:8px;font-size:16px;transition:all .3s ease;background-color:#fff}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#4caf50;box-shadow:0 0 0 3px #4caf501a}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.form-group[_ngcontent-%COMP%]   .form-control.error[_ngcontent-%COMP%]{border-color:#ef4444}.form-group[_ngcontent-%COMP%]   .form-control.error[_ngcontent-%COMP%]:focus{border-color:#ef4444;box-shadow:0 0 0 3px #ef44441a}.form-group[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:100px;font-family:inherit}.field-error[_ngcontent-%COMP%]{margin-top:8px;font-size:14px;color:#ef4444;font-weight:500}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:600;color:#64748b;margin-bottom:5px}.info-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#1a202c;margin:0;font-weight:500}.badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:6px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.badge--green[_ngcontent-%COMP%]{background-color:#d1fae5;color:#065f46}.form-actions[_ngcontent-%COMP%]{padding:25px 30px;background-color:#f8fafc;display:flex;gap:15px;justify-content:flex-end}@media (max-width: 768px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}}.btn[_ngcontent-%COMP%]{padding:12px 24px;border-radius:8px;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;gap:8px;border:none;cursor:pointer;transition:all .3s ease;justify-content:center;min-width:120px}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn--primary[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.btn--primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#45a049;transform:translateY(-1px)}.btn--outline[_ngcontent-%COMP%]{background:transparent;color:#4caf50;border:2px solid #4caf50}.btn--outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#4caf50;color:#fff}.button-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px}.loading-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid #e2e8f0;border-top:3px solid #4caf50;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#64748b;font-size:16px;margin:0}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.perfil-container[_ngcontent-%COMP%]{padding:15px}.perfil-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:28px}.form-section[_ngcontent-%COMP%], .form-actions[_ngcontent-%COMP%]{padding:20px}.info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}return o})()}}]);