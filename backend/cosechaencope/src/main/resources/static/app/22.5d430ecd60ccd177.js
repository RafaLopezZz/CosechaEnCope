"use strict";(self.webpackChunkcosecha_en_cope=self.webpackChunkcosecha_en_cope||[]).push([[22],{3022:(ke,O,p)=>{p.r(O),p.d(O,{CheckoutPageComponent:()=>Ce});var a=p(2615),f=p(2200),P=p(6802),R=p(1413),E=p(6977),k=p(8685),y=p(6334),x=p(9675),u=p(8234),r=p(9417),e=p(3664);function w(n,s){if(1&n&&(e.j41(0,"p",28),e.nrm(1,"i",29),e.EFF(2),e.k0s()),2&n){const o=e.XpG().$implicit;e.R7$(2),e.SpI(" Solo ",o.stockDisponible," disponibles ")}}function I(n,s){if(1&n){const o=e.RV6();e.j41(0,"div",14)(1,"div",15),e.nrm(2,"img",16),e.k0s(),e.j41(3,"div",17)(4,"h3",18),e.EFF(5),e.k0s(),e.j41(6,"p",19),e.EFF(7),e.nI1(8,"currency"),e.k0s(),e.j41(9,"div",20)(10,"button",21),e.bIt("click",function(){const t=a.eBV(o).$implicit,c=e.XpG();return a.Njj(c.decrementarItem(t.idArticulo))}),e.nrm(11,"i",22),e.k0s(),e.j41(12,"span",23),e.EFF(13),e.k0s(),e.j41(14,"button",24),e.bIt("click",function(){const t=a.eBV(o).$implicit,c=e.XpG();return a.Njj(c.incrementarItem(t.idArticulo))}),e.nrm(15,"i",25),e.k0s()(),e.DNE(16,w,3,1,"p",26),e.k0s(),e.j41(17,"div",27)(18,"strong"),e.EFF(19),e.nI1(20,"currency"),e.k0s()()()}if(2&n){const o=s.$implicit,i=e.XpG();e.AVh("updating",i.isUpdating),e.R7$(2),e.Y8G("src",o.imagenUrl||"/assets/placeholder-product.jpg",e.B4B)("alt",o.nombreArticulo),e.R7$(3),e.JRh(o.nombreArticulo),e.R7$(2),e.SpI("",e.ii3(8,11,o.precioUnitario,"EUR","symbol","1.2-2")," / unidad"),e.R7$(3),e.Y8G("disabled",i.isUpdating),e.R7$(3),e.SpI(" ",o.cantidad," "),e.R7$(),e.Y8G("disabled",i.isUpdating||void 0!==o.stockDisponible&&o.cantidad>=o.stockDisponible),e.R7$(2),e.Y8G("ngIf",void 0!==o.stockDisponible&&o.stockDisponible<10),e.R7$(3),e.JRh(e.ii3(20,16,o.totalLinea,"EUR","symbol","1.2-2"))}}function S(n,s){1&n&&(e.j41(0,"div",30),e.nrm(1,"i",31),e.EFF(2," \xa1Env\xedo gratuito en tu pedido! "),e.k0s())}function T(n,s){if(1&n&&(e.j41(0,"div",30),e.nrm(1,"i",32),e.EFF(2),e.nI1(3,"currency"),e.k0s()),2&n){const o=e.XpG();e.R7$(2),e.SpI(" A\xf1ade ",e.ii3(3,1,50-o.carrito.subtotal,"EUR","symbol","1.2-2")," m\xe1s para env\xedo gratis ")}}let $=(()=>{class n{carrito;carritoService=(0,a.WQX)(y.a);pedidoService=(0,a.WQX)(k.H);isUpdating=!1;decrementarItem(o){this.isUpdating=!0,this.carritoService.decrementarItem(o).subscribe({next:i=>{this.carrito=i,this.isUpdating=!1},error:i=>{console.error("Error al decrementar item:",i),this.isUpdating=!1,alert("Error al actualizar el carrito")}})}incrementarItem(o){this.isUpdating=!0,this.carritoService.agregarItem(o,1).subscribe({next:i=>{i&&(this.carrito=i),this.isUpdating=!1},error:i=>{console.error("Error al incrementar item:",i),this.isUpdating=!1,alert(i.error?.message||"Error al actualizar el carrito")}})}continuar(){0!==this.carrito.items.length?this.pedidoService.avanzarPaso(u.b8.DATOS):alert("El carrito est\xe1 vac\xedo")}getTotalItems(){return this.carrito.items.reduce((o,i)=>o+i.cantidad,0)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.VBU({type:n,selectors:[["app-checkout-summary"]],inputs:{carrito:"carrito"},decls:39,vars:32,consts:[[1,"checkout-summary"],[1,"summary-card"],[1,"section-title"],[1,"bi","bi-cart-check","me-2"],[1,"items-count"],[1,"items-list"],["class","cart-item",3,"updating",4,"ngFor","ngForOf"],[1,"cart-totals"],[1,"total-row"],[1,"total-row","total-final"],[1,"total-amount"],["class","shipping-note",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-lg","w-100","btn-continue",3,"click","disabled"],[1,"bi","bi-arrow-right","ms-2"],[1,"cart-item"],[1,"item-image"],["loading","lazy",3,"src","alt"],[1,"item-info"],[1,"item-name"],[1,"item-price"],[1,"quantity-controls"],["type","button","aria-label","Disminuir cantidad",1,"btn-quantity","btn-decrement",3,"click","disabled"],[1,"bi","bi-dash"],["aria-live","polite",1,"quantity-display"],["type","button","aria-label","Aumentar cantidad",1,"btn-quantity","btn-increment",3,"click","disabled"],[1,"bi","bi-plus"],["class","stock-warning",4,"ngIf"],[1,"item-total"],[1,"stock-warning"],[1,"bi","bi-exclamation-triangle-fill"],[1,"shipping-note"],[1,"bi","bi-check-circle-fill","text-success"],[1,"bi","bi-info-circle-fill","text-info"]],template:function(i,t){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.nrm(3,"i",3),e.EFF(4," Resumen de tu pedido "),e.k0s(),e.j41(5,"div",4),e.EFF(6),e.k0s(),e.j41(7,"div",5),e.DNE(8,I,21,21,"div",6),e.k0s(),e.j41(9,"div",7)(10,"div",8)(11,"span"),e.EFF(12,"Subtotal:"),e.k0s(),e.j41(13,"span"),e.EFF(14),e.nI1(15,"currency"),e.k0s()(),e.j41(16,"div",8)(17,"span"),e.EFF(18,"IVA (21%):"),e.k0s(),e.j41(19,"span"),e.EFF(20),e.nI1(21,"currency"),e.k0s()(),e.j41(22,"div",8)(23,"span"),e.EFF(24,"Gastos de env\xedo:"),e.k0s(),e.j41(25,"span"),e.EFF(26),e.nI1(27,"currency"),e.k0s()(),e.j41(28,"div",9)(29,"strong"),e.EFF(30,"Total:"),e.k0s(),e.j41(31,"strong",10),e.EFF(32),e.nI1(33,"currency"),e.k0s()()(),e.DNE(34,S,3,0,"div",11)(35,T,4,6,"div",11),e.j41(36,"button",12),e.bIt("click",function(){return t.continuar()}),e.EFF(37," Continuar con el pedido "),e.nrm(38,"i",13),e.k0s()()()),2&i&&(e.R7$(6),e.Lme(" ",t.getTotalItems()," ",1===t.getTotalItems()?"art\xedculo":"art\xedculos"," "),e.R7$(2),e.Y8G("ngForOf",t.carrito.items),e.R7$(6),e.JRh(e.ii3(15,12,t.carrito.subtotal,"EUR","symbol","1.2-2")),e.R7$(6),e.JRh(e.ii3(21,17,t.carrito.impuestos,"EUR","symbol","1.2-2")),e.R7$(5),e.AVh("free-shipping",0===t.carrito.gastosEnvio),e.R7$(),e.SpI(" ",0===t.carrito.gastosEnvio?"GRATIS":e.ii3(27,22,t.carrito.gastosEnvio,"EUR","symbol","1.2-2")," "),e.R7$(6),e.JRh(e.ii3(33,27,t.carrito.total,"EUR","symbol","1.2-2")),e.R7$(2),e.Y8G("ngIf",0===t.carrito.gastosEnvio),e.R7$(),e.Y8G("ngIf",t.carrito.gastosEnvio>0&&t.carrito.subtotal<50),e.R7$(),e.Y8G("disabled",t.isUpdating||0===t.carrito.items.length))},dependencies:[f.MD,f.Sq,f.bT,r.YN,f.oe],styles:[".checkout-summary[_ngcontent-%COMP%]{max-width:100%}.summary-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:1.5rem;box-shadow:0 4px 6px #00000012}@media (max-width: 768px){.summary-card[_ngcontent-%COMP%]{padding:1rem;border-radius:.375rem}}.section-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin:0 0 .5rem;color:#212529;display:flex;align-items:center}@media (max-width: 768px){.section-title[_ngcontent-%COMP%]{font-size:1.25rem}}.items-count[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid #dee2e6}.items-list[_ngcontent-%COMP%]{margin-bottom:1.5rem}.cart-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:80px 1fr auto;gap:1rem;padding:1rem 0;border-bottom:1px solid #f1f3f5;transition:opacity .3s ease}.cart-item.updating[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.cart-item[_ngcontent-%COMP%]:last-child{border-bottom:none}@media (max-width: 576px){.cart-item[_ngcontent-%COMP%]{grid-template-columns:60px 1fr;gap:.75rem}}.item-image[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:.375rem;overflow:hidden;background-color:#f8f9fa}.item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}@media (max-width: 576px){.item-image[_ngcontent-%COMP%]{width:60px;height:60px}}.item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;min-width:0}.item-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;margin:0;color:#212529;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@media (max-width: 576px){.item-name[_ngcontent-%COMP%]{font-size:.9375rem}}.item-price[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d;margin:0}.quantity-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.25rem}.btn-quantity[_ngcontent-%COMP%]{width:32px;height:32px;border:1px solid #dee2e6;background:#fff;border-radius:.25rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.btn-quantity[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f8f9fa;border-color:#0d6efd}.btn-quantity[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-quantity[_ngcontent-%COMP%]:focus{outline:2px solid #0d6efd;outline-offset:2px}.btn-quantity[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.quantity-display[_ngcontent-%COMP%]{min-width:32px;text-align:center;font-weight:500;font-size:1rem}.stock-warning[_ngcontent-%COMP%]{font-size:.8125rem;color:#dc3545;margin:0;display:flex;align-items:center;gap:.25rem}.stock-warning[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.item-total[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;font-size:1.125rem;color:#212529}@media (max-width: 576px){.item-total[_ngcontent-%COMP%]{grid-column:2/3;justify-content:flex-start;font-size:1rem}}.cart-totals[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:1rem;border-radius:.375rem;margin-bottom:1rem}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0;font-size:.9375rem;color:#495057}.total-row[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #dee2e6}.total-row.total-final[_ngcontent-%COMP%]{padding-top:.75rem;font-size:1.125rem;color:#212529}.total-row.total-final[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{color:#0d6efd;font-size:1.5rem}.free-shipping[_ngcontent-%COMP%]{color:#28a745;font-weight:600}.shipping-note[_ngcontent-%COMP%]{background-color:#f8f9fa;border-left:3px solid #28a745;padding:.75rem 1rem;margin-bottom:1rem;font-size:.875rem;display:flex;align-items:center;gap:.5rem;border-radius:.25rem}.shipping-note[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.btn-continue[_ngcontent-%COMP%]{margin-top:1rem;display:flex;align-items:center;justify-content:center;gap:.5rem;font-weight:600;padding:.875rem 1.5rem;transition:all .2s ease}.btn-continue[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #0d6efd4d}.btn-continue[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})}return n})();var A=p(4730),G=p(8132),z=p(8010),j=p(980);function N(n,s){if(1&n&&(e.j41(0,"div",16),e.nrm(1,"i",17),e.EFF(2),e.k0s()),2&n){const o=e.XpG();e.R7$(2),e.SpI(" ",o.errorMessage," ")}}function D(n,s){1&n&&e.nrm(0,"span",32)}function V(n,s){1&n&&e.nrm(0,"i",33)}function Y(n,s){if(1&n){const o=e.RV6();e.j41(0,"div",18)(1,"form",19),e.bIt("ngSubmit",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.onLogin())}),e.j41(2,"div",20)(3,"label",21),e.EFF(4," Email "),e.j41(5,"span",22),e.EFF(6,"*"),e.k0s()(),e.nrm(7,"input",23),e.j41(8,"div",24),e.EFF(9),e.k0s()(),e.j41(10,"div",20)(11,"label",25),e.EFF(12," Contrase\xf1a "),e.j41(13,"span",22),e.EFF(14,"*"),e.k0s()(),e.nrm(15,"input",26),e.j41(16,"div",24),e.EFF(17),e.k0s()(),e.j41(18,"button",27),e.DNE(19,D,1,0,"span",28)(20,V,1,0,"i",29),e.EFF(21),e.k0s()(),e.j41(22,"p",30),e.EFF(23," \xbfNo tienes cuenta? "),e.j41(24,"a",31),e.bIt("click",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.setTab("registro"))}),e.EFF(25," Reg\xedstrate gratis "),e.k0s()()()}if(2&n){let o,i;const t=e.XpG();e.R7$(),e.Y8G("formGroup",t.loginForm),e.R7$(6),e.AVh("is-invalid",(null==(o=t.loginForm.get("email"))?null:o.invalid)&&(null==(o=t.loginForm.get("email"))?null:o.touched)),e.R7$(2),e.SpI(" ",t.getErrorMessage("login","email")," "),e.R7$(6),e.AVh("is-invalid",(null==(i=t.loginForm.get("password"))?null:i.invalid)&&(null==(i=t.loginForm.get("password"))?null:i.touched)),e.R7$(2),e.SpI(" ",t.getErrorMessage("login","password")," "),e.R7$(),e.Y8G("disabled",t.loading),e.R7$(),e.Y8G("ngIf",t.loading),e.R7$(),e.Y8G("ngIf",!t.loading),e.R7$(),e.SpI(" ",t.loading?"Iniciando sesi\xf3n...":"Iniciar Sesi\xf3n"," ")}}function U(n,s){1&n&&e.nrm(0,"span",32)}function X(n,s){1&n&&e.nrm(0,"i",56)}function B(n,s){if(1&n){const o=e.RV6();e.j41(0,"div",18)(1,"p",34),e.nrm(2,"i",35),e.EFF(3," Crea tu cuenta gratuita para continuar con tu pedido "),e.k0s(),e.j41(4,"form",19),e.bIt("ngSubmit",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.onRegistro())}),e.j41(5,"div",20)(6,"label",36),e.EFF(7," Nombre completo "),e.j41(8,"span",22),e.EFF(9,"*"),e.k0s()(),e.nrm(10,"input",37),e.j41(11,"div",24),e.EFF(12),e.k0s()(),e.j41(13,"div",20)(14,"label",38),e.EFF(15," Email "),e.j41(16,"span",22),e.EFF(17,"*"),e.k0s()(),e.nrm(18,"input",39),e.j41(19,"div",24),e.EFF(20),e.k0s()(),e.j41(21,"div",40)(22,"div",41)(23,"div",20)(24,"label",42),e.EFF(25," Contrase\xf1a "),e.j41(26,"span",22),e.EFF(27,"*"),e.k0s()(),e.nrm(28,"input",43),e.j41(29,"div",24),e.EFF(30),e.k0s()()(),e.j41(31,"div",41)(32,"div",20)(33,"label",44),e.EFF(34," Confirmar "),e.j41(35,"span",22),e.EFF(36,"*"),e.k0s()(),e.nrm(37,"input",45),e.j41(38,"div",24),e.EFF(39),e.k0s()()()(),e.j41(40,"div",20)(41,"label",46),e.EFF(42," Tel\xe9fono "),e.j41(43,"span",22),e.EFF(44,"*"),e.k0s()(),e.nrm(45,"input",47),e.j41(46,"div",24),e.EFF(47),e.k0s()(),e.j41(48,"div",20)(49,"label",48),e.EFF(50," Direcci\xf3n de env\xedo "),e.j41(51,"span",22),e.EFF(52,"*"),e.k0s()(),e.nrm(53,"textarea",49),e.j41(54,"div",24),e.EFF(55),e.k0s()(),e.j41(56,"div",50),e.nrm(57,"input",51),e.j41(58,"label",52),e.EFF(59," Acepto los "),e.j41(60,"a",53),e.EFF(61,"t\xe9rminos y condiciones"),e.k0s(),e.j41(62,"span",22),e.EFF(63,"*"),e.k0s()(),e.j41(64,"div",24),e.EFF(65," Debes aceptar los t\xe9rminos "),e.k0s()(),e.j41(66,"button",54),e.DNE(67,U,1,0,"span",28)(68,X,1,0,"i",55),e.EFF(69),e.k0s()(),e.j41(70,"p",30),e.EFF(71," \xbfYa tienes cuenta? "),e.j41(72,"a",31),e.bIt("click",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.setTab("login"))}),e.EFF(73," Inicia sesi\xf3n "),e.k0s()()()}if(2&n){let o,i,t,c,g,b,m;const l=e.XpG();e.R7$(4),e.Y8G("formGroup",l.registroForm),e.R7$(6),e.AVh("is-invalid",(null==(o=l.registroForm.get("nombre"))?null:o.invalid)&&(null==(o=l.registroForm.get("nombre"))?null:o.touched)),e.R7$(2),e.SpI(" ",l.getErrorMessage("registro","nombre")," "),e.R7$(6),e.AVh("is-invalid",(null==(i=l.registroForm.get("email"))?null:i.invalid)&&(null==(i=l.registroForm.get("email"))?null:i.touched)),e.R7$(2),e.SpI(" ",l.getErrorMessage("registro","email")," "),e.R7$(8),e.AVh("is-invalid",(null==(t=l.registroForm.get("password"))?null:t.invalid)&&(null==(t=l.registroForm.get("password"))?null:t.touched)),e.R7$(2),e.SpI(" ",l.getErrorMessage("registro","password")," "),e.R7$(7),e.AVh("is-invalid",(null==(c=l.registroForm.get("confirmarPassword"))?null:c.invalid)&&(null==(c=l.registroForm.get("confirmarPassword"))?null:c.touched)),e.R7$(2),e.SpI(" ",l.getErrorMessage("registro","confirmarPassword")," "),e.R7$(6),e.AVh("is-invalid",(null==(g=l.registroForm.get("telefono"))?null:g.invalid)&&(null==(g=l.registroForm.get("telefono"))?null:g.touched)),e.R7$(2),e.SpI(" ",l.getErrorMessage("registro","telefono")," "),e.R7$(6),e.AVh("is-invalid",(null==(b=l.registroForm.get("direccion"))?null:b.invalid)&&(null==(b=l.registroForm.get("direccion"))?null:b.touched)),e.R7$(2),e.SpI(" ",l.getErrorMessage("registro","direccion")," "),e.R7$(2),e.AVh("is-invalid",(null==(m=l.registroForm.get("aceptaTerminos"))?null:m.invalid)&&(null==(m=l.registroForm.get("aceptaTerminos"))?null:m.touched)),e.R7$(9),e.Y8G("disabled",l.loading),e.R7$(),e.Y8G("ngIf",l.loading),e.R7$(),e.Y8G("ngIf",!l.loading),e.R7$(),e.SpI(" ",l.loading?"Registrando...":"Crear Cuenta Gratis"," ")}}let L=(()=>{class n{fb=(0,a.WQX)(r.ok);auth=(0,a.WQX)(z.u);router=(0,a.WQX)(P.Ix);authSuccess=new e.bkB;closeModal=new e.bkB;activeTab="login";loading=!1;errorMessage=null;loginForm=this.fb.nonNullable.group({email:["",[r.k0.required,r.k0.email]],password:["",[r.k0.required,r.k0.minLength(6)]]});registroForm=this.fb.nonNullable.group({nombre:["",[r.k0.required,r.k0.minLength(3)]],email:["",[r.k0.required,r.k0.email]],password:["",[r.k0.required,r.k0.minLength(6)]],confirmarPassword:["",[r.k0.required]],telefono:["",[r.k0.required,r.k0.minLength(9)]],direccion:["",[r.k0.required,r.k0.minLength(10)]],aceptaTerminos:[!1,[r.k0.requiredTrue]]});setTab(o){this.activeTab=o,this.errorMessage=null,this.loginForm.reset(),this.registroForm.reset()}onLogin(){if(this.loginForm.invalid)return void this.loginForm.markAllAsTouched();this.loading=!0,this.errorMessage=null;const o=this.loginForm.getRawValue();this.auth.login(o).pipe((0,j.j)(()=>this.loading=!1)).subscribe({next:i=>{if("CLIENTE"!==i.tipoUsuario)return this.errorMessage="Esta cuenta no es de tipo cliente. Por favor, usa tu cuenta de cliente o reg\xedstrate.",void sessionStorage.removeItem("authToken");console.log("[CheckoutAuthModal] Login exitoso como cliente"),this.authSuccess.emit()},error:i=>{console.error("[CheckoutAuthModal] Error en login:",i),this.errorMessage=401===i.status?"Email o contrase\xf1a incorrectos":"Error al iniciar sesi\xf3n. Intenta de nuevo."}})}onRegistro(){if(this.registroForm.invalid)return void this.registroForm.markAllAsTouched();const o=this.registroForm.getRawValue();if(o.password!==o.confirmarPassword)return void(this.errorMessage="Las contrase\xf1as no coinciden");this.loading=!0,this.errorMessage=null;const{nombre:i,email:t,password:c,telefono:g,direccion:b}=o;this.auth.registerCliente({nombre:i,email:t,password:c,telefono:g,direccion:b}).pipe((0,j.j)(()=>this.loading=!1)).subscribe({next:()=>{console.log("[CheckoutAuthModal] Registro exitoso, iniciando sesi\xf3n autom\xe1tica"),this.auth.login({email:t,password:c}).subscribe({next:m=>{"CLIENTE"===m.tipoUsuario?this.authSuccess.emit():this.errorMessage="Error en el tipo de cuenta"},error:()=>{this.errorMessage="Registro exitoso. Por favor, inicia sesi\xf3n.",this.setTab("login"),this.loginForm.patchValue({email:t,password:c})}})},error:m=>{console.error("[CheckoutAuthModal] Error en registro:",m),this.errorMessage=409===m.status?"Ya existe una cuenta con este email":400===m.status?"Datos inv\xe1lidos. Verifica los campos.":"Error al registrarse. Intenta de nuevo."}})}onClose(){this.closeModal.emit()}getErrorMessage(o,i){const t="login"===o?this.loginForm.get(i):this.registroForm.get(i);return t&&t.touched&&t.errors?t.errors.required?"Este campo es obligatorio":t.errors.email?"Email inv\xe1lido":t.errors.minlength?`M\xednimo ${t.errors.minlength.requiredLength} caracteres`:"Campo inv\xe1lido":""}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.VBU({type:n,selectors:[["app-checkout-auth-modal"]],outputs:{authSuccess:"authSuccess",closeModal:"closeModal"},decls:22,vars:7,consts:[[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"modal-title"],[1,"bi","bi-lock-fill","me-2"],["type","button","aria-label","Cerrar",1,"btn-close",3,"click"],[1,"bi","bi-x-lg"],[1,"modal-tabs"],["type","button",1,"tab-btn",3,"click"],[1,"bi","bi-box-arrow-in-right","me-1"],[1,"bi","bi-person-plus","me-1"],["class","alert alert-danger","role","alert",4,"ngIf"],["class","tab-content",4,"ngIf"],[1,"modal-footer-info"],[1,"bi","bi-shield-check","text-success","me-2"],[1,"text-muted"],["role","alert",1,"alert","alert-danger"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"tab-content"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","login-email",1,"form-label"],[1,"text-danger"],["type","email","id","login-email","formControlName","email","placeholder","tu@email.com","autocomplete","email",1,"form-control"],[1,"invalid-feedback"],["for","login-password",1,"form-label"],["type","password","id","login-password","formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","current-password",1,"form-control"],["type","submit",1,"btn","btn-primary","btn-block",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","bi bi-box-arrow-in-right me-2",4,"ngIf"],[1,"text-center","mt-3","text-muted"],["href","javascript:void(0)",1,"text-primary","fw-bold",3,"click"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-box-arrow-in-right","me-2"],[1,"text-muted","mb-3"],[1,"bi","bi-info-circle","me-1"],["for","reg-nombre",1,"form-label"],["type","text","id","reg-nombre","formControlName","nombre","placeholder","Juan P\xe9rez","autocomplete","name",1,"form-control"],["for","reg-email",1,"form-label"],["type","email","id","reg-email","formControlName","email","placeholder","tu@email.com","autocomplete","email",1,"form-control"],[1,"row"],[1,"col-md-6"],["for","reg-password",1,"form-label"],["type","password","id","reg-password","formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","new-password",1,"form-control"],["for","reg-confirmar",1,"form-label"],["type","password","id","reg-confirmar","formControlName","confirmarPassword","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","new-password",1,"form-control"],["for","reg-telefono",1,"form-label"],["type","tel","id","reg-telefono","formControlName","telefono","placeholder","612345678","autocomplete","tel",1,"form-control"],["for","reg-direccion",1,"form-label"],["id","reg-direccion","formControlName","direccion","placeholder","Calle Principal, 123, M\xe1laga, 29001","rows","2","autocomplete","street-address",1,"form-control"],[1,"form-check","mb-3"],["type","checkbox","id","reg-terminos","formControlName","aceptaTerminos",1,"form-check-input"],["for","reg-terminos",1,"form-check-label"],["href","/terminos","target","_blank"],["type","submit",1,"btn","btn-success","btn-block",3,"disabled"],["class","bi bi-person-plus me-2",4,"ngIf"],[1,"bi","bi-person-plus","me-2"]],template:function(i,t){1&i&&(e.j41(0,"div",0),e.bIt("click",function(){return t.onClose()}),e.j41(1,"div",1),e.bIt("click",function(g){return g.stopPropagation()}),e.j41(2,"div",2)(3,"h2",3),e.nrm(4,"i",4),e.EFF(5," Inicia sesi\xf3n o reg\xedstrate "),e.k0s(),e.j41(6,"button",5),e.bIt("click",function(){return t.onClose()}),e.nrm(7,"i",6),e.k0s()(),e.j41(8,"div",7)(9,"button",8),e.bIt("click",function(){return t.setTab("login")}),e.nrm(10,"i",9),e.EFF(11," Iniciar Sesi\xf3n "),e.k0s(),e.j41(12,"button",8),e.bIt("click",function(){return t.setTab("registro")}),e.nrm(13,"i",10),e.EFF(14," Registrarse "),e.k0s()(),e.DNE(15,N,3,1,"div",11)(16,Y,26,11,"div",12)(17,B,74,25,"div",12),e.j41(18,"div",13),e.nrm(19,"i",14),e.j41(20,"small",15),e.EFF(21," Tus datos est\xe1n protegidos y seguros "),e.k0s()()()()),2&i&&(e.R7$(9),e.AVh("active","login"===t.activeTab),e.R7$(3),e.AVh("active","registro"===t.activeTab),e.R7$(3),e.Y8G("ngIf",t.errorMessage),e.R7$(),e.Y8G("ngIf","login"===t.activeTab),e.R7$(),e.Y8G("ngIf","registro"===t.activeTab))},dependencies:[f.MD,f.bT,r.X1,r.qT,r.me,r.Zm,r.BC,r.cb,r.j4,r.JD,G.iI],styles:['@charset "UTF-8";.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0009;display:flex;align-items:center;justify-content:center;z-index:9999;padding:1rem;overflow-y:auto;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 10px 15px #0000001a;width:100%;max-width:500px;max-height:90vh;overflow-y:auto;animation:_ngcontent-%COMP%_slideUp .3s ease-out}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid #e0e0e0;position:sticky;top:0;background:#fff;z-index:1}.modal-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600;color:#2c3e50;display:flex;align-items:center}.modal-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.3rem}.btn-close[_ngcontent-%COMP%]{background:transparent;border:none;font-size:1.5rem;cursor:pointer;color:#6c757d;padding:.5rem;line-height:1;transition:color .2s}.btn-close[_ngcontent-%COMP%]:hover{color:#dc3545}.btn-close[_ngcontent-%COMP%]:focus{outline:2px solid #007bff;outline-offset:2px}.modal-tabs[_ngcontent-%COMP%]{display:flex;border-bottom:2px solid #e0e0e0;position:sticky;top:73px;background:#fff;z-index:1}.tab-btn[_ngcontent-%COMP%]{flex:1;padding:1rem;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:1rem;font-weight:500;color:#6c757d;transition:all .2s}.tab-btn[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;color:#495057}.tab-btn.active[_ngcontent-%COMP%]{color:#007bff;border-bottom-color:#007bff;background-color:#f0f8ff}.tab-btn[_ngcontent-%COMP%]:focus{outline:2px solid #007bff;outline-offset:-2px}.tab-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}.tab-content[_ngcontent-%COMP%]{padding:1.5rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500;color:#495057;font-size:.95rem}.form-label[_ngcontent-%COMP%]   .text-danger[_ngcontent-%COMP%]{color:#dc3545}.form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem;font-size:1rem;border:1px solid #ced4da;border-radius:6px;transition:border-color .2s,box-shadow .2s}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 3px #007bff1a}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.form-control.is-invalid[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #dc35451a}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:60px}.invalid-feedback[_ngcontent-%COMP%]{display:none;color:#dc3545;font-size:.875rem;margin-top:.25rem}.is-invalid[_ngcontent-%COMP%] ~ .invalid-feedback[_ngcontent-%COMP%]{display:block}.form-check[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.5rem}.form-check-input[_ngcontent-%COMP%]{margin-top:.25rem;cursor:pointer}.form-check-input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #007bff33}.form-check-label[_ngcontent-%COMP%]{font-size:.9rem;color:#495057;cursor:pointer}.form-check-label[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#007bff;text-decoration:none}.form-check-label[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;font-size:1rem;font-weight:500;border:none;border-radius:6px;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;justify-content:center}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn[_ngcontent-%COMP%]:focus{outline:2px solid currentColor;outline-offset:2px}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.btn-success[_ngcontent-%COMP%]{background-color:#28a745;color:#fff}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838}.btn-block[_ngcontent-%COMP%]{width:100%;margin-top:1rem}.alert[_ngcontent-%COMP%]{padding:1rem;border-radius:6px;margin:1rem 1.5rem;display:flex;align-items:center;font-size:.95rem}.alert-danger[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.text-center[_ngcontent-%COMP%]{text-align:center}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.text-primary[_ngcontent-%COMP%]{color:#007bff!important}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.text-success[_ngcontent-%COMP%]{color:#28a745!important}.fw-bold[_ngcontent-%COMP%]{font-weight:600}.mt-3[_ngcontent-%COMP%]{margin-top:1rem}.mb-3[_ngcontent-%COMP%]{margin-bottom:1rem}.me-1[_ngcontent-%COMP%]{margin-right:.25rem}.me-2[_ngcontent-%COMP%]{margin-right:.5rem}.spinner-border[_ngcontent-%COMP%]{display:inline-block;width:1rem;height:1rem;border:2px solid currentColor;border-right-color:transparent;border-radius:50%;animation:_ngcontent-%COMP%_spin .75s linear infinite}.spinner-border-sm[_ngcontent-%COMP%]{width:.875rem;height:.875rem;border-width:2px}.modal-footer-info[_ngcontent-%COMP%]{padding:1rem 1.5rem;background-color:#f8f9fa;border-top:1px solid #e0e0e0;display:flex;align-items:center;justify-content:center}.modal-footer-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem}.modal-footer-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.875rem}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@media (max-width: 576px){.modal-content[_ngcontent-%COMP%]{border-radius:0;max-height:100vh}.modal-title[_ngcontent-%COMP%]{font-size:1.25rem}.tab-btn[_ngcontent-%COMP%]{font-size:.9rem;padding:.75rem}.row[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{width:100%}}']})}return n})();function q(n,s){if(1&n){const o=e.RV6();e.j41(0,"app-checkout-auth-modal",2),e.bIt("authSuccess",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.onAuthSuccess())})("closeModal",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.onAuthModalClose())}),e.k0s()}}function J(n,s){1&n&&(e.j41(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),e.EFF(4,"Cargando..."),e.k0s()(),e.j41(5,"p",7),e.EFF(6,"Verificando datos del cliente..."),e.k0s()()())}function Q(n,s){if(1&n&&(e.j41(0,"div",37),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.SpI(" ",o.getErrorMessage("nombre")," ")}}function W(n,s){if(1&n&&(e.j41(0,"div",37),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.SpI(" ",o.getErrorMessage("email")," ")}}function H(n,s){if(1&n&&(e.j41(0,"div",37),e.EFF(1),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.SpI(" ",o.getErrorMessage("telefono")," ")}}function Z(n,s){1&n&&(e.j41(0,"div",37),e.EFF(1," La calle es obligatoria "),e.k0s())}function K(n,s){1&n&&(e.j41(0,"div",37),e.EFF(1," CP inv\xe1lido (5 d\xedgitos) "),e.k0s())}function ee(n,s){1&n&&(e.j41(0,"div",37),e.EFF(1," Localidad obligatoria "),e.k0s())}function te(n,s){if(1&n&&(e.j41(0,"option",38),e.EFF(1),e.k0s()),2&n){const o=s.$implicit;e.Y8G("value",o),e.R7$(),e.JRh(o)}}function oe(n,s){1&n&&(e.j41(0,"div",37),e.EFF(1," Selecciona una provincia "),e.k0s())}function ne(n,s){if(1&n){const o=e.RV6();e.j41(0,"div",3)(1,"div",8)(2,"h2",9),e.nrm(3,"i",10),e.EFF(4," Datos de env\xedo "),e.k0s(),e.j41(5,"p",11),e.EFF(6," Confirma o actualiza tus datos para el env\xedo del pedido "),e.k0s(),e.j41(7,"form",12),e.bIt("ngSubmit",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.onSubmit())}),e.j41(8,"div",13)(9,"label",14),e.EFF(10," Nombre completo "),e.j41(11,"span",15),e.EFF(12,"*"),e.k0s()(),e.nrm(13,"input",16),e.DNE(14,Q,2,1,"div",17),e.k0s(),e.j41(15,"div",13)(16,"label",18),e.EFF(17," Email "),e.j41(18,"span",15),e.EFF(19,"*"),e.k0s()(),e.nrm(20,"input",19),e.DNE(21,W,2,1,"div",17),e.k0s(),e.j41(22,"div",13)(23,"label",20),e.EFF(24," Tel\xe9fono "),e.j41(25,"span",15),e.EFF(26,"*"),e.k0s()(),e.nrm(27,"input",21),e.DNE(28,H,2,1,"div",17),e.k0s(),e.j41(29,"div",13)(30,"label",22),e.EFF(31," Direcci\xf3n de env\xedo "),e.j41(32,"span",15),e.EFF(33,"*"),e.k0s()(),e.j41(34,"div",23),e.nrm(35,"input",24),e.DNE(36,Z,2,0,"div",17),e.k0s(),e.j41(37,"div",25)(38,"div",26),e.nrm(39,"input",27),e.DNE(40,K,2,0,"div",17),e.k0s(),e.j41(41,"div",26),e.nrm(42,"input",28),e.DNE(43,ee,2,0,"div",17),e.k0s()(),e.j41(44,"div",23)(45,"select",29)(46,"option",30),e.EFF(47,"Selecciona una provincia"),e.k0s(),e.DNE(48,te,2,2,"option",31),e.k0s(),e.DNE(49,oe,2,0,"div",17),e.k0s()(),e.j41(50,"div",32)(51,"button",33),e.EFF(52," Continuar al pago "),e.nrm(53,"i",34),e.k0s()()(),e.j41(54,"p",35),e.nrm(55,"i",36),e.EFF(56," Tus datos est\xe1n seguros y protegidos "),e.k0s()()()}if(2&n){let o,i,t,c,g,b,m,l,h,_,C,v,F,M;const d=e.XpG();e.R7$(7),e.Y8G("formGroup",d.clienteForm),e.R7$(6),e.AVh("is-invalid",(null==(o=d.clienteForm.get("nombre"))?null:o.invalid)&&(null==(o=d.clienteForm.get("nombre"))?null:o.touched)),e.R7$(),e.Y8G("ngIf",(null==(i=d.clienteForm.get("nombre"))?null:i.invalid)&&(null==(i=d.clienteForm.get("nombre"))?null:i.touched)),e.R7$(6),e.AVh("is-invalid",(null==(t=d.clienteForm.get("email"))?null:t.invalid)&&(null==(t=d.clienteForm.get("email"))?null:t.touched)),e.R7$(),e.Y8G("ngIf",(null==(c=d.clienteForm.get("email"))?null:c.invalid)&&(null==(c=d.clienteForm.get("email"))?null:c.touched)),e.R7$(6),e.AVh("is-invalid",(null==(g=d.clienteForm.get("telefono"))?null:g.invalid)&&(null==(g=d.clienteForm.get("telefono"))?null:g.touched)),e.R7$(),e.Y8G("ngIf",(null==(b=d.clienteForm.get("telefono"))?null:b.invalid)&&(null==(b=d.clienteForm.get("telefono"))?null:b.touched)),e.R7$(7),e.AVh("is-invalid",(null==(m=d.clienteForm.get("calle"))?null:m.invalid)&&(null==(m=d.clienteForm.get("calle"))?null:m.touched)),e.R7$(),e.Y8G("ngIf",(null==(l=d.clienteForm.get("calle"))?null:l.invalid)&&(null==(l=d.clienteForm.get("calle"))?null:l.touched)),e.R7$(3),e.AVh("is-invalid",(null==(h=d.clienteForm.get("cp"))?null:h.invalid)&&(null==(h=d.clienteForm.get("cp"))?null:h.touched)),e.R7$(),e.Y8G("ngIf",(null==(_=d.clienteForm.get("cp"))?null:_.invalid)&&(null==(_=d.clienteForm.get("cp"))?null:_.touched)),e.R7$(2),e.AVh("is-invalid",(null==(C=d.clienteForm.get("localidad"))?null:C.invalid)&&(null==(C=d.clienteForm.get("localidad"))?null:C.touched)),e.R7$(),e.Y8G("ngIf",(null==(v=d.clienteForm.get("localidad"))?null:v.invalid)&&(null==(v=d.clienteForm.get("localidad"))?null:v.touched)),e.R7$(2),e.AVh("is-invalid",(null==(F=d.clienteForm.get("provincia"))?null:F.invalid)&&(null==(F=d.clienteForm.get("provincia"))?null:F.touched)),e.R7$(3),e.Y8G("ngForOf",d.provincias),e.R7$(),e.Y8G("ngIf",(null==(M=d.clienteForm.get("provincia"))?null:M.invalid)&&(null==(M=d.clienteForm.get("provincia"))?null:M.touched)),e.R7$(2),e.Y8G("disabled",d.isSubmitting||d.clienteForm.invalid)}}let ie=(()=>{class n{fb=(0,a.WQX)(r.ok);pedidoService=(0,a.WQX)(k.H);userStore=(0,a.WQX)(x.w);clienteService=(0,a.WQX)(A.M);clienteForm;isSubmitting=!1;showAuthModal=!1;datosClienteCompletos=!1;cargandoDatosCliente=!0;ngOnInit(){this.clienteForm=this.fb.group({nombre:["",[r.k0.required,r.k0.minLength(3)]],email:["",[r.k0.required,r.k0.email]],telefono:["",[r.k0.required,r.k0.minLength(9)]],calle:["",[r.k0.required]],cp:["",[r.k0.required,r.k0.pattern(/^[0-9]{5}$/)]],localidad:["",[r.k0.required]],provincia:["",[r.k0.required]]}),this.verificarDatosClienteAutenticado()}provincias=["\xc1lava","Albacete","Alicante","Almer\xeda","Asturias","\xc1vila","Badajoz","Barcelona","Burgos","C\xe1ceres","C\xe1diz","Cantabria","Castell\xf3n","Ciudad Real","C\xf3rdoba","La Coru\xf1a","Cuenca","Gerona","Granada","Guadalajara","Guip\xfazcoa","Huelva","Huesca","Islas Baleares","Ja\xe9n","Le\xf3n","L\xe9rida","Lugo","Madrid","M\xe1laga","Murcia","Navarra","Ourense","Palencia","Las Palmas","Pontevedra","La Rioja","Salamanca","Segovia","Sevilla","Soria","Tarragona","Santa Cruz de Tenerife","Teruel","Toledo","Valencia","Valladolid","Vizcaya","Zamora","Zaragoza","Ceuta","Melilla"];onSubmit(){if(this.clienteForm.invalid)return void Object.keys(this.clienteForm.controls).forEach(c=>{const g=this.clienteForm.get(c);g?.invalid&&g.markAsTouched()});const o=this.clienteForm.value,t={nombre:o.nombre,email:o.email,telefono:o.telefono,direccion:`${o.calle}, ${o.cp}, ${o.localidad}, ${o.provincia}`};this.pedidoService.validarDatosCliente(t)&&(this.pedidoService.guardarDatosCliente(t),this.verificarAutenticacionYAvanzar())}verificarDatosClienteAutenticado(){const o=this.userStore.snapshot();return sessionStorage.getItem("authToken")&&o?"CLIENTE"!==o.tipoUsuario?(console.log("[CheckoutForm] Usuario no es CLIENTE, mostrando formulario"),void(this.cargandoDatosCliente=!1)):(console.log("[CheckoutForm] Cliente autenticado, verificando datos en perfil..."),void this.clienteService.getClientePorUsuario(o.idUsuario).subscribe({next:t=>{console.log("[CheckoutForm] Datos del cliente:",t);const c=t.nombre&&t.nombre.trim().length>=3,g=t.telefono&&t.telefono.trim().length>=9,b=t.direccion&&t.direccion.trim().length>=10;if(c&&g&&b)console.log("[CheckoutForm] \u2705 Cliente tiene datos completos, omitiendo formulario"),this.datosClienteCompletos=!0,this.pedidoService.guardarDatosCliente({nombre:t.nombre,email:t.usuario.email,telefono:t.telefono,direccion:t.direccion}),this.pedidoService.avanzarPaso(u.b8.PAGO);else{console.log("[CheckoutForm] \u26a0\ufe0f Cliente tiene datos incompletos, mostrando formulario");let m="",l="",h="",_="";if(t.direccion){const C=t.direccion.split(", ");4===C.length?[m,l,h,_]=C:m=t.direccion}this.clienteForm.patchValue({nombre:t.nombre||"",email:t.usuario.email,telefono:t.telefono||"",calle:m,cp:l,localidad:h,provincia:_})}this.cargandoDatosCliente=!1},error:t=>{console.error("[CheckoutForm] Error al cargar datos del cliente:",t);const c=this.pedidoService.getCheckoutState();if(c.clienteData){let g="",b="",m="",l="";if(c.clienteData.direccion){const h=c.clienteData.direccion.split(", ");4===h.length?[g,b,m,l]=h:g=c.clienteData.direccion}this.clienteForm.patchValue({...c.clienteData,calle:g,cp:b,localidad:m,provincia:l})}this.cargandoDatosCliente=!1}})):(console.log("[CheckoutForm] Usuario no autenticado, mostrando formulario"),void(this.cargandoDatosCliente=!1))}verificarAutenticacionYAvanzar(){const o=sessionStorage.getItem("authToken"),i=this.userStore.snapshot();return o&&i?"CLIENTE"!==i.tipoUsuario?(console.error("[CheckoutForm] Usuario no es de tipo CLIENTE"),void alert("Solo los clientes pueden realizar pedidos. Por favor, inicia sesi\xf3n con una cuenta de cliente.")):(console.log("[CheckoutForm] Usuario autenticado como CLIENTE, avanzando al pago"),void this.pedidoService.avanzarPaso(u.b8.PAGO)):(console.log("[CheckoutForm] Usuario no autenticado, mostrando modal"),void(this.showAuthModal=!0))}onAuthSuccess(){console.log("[CheckoutForm] Autenticaci\xf3n exitosa, avanzando al pago"),this.showAuthModal=!1,this.pedidoService.avanzarPaso(u.b8.PAGO)}onAuthModalClose(){console.log("[CheckoutForm] Modal cerrado sin autenticaci\xf3n"),this.showAuthModal=!1}getErrorMessage(o){const i=this.clienteForm.get(o);return i?.hasError("required")?"Este campo es obligatorio":i?.hasError("email")?"Email inv\xe1lido":i?.hasError("minlength")?`M\xednimo ${i.errors?.minlength.requiredLength} caracteres`:""}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.VBU({type:n,selectors:[["app-checkout-form"]],decls:3,vars:3,consts:[[3,"authSuccess","closeModal",4,"ngIf"],["class","checkout-form-container",4,"ngIf"],[3,"authSuccess","closeModal"],[1,"checkout-form-container"],[1,"form-card","text-center","py-5"],["role","status",1,"spinner-border","text-primary","mb-3"],[1,"visually-hidden"],[1,"text-muted"],[1,"form-card"],[1,"section-title"],[1,"bi","bi-person-circle","me-2"],[1,"section-subtitle"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-group"],["for","nombre",1,"form-label"],[1,"required"],["type","text","id","nombre","formControlName","nombre","placeholder","Ej: Juan P\xe9rez Garc\xeda","autocomplete","name",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","tu@email.com","autocomplete","email",1,"form-control"],["for","telefono",1,"form-label"],["type","tel","id","telefono","formControlName","telefono","placeholder","612345678","autocomplete","tel",1,"form-control"],[1,"form-label"],[1,"mb-3"],["type","text","formControlName","calle","placeholder","Calle y n\xfamero (Ej: Calle Mayor 123, 4\xba B)","autocomplete","street-address",1,"form-control"],[1,"row"],[1,"col-md-6","mb-3"],["type","text","formControlName","cp","placeholder","C\xf3digo Postal","maxlength","5","autocomplete","postal-code",1,"form-control"],["type","text","formControlName","localidad","placeholder","Localidad","autocomplete","address-level2",1,"form-control"],["formControlName","provincia","autocomplete","address-level1",1,"form-select","form-control"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["type","submit",1,"btn","btn-primary","btn-lg",3,"disabled"],[1,"bi","bi-arrow-right","ms-2"],[1,"form-note"],[1,"bi","bi-shield-lock","me-1"],[1,"invalid-feedback"],[3,"value"]],template:function(i,t){1&i&&e.DNE(0,q,1,0,"app-checkout-auth-modal",0)(1,J,7,0,"div",1)(2,ne,57,24,"div",1),2&i&&(e.Y8G("ngIf",t.showAuthModal),e.R7$(),e.Y8G("ngIf",t.cargandoDatosCliente),e.R7$(),e.Y8G("ngIf",!t.cargandoDatosCliente&&!t.datosClienteCompletos))},dependencies:[f.MD,f.Sq,f.bT,r.X1,r.qT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.tU,r.j4,r.JD,L],styles:[".form-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:2rem;box-shadow:0 4px 6px #00000012}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:1.5rem}}.section-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin-bottom:.5rem;display:flex;align-items:center}.section-subtitle[_ngcontent-%COMP%]{color:#6c757d;font-size:.9375rem;margin-bottom:2rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem;display:block;color:#212529}.required[_ngcontent-%COMP%]{color:#dc3545}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.form-control.is-invalid[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .25rem #dc354540}.invalid-feedback[_ngcontent-%COMP%]{display:block;margin-top:.25rem}.form-actions[_ngcontent-%COMP%]{margin-top:2rem}.btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;width:100%;font-weight:600;padding:.875rem 1.5rem}.form-note[_ngcontent-%COMP%]{text-align:center;font-size:.875rem;color:#6c757d;margin-top:1rem;margin-bottom:0}.row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;margin-right:-.75rem;margin-left:-.75rem}.col-md-6[_ngcontent-%COMP%]{flex:0 0 auto;width:50%;padding-right:.75rem;padding-left:.75rem}@media (max-width: 768px){.col-md-6[_ngcontent-%COMP%]{width:100%}}.mb-3[_ngcontent-%COMP%]{margin-bottom:1rem!important}.form-select[_ngcontent-%COMP%]{appearance:none;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e\");background-repeat:no-repeat;background-position:right .75rem center;background-size:16px 12px}"]})}return n})();function re(n,s){1&n&&(e.j41(0,"span"),e.nrm(1,"i",21),e.EFF(2," Confirmar y realizar pedido "),e.k0s())}function ae(n,s){1&n&&(e.j41(0,"span"),e.nrm(1,"span",22),e.EFF(2," Procesando... "),e.k0s())}let ce=(()=>{class n{total;fb=(0,a.WQX)(r.ok);pedidoService=(0,a.WQX)(k.H);MetodoPago=u.W1;paymentForm=this.fb.group({metodoPago:[u.W1.TARJETA,r.k0.required]});isProcessing=!1;confirmarPedido(){if(this.paymentForm.invalid)return;const o=this.paymentForm.value.metodoPago;this.isProcessing=!0,this.pedidoService.guardarMetodoPago(o),this.pedidoService.crearPedido(o).subscribe({next:()=>{this.isProcessing=!1},error:()=>{this.isProcessing=!1}})}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.VBU({type:n,selectors:[["app-checkout-payment"]],inputs:{total:"total"},decls:57,vars:22,consts:[[1,"payment-container"],[1,"payment-card"],[1,"section-title"],[1,"bi","bi-credit-card","me-2"],[1,"section-subtitle"],[3,"ngSubmit","formGroup"],[1,"payment-methods"],[1,"payment-option"],["type","radio","name","metodoPago","formControlName","metodoPago",3,"value"],[1,"option-content"],[1,"bi","bi-credit-card-2-front"],[1,"bi","bi-bank"],[1,"bi","bi-paypal"],[1,"bi","bi-cash-coin"],[1,"total-summary"],[1,"total-label"],[1,"total-amount"],["type","submit",1,"btn","btn-success","btn-lg","w-100",3,"disabled"],[4,"ngIf"],[1,"security-note"],[1,"bi","bi-shield-lock-fill","me-1"],[1,"bi","bi-check-circle","me-2"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,t){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.nrm(3,"i",3),e.EFF(4," M\xe9todo de pago "),e.k0s(),e.j41(5,"p",4),e.EFF(6," Selecciona c\xf3mo deseas realizar el pago "),e.k0s(),e.j41(7,"form",5),e.bIt("ngSubmit",function(){return t.confirmarPedido()}),e.j41(8,"div",6)(9,"label",7),e.nrm(10,"input",8),e.j41(11,"div",9),e.nrm(12,"i",10),e.j41(13,"div")(14,"strong"),e.EFF(15,"Tarjeta de cr\xe9dito/d\xe9bito"),e.k0s(),e.j41(16,"span"),e.EFF(17,"Visa, Mastercard, American Express"),e.k0s()()()(),e.j41(18,"label",7),e.nrm(19,"input",8),e.j41(20,"div",9),e.nrm(21,"i",11),e.j41(22,"div")(23,"strong"),e.EFF(24,"Transferencia bancaria"),e.k0s(),e.j41(25,"span"),e.EFF(26,"Recibir\xe1s los datos por email"),e.k0s()()()(),e.j41(27,"label",7),e.nrm(28,"input",8),e.j41(29,"div",9),e.nrm(30,"i",12),e.j41(31,"div")(32,"strong"),e.EFF(33,"PayPal"),e.k0s(),e.j41(34,"span"),e.EFF(35,"Pago r\xe1pido y seguro"),e.k0s()()()(),e.j41(36,"label",7),e.nrm(37,"input",8),e.j41(38,"div",9),e.nrm(39,"i",13),e.j41(40,"div")(41,"strong"),e.EFF(42,"Pago contraentrega"),e.k0s(),e.j41(43,"span"),e.EFF(44,"Paga al recibir tu pedido"),e.k0s()()()()(),e.j41(45,"div",14)(46,"div",15),e.EFF(47,"Total a pagar:"),e.k0s(),e.j41(48,"div",16),e.EFF(49),e.nI1(50,"currency"),e.k0s()(),e.j41(51,"button",17),e.DNE(52,re,3,0,"span",18)(53,ae,3,0,"span",18),e.k0s(),e.j41(54,"p",19),e.nrm(55,"i",20),e.EFF(56," Pago seguro con encriptaci\xf3n SSL "),e.k0s()()()()),2&i&&(e.R7$(7),e.Y8G("formGroup",t.paymentForm),e.R7$(2),e.AVh("selected",t.paymentForm.value.metodoPago===t.MetodoPago.TARJETA),e.R7$(),e.Y8G("value",t.MetodoPago.TARJETA),e.R7$(8),e.AVh("selected",t.paymentForm.value.metodoPago===t.MetodoPago.TRANSFERENCIA),e.R7$(),e.Y8G("value",t.MetodoPago.TRANSFERENCIA),e.R7$(8),e.AVh("selected",t.paymentForm.value.metodoPago===t.MetodoPago.PAYPAL),e.R7$(),e.Y8G("value",t.MetodoPago.PAYPAL),e.R7$(8),e.AVh("selected",t.paymentForm.value.metodoPago===t.MetodoPago.EFECTIVO),e.R7$(),e.Y8G("value",t.MetodoPago.EFECTIVO),e.R7$(12),e.JRh(e.ii3(50,17,t.total,"EUR","symbol","1.2-2")),e.R7$(2),e.Y8G("disabled",t.isProcessing||t.paymentForm.invalid),e.R7$(),e.Y8G("ngIf",!t.isProcessing),e.R7$(),e.Y8G("ngIf",t.isProcessing))},dependencies:[f.MD,f.bT,r.X1,r.qT,r.me,r.Fm,r.BC,r.cb,r.j4,r.JD,f.oe],styles:[".payment-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:2rem;box-shadow:0 4px 6px #00000012}.section-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;margin-bottom:.5rem;display:flex;align-items:center}.section-subtitle[_ngcontent-%COMP%]{color:#6c757d;margin-bottom:2rem}.payment-methods[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-bottom:2rem}.payment-option[_ngcontent-%COMP%]{border:2px solid #dee2e6;border-radius:.5rem;padding:1.25rem;cursor:pointer;transition:all .2s ease;display:block}.payment-option[_ngcontent-%COMP%]:hover{border-color:#0d6efd;background-color:#f8f9fa}.payment-option.selected[_ngcontent-%COMP%]{border-color:#0d6efd;background-color:#e7f1ff}.payment-option[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{display:none}.option-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.option-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:#0d6efd}.option-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.option-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1rem;color:#212529}.option-content[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d}.total-summary[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:1.5rem;border-radius:.5rem;display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.total-label[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:500}.total-amount[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:#0d6efd}.btn[_ngcontent-%COMP%]{font-weight:600;padding:1rem 1.5rem;display:flex;align-items:center;justify-content:center}.btn[_ngcontent-%COMP%]:disabled{opacity:.6}.security-note[_ngcontent-%COMP%]{text-align:center;font-size:.875rem;color:#6c757d;margin-top:1rem;margin-bottom:0}"]})}return n})();function le(n,s){if(1&n){const o=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3),e.nrm(3,"i",4),e.k0s(),e.j41(4,"h1",5),e.EFF(5,"\xa1Pedido confirmado!"),e.k0s(),e.j41(6,"p",6),e.EFF(7," Gracias por tu compra. Hemos recibido tu pedido correctamente. "),e.k0s(),e.j41(8,"div",7)(9,"span",8),e.EFF(10,"N\xfamero de pedido:"),e.k0s(),e.j41(11,"strong"),e.EFF(12),e.k0s()(),e.j41(13,"div",9)(14,"h3",10),e.EFF(15,"Resumen del pedido"),e.k0s(),e.j41(16,"div",11)(17,"span"),e.EFF(18,"Subtotal:"),e.k0s(),e.j41(19,"span"),e.EFF(20),e.nI1(21,"currency"),e.k0s()(),e.j41(22,"div",11)(23,"span"),e.EFF(24,"IVA:"),e.k0s(),e.j41(25,"span"),e.EFF(26),e.nI1(27,"currency"),e.k0s()(),e.j41(28,"div",11)(29,"span"),e.EFF(30,"Gastos de env\xedo:"),e.k0s(),e.j41(31,"span"),e.EFF(32),e.nI1(33,"currency"),e.k0s()(),e.j41(34,"div",12)(35,"strong"),e.EFF(36,"Total:"),e.k0s(),e.j41(37,"strong",13),e.EFF(38),e.nI1(39,"currency"),e.k0s()()(),e.j41(40,"div",14)(41,"div",15),e.nrm(42,"i",16),e.j41(43,"div")(44,"strong"),e.EFF(45,"Email de confirmaci\xf3n"),e.k0s(),e.j41(46,"p"),e.EFF(47),e.k0s()()(),e.j41(48,"div",15),e.nrm(49,"i",17),e.j41(50,"div")(51,"strong"),e.EFF(52,"Env\xedo a domicilio"),e.k0s(),e.j41(53,"p"),e.EFF(54),e.k0s()()(),e.j41(55,"div",15),e.nrm(56,"i",18),e.j41(57,"div")(58,"strong"),e.EFF(59,"M\xe9todo de pago"),e.k0s(),e.j41(60,"p"),e.EFF(61),e.k0s()()()(),e.j41(62,"div",19)(63,"button",20),e.bIt("click",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.verPedidos())}),e.EFF(64," Ver mis pedidos "),e.k0s(),e.j41(65,"button",21),e.bIt("click",function(t){a.eBV(o);const c=e.XpG();return a.Njj(c.navigateToRoot(t))}),e.EFF(66," Volver al inicio "),e.k0s()(),e.j41(67,"p",22),e.nrm(68,"i",23),e.EFF(69," Gracias por confiar en Cosecha en Cope "),e.k0s()()()}if(2&n){const o=e.XpG();e.R7$(12),e.JRh(o.pedido.idTransaccion),e.R7$(8),e.JRh(e.ii3(21,10,o.pedido.subTotal,"EUR","symbol","1.2-2")),e.R7$(6),e.JRh(e.ii3(27,15,o.pedido.iva,"EUR","symbol","1.2-2")),e.R7$(6),e.JRh(e.ii3(33,20,o.pedido.gastosEnvio,"EUR","symbol","1.2-2")),e.R7$(6),e.JRh(e.ii3(39,25,o.pedido.total,"EUR","symbol","1.2-2")),e.R7$(9),e.SpI("Hemos enviado los detalles a ",o.pedido.emailUsuario),e.R7$(7),e.JRh(o.pedido.direccionCliente),e.R7$(7),e.JRh(o.pedido.metodoPago),e.R7$(4),e.AVh("active",o.isRootPath())}}function se(n,s){1&n&&(e.j41(0,"div",1)(1,"div",2)(2,"div",24)(3,"div",25)(4,"span",26),e.EFF(5,"Cargando..."),e.k0s()(),e.j41(6,"p"),e.EFF(7,"Cargando informaci\xf3n del pedido..."),e.k0s()()()())}let de=(()=>{class n{pedidoService=(0,a.WQX)(k.H);router=(0,a.WQX)(P.Ix);pedido=null;ngOnInit(){this.pedidoService.ultimoPedido$.subscribe(o=>{this.pedido=o})}irAlInicio(){this.router.navigate(["/"])}navigateToRoot(o){o.preventDefault(),window.location.href="/"}isRootPath(){return"/"===window.location.pathname}verPedidos(){this.router.navigate(["/cliente/pedidos"])}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.VBU({type:n,selectors:[["app-order-confirmation"]],decls:2,vars:2,consts:[["class","confirmation-container",4,"ngIf"],[1,"confirmation-container"],[1,"confirmation-card"],[1,"success-icon"],[1,"bi","bi-check-circle-fill"],[1,"confirmation-title"],[1,"confirmation-subtitle"],[1,"order-number"],[1,"label"],[1,"order-summary"],[1,"summary-title"],[1,"summary-row"],[1,"summary-row","total"],[1,"total-amount"],[1,"info-boxes"],[1,"info-box"],[1,"bi","bi-envelope"],[1,"bi","bi-truck"],[1,"bi","bi-credit-card"],[1,"action-buttons"],["type","button",1,"btn","btn-primary","btn-lg",3,"click"],["type","button","href","/",1,"btn","btn-outline-secondary","btn-lg",3,"click"],[1,"final-message"],[1,"bi","bi-heart-fill","text-danger"],[1,"loading-state"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(i,t){1&i&&e.DNE(0,le,70,30,"div",0)(1,se,8,0,"div",0),2&i&&(e.Y8G("ngIf",t.pedido),e.R7$(),e.Y8G("ngIf",!t.pedido))},dependencies:[f.MD,f.bT,f.oe],styles:[".confirmation-card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:3rem 2rem;box-shadow:0 4px 6px #00000012;text-align:center;max-width:600px;margin:0 auto}@media (max-width: 768px){.confirmation-card[_ngcontent-%COMP%]{padding:2rem 1.5rem}}.success-icon[_ngcontent-%COMP%]{font-size:5rem;color:#28a745;margin-bottom:1.5rem;animation:_ngcontent-%COMP%_scaleIn .5s ease}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}.confirmation-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin-bottom:.5rem;color:#212529}@media (max-width: 768px){.confirmation-title[_ngcontent-%COMP%]{font-size:1.75rem}}.confirmation-subtitle[_ngcontent-%COMP%]{font-size:1.125rem;color:#6c757d;margin-bottom:2rem}.order-number[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:1rem;border-radius:.5rem;margin-bottom:2rem;display:flex;flex-direction:column;gap:.5rem}.order-number[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d}.order-number[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.25rem;color:#0d6efd}.order-summary[_ngcontent-%COMP%]{text-align:left;background-color:#f8f9fa;padding:1.5rem;border-radius:.5rem;margin-bottom:2rem}.summary-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;margin-bottom:1rem;color:#212529}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid #dee2e6}.summary-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.summary-row.total[_ngcontent-%COMP%]{padding-top:1rem;margin-top:.5rem;border-top:2px solid #dee2e6;font-size:1.125rem}.summary-row.total[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{color:#28a745;font-size:1.5rem}.info-boxes[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-bottom:2rem;text-align:left}.info-box[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem;background-color:#f8f9fa;border-radius:.5rem}.info-box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;color:#0d6efd;flex-shrink:0}.info-box[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;font-size:1rem;margin-bottom:.25rem}.info-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d;margin:0}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-bottom:1.5rem}.action-buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%;padding:.875rem 1.5rem;font-weight:600}.final-message[_ngcontent-%COMP%]{font-size:1rem;color:#6c757d;margin:0;display:flex;align-items:center;justify-content:center;gap:.5rem}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;padding:3rem 1rem}"]})}return n})();function me(n,s){if(1&n){const o=e.RV6();e.j41(0,"button",18),e.bIt("click",function(){a.eBV(o);const t=e.XpG();return a.Njj(t.goBack())}),e.nrm(1,"i",19),e.EFF(2," Atr\xe1s "),e.k0s()}}function ue(n,s){1&n&&(e.j41(0,"div",20)(1,"div",21)(2,"span",22),e.EFF(3,"Cargando..."),e.k0s()(),e.j41(4,"p"),e.EFF(5,"Cargando informaci\xf3n del carrito..."),e.k0s()())}function ge(n,s){if(1&n&&(e.j41(0,"div",23),e.nrm(1,"i",24),e.EFF(2),e.k0s()),2&n){const o=e.XpG();e.R7$(2),e.SpI(" ",null==o.checkoutState?null:o.checkoutState.error," ")}}function pe(n,s){if(1&n&&e.nrm(0,"app-checkout-summary",25),2&n){const o=e.XpG();e.Y8G("carrito",o.carrito)}}function fe(n,s){1&n&&e.nrm(0,"app-checkout-form")}function be(n,s){if(1&n&&e.nrm(0,"app-checkout-payment",26),2&n){const o=e.XpG();e.Y8G("total",o.carrito.total)}}function he(n,s){1&n&&e.nrm(0,"app-order-confirmation")}function _e(n,s){1&n&&(e.j41(0,"footer",27)(1,"div",2)(2,"div",28)(3,"div",29),e.nrm(4,"i",30),e.j41(5,"span"),e.EFF(6,"Pago seguro"),e.k0s()(),e.j41(7,"div",29),e.nrm(8,"i",31),e.j41(9,"span"),e.EFF(10,"Env\xedo garantizado"),e.k0s()(),e.j41(11,"div",29),e.nrm(12,"i",32),e.j41(13,"span"),e.EFF(14,"Devoluci\xf3n f\xe1cil"),e.k0s()()()()())}let Ce=(()=>{class n{pedidoService=(0,a.WQX)(k.H);carritoService=(0,a.WQX)(y.a);userStore=(0,a.WQX)(x.w);router=(0,a.WQX)(P.Ix);CheckoutStep=u.b8;checkoutState=null;carrito=null;isLoadingCarrito=!0;destroy$=new R.B;ngOnInit(){this.pedidoService.iniciarCheckout(),this.pedidoService.checkoutState$.pipe((0,E.Q)(this.destroy$)).subscribe(o=>{this.checkoutState=o,console.log("[CheckoutPage] Estado actualizado:",o.step)}),this.carritoService.obtenerCarrito().pipe((0,E.Q)(this.destroy$)).subscribe({next:o=>{this.carrito=o,this.isLoadingCarrito=!1,(!o||0===o.items.length)&&(console.warn("[CheckoutPage] Carrito vac\xedo, redirigiendo"),alert("Tu carrito est\xe1 vac\xedo. Agrega productos antes de continuar."),this.router.navigate(["/articulos"]))},error:o=>{console.error("[CheckoutPage] Error al cargar carrito:",o),this.isLoadingCarrito=!1,alert("Error al cargar el carrito. Intenta de nuevo."),this.router.navigate(["/carrito"])}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getProgressPercentage(){if(!this.checkoutState)return 0;const o=[u.b8.RESUMEN,u.b8.DATOS,u.b8.PAGO,u.b8.CONFIRMACION];return(o.indexOf(this.checkoutState.step)+1)/o.length*100}getStepNumber(){return this.checkoutState?[u.b8.RESUMEN,u.b8.DATOS,u.b8.PAGO,u.b8.CONFIRMACION].indexOf(this.checkoutState.step)+1:1}getStepTitle(){return this.checkoutState&&{[u.b8.RESUMEN]:"Resumen del Pedido",[u.b8.DATOS]:"Datos de Env\xedo",[u.b8.PAGO]:"M\xe9todo de Pago",[u.b8.CONFIRMACION]:"\xa1Pedido Confirmado!"}[this.checkoutState.step]||""}cancelarCheckout(){this.checkoutState?.step===u.b8.CONFIRMACION?this.router.navigate(["/"]):confirm("\xbfEst\xe1s seguro de que deseas cancelar el proceso de compra?")&&(this.pedidoService.cancelarCheckout(),this.router.navigate(["/carrito"]))}canGoBack(){return this.checkoutState?.step!==u.b8.RESUMEN&&this.checkoutState?.step!==u.b8.CONFIRMACION}goBack(){this.canGoBack()&&this.pedidoService.retrocederPaso()}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.VBU({type:n,selectors:[["app-checkout-page"]],decls:22,vars:14,consts:[[1,"checkout-container"],[1,"checkout-header"],[1,"container"],["type","button","class","btn-back","aria-label","Volver al paso anterior",3,"click",4,"ngIf"],[1,"progress-section"],[1,"checkout-title"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar"],[1,"progress-fill"],[1,"step-indicator"],["type","button",1,"btn-cancel",3,"click"],[1,"bi","bi-x-lg"],[1,"checkout-content"],["class","loading-state",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[3,"carrito",4,"ngIf"],[4,"ngIf"],[3,"total",4,"ngIf"],["class","checkout-footer",4,"ngIf"],["type","button","aria-label","Volver al paso anterior",1,"btn-back",3,"click"],[1,"bi","bi-arrow-left"],[1,"loading-state"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["role","alert",1,"alert","alert-danger"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[3,"carrito"],[3,"total"],[1,"checkout-footer"],[1,"security-badges"],[1,"badge-item"],[1,"bi","bi-shield-check"],[1,"bi","bi-truck"],[1,"bi","bi-arrow-return-left"]],template:function(i,t){1&i&&(e.j41(0,"div",0)(1,"header",1)(2,"div",2),e.DNE(3,me,3,0,"button",3),e.j41(4,"div",4)(5,"h1",5),e.EFF(6),e.k0s(),e.j41(7,"div",6),e.nrm(8,"div",7),e.k0s(),e.j41(9,"p",8),e.EFF(10),e.k0s()(),e.j41(11,"button",9),e.bIt("click",function(){return t.cancelarCheckout()}),e.nrm(12,"i",10),e.k0s()()(),e.j41(13,"main",11)(14,"div",2),e.DNE(15,ue,6,0,"div",12)(16,ge,3,1,"div",13)(17,pe,1,1,"app-checkout-summary",14)(18,fe,1,0,"app-checkout-form",15)(19,be,1,1,"app-checkout-payment",16)(20,he,1,0,"app-order-confirmation",15),e.k0s()(),e.DNE(21,_e,15,0,"footer",17),e.k0s()),2&i&&(e.R7$(3),e.Y8G("ngIf",t.canGoBack()),e.R7$(3),e.JRh(t.getStepTitle()),e.R7$(),e.BMQ("aria-valuenow",t.getProgressPercentage()),e.R7$(),e.xc7("width",t.getProgressPercentage(),"%"),e.R7$(2),e.SpI("Paso ",t.getStepNumber()," de 4"),e.R7$(),e.BMQ("aria-label",(null==t.checkoutState?null:t.checkoutState.step)===t.CheckoutStep.CONFIRMACION?"Ir al inicio":"Cancelar compra"),e.R7$(4),e.Y8G("ngIf",t.isLoadingCarrito),e.R7$(),e.Y8G("ngIf",null==t.checkoutState?null:t.checkoutState.error),e.R7$(),e.Y8G("ngIf",(null==t.checkoutState?null:t.checkoutState.step)===t.CheckoutStep.RESUMEN&&t.carrito),e.R7$(),e.Y8G("ngIf",(null==t.checkoutState?null:t.checkoutState.step)===t.CheckoutStep.DATOS),e.R7$(),e.Y8G("ngIf",(null==t.checkoutState?null:t.checkoutState.step)===t.CheckoutStep.PAGO&&t.carrito),e.R7$(),e.Y8G("ngIf",(null==t.checkoutState?null:t.checkoutState.step)===t.CheckoutStep.CONFIRMACION),e.R7$(),e.Y8G("ngIf",(null==t.checkoutState?null:t.checkoutState.step)!==t.CheckoutStep.CONFIRMACION))},dependencies:[f.MD,f.bT,$,ie,ce,de],styles:[".checkout-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;background-color:#f8f9fa}.checkout-header[_ngcontent-%COMP%]{background:#fff;border-bottom:1px solid #dee2e6;position:sticky;top:0;z-index:100;box-shadow:0 1px 2px #0000000d}.checkout-header[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1rem;display:grid;grid-template-columns:auto 1fr auto;gap:1rem;align-items:center}@media (max-width: 768px){.checkout-header[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:.75rem}}.btn-back[_ngcontent-%COMP%], .btn-cancel[_ngcontent-%COMP%]{background:none;border:1px solid #dee2e6;padding:.5rem 1rem;border-radius:.375rem;cursor:pointer;display:flex;align-items:center;gap:.5rem;font-size:.875rem;transition:all .2s ease;color:#495057}.btn-back[_ngcontent-%COMP%]:hover, .btn-cancel[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;border-color:#adb5bd}.btn-back[_ngcontent-%COMP%]:focus, .btn-cancel[_ngcontent-%COMP%]:focus{outline:2px solid #0d6efd;outline-offset:2px}.btn-back[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .btn-cancel[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.btn-cancel[_ngcontent-%COMP%]{border-color:transparent}.btn-cancel[_ngcontent-%COMP%]:hover{color:#dc3545;border-color:#dc3545;background-color:#fff5f5}.progress-section[_ngcontent-%COMP%]{flex:1;min-width:0}.checkout-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin:0 0 .75rem;color:#212529}@media (max-width: 768px){.checkout-title[_ngcontent-%COMP%]{font-size:1.125rem}}.progress-bar[_ngcontent-%COMP%]{height:8px;background-color:#e9ecef;border-radius:4px;overflow:hidden;margin-bottom:.5rem}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#2e8a99;transition:width .25s ease-in-out}.step-indicator[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d;margin:0;text-align:center}@media (max-width: 768px){.step-indicator[_ngcontent-%COMP%]{font-size:.8125rem}}.checkout-content[_ngcontent-%COMP%]{flex:1;padding:2rem 0}.checkout-content[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:0 1rem}@media (max-width: 768px){.checkout-content[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{padding:0 .75rem}}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;gap:1rem}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;margin:0}.checkout-footer[_ngcontent-%COMP%]{background:#fff;border-top:1px solid #dee2e6;padding:1.5rem 0;margin-top:auto}.checkout-footer[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}.security-badges[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:2rem;flex-wrap:wrap}@media (max-width: 768px){.security-badges[_ngcontent-%COMP%]{gap:1rem}}.badge-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:#6c757d;font-size:.875rem}.badge-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem;color:#28a745}@media (max-width: 576px){.badge-item[_ngcontent-%COMP%]{font-size:.8125rem}.badge-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.125rem}}.alert[_ngcontent-%COMP%]{border-radius:.5rem;margin-bottom:1.5rem;display:flex;align-items:center;animation:_ngcontent-%COMP%_slideDown .3s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.visually-hidden[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}*[_ngcontent-%COMP%]:focus-visible{outline:2px solid #0d6efd;outline-offset:2px;border-radius:.25rem}[_nghost-%COMP%]     app-checkout-summary, [_nghost-%COMP%]     app-checkout-form, [_nghost-%COMP%]     app-checkout-payment, [_nghost-%COMP%]     app-order-confirmation{animation:_ngcontent-%COMP%_fadeIn .4s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}"]})}return n})()}}]);