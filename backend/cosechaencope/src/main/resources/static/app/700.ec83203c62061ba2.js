"use strict";(self.webpackChunkcosecha_en_cope=self.webpackChunkcosecha_en_cope||[]).push([[700],{4123:(v,f,p)=>{p.d(f,{_:()=>T});var o=p(2615),e=p(3664),l=p(2200),h=p(9330),g=p(5293);let U=(()=>{class i{http=(0,o.WQX)(h.Qq);subirImagenArticulo(t,n,r){const a=new FormData;return a.append("file",t),a.append("idUsuario",n.toString()),a.append("tipoUsuario",r),this.http.post(g.Sn.IMAGENES.UPLOAD_ARTICULO,a)}subirImagenCategoria(t,n,r){const a=new FormData;return a.append("file",t),a.append("idUsuario",n.toString()),a.append("tipoUsuario",r),this.http.post(g.Sn.IMAGENES.UPLOAD_CATEGORIA,a)}subirImagenPerfil(t,n,r){const a=new FormData;return a.append("file",t),a.append("idUsuario",n.toString()),a.append("tipoUsuario",r),this.http.post(g.Sn.IMAGENES.UPLOAD_PERFIL,a)}eliminarImagen(t){return this.http.delete(`${g.Sn.IMAGENES.DELETE}?imageUrl=${encodeURIComponent(t)}`)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=o.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var s=p(9675);let c=(()=>{class i{DEFAULT_MAX_SIZE_MB=10;DEFAULT_MIME_TYPES=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];validateFile(t,n={}){const r=[];if(!t)return{valid:!1,errors:["Debe seleccionar un archivo"]};0===t.size&&r.push("El archivo est\xe1 vac\xedo");const a=n.maxSizeMb??this.DEFAULT_MAX_SIZE_MB;t.size>1024*a*1024&&r.push(`El archivo no puede exceder ${a}MB`);const d=n.allowedMimeTypes??this.DEFAULT_MIME_TYPES;if(!d.includes(t.type)){const S=d.map(F=>F.split("/")[1]?.toUpperCase()).join(", ");r.push(`Solo se permiten archivos: ${S}`)}return{valid:0===r.length,errors:r}}formatFileSize(t){if(!Number.isFinite(t)||t<=0)return"0 KB";const n=["Bytes","KB","MB","GB","TB"];let r=t,a=0;for(;r>=1024&&a<n.length-1;)r/=1024,a++;return`${r.toFixed(0===a?0:1)} ${n[a]}`}verificarImagenValida(t){return new Promise(n=>{const r=new Image;r.onload=()=>n(!0),r.onerror=()=>n(!1),r.src=t})}buildErrorMessage(t,n){return t.valid||!t.errors?null:t.errors.includes("size")&&"number"==typeof n.maxSizeMb?`El archivo no puede superar los ${n.maxSizeMb}MB`:t.errors.includes("type")&&n.allowedMimeTypes&&n.allowedMimeTypes.length>0?`Solo se permiten archivos: ${n.allowedMimeTypes.map(a=>a.split("/")[1]?.toUpperCase()??a).join(", ")}`:t.errors.includes("empty")?"Selecciona un archivo":"Archivo inv\xe1lido"}static \u0275fac=function(n){return new(n||i)};static \u0275prov=o.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function _(i,u){if(1&i&&(e.j41(0,"div",11),e.nrm(1,"img",12),e.j41(2,"div",13),e.nrm(3,"i",14),e.j41(4,"p"),e.EFF(5,"Click para cambiar imagen"),e.k0s()()()),2&i){const t=e.XpG();e.R7$(),e.Y8G("src",t.currentImageUrl,e.B4B)("alt","Imagen actual")}}function I(i,u){if(1&i){const t=e.RV6();e.j41(0,"div",15),e.nrm(1,"img",12),e.j41(2,"div",16)(3,"p",17),e.EFF(4),e.k0s(),e.j41(5,"p",18),e.EFF(6),e.k0s()(),e.j41(7,"button",19),e.bIt("click",function(r){o.eBV(t);const a=e.XpG();return o.Njj(a.removeFile(r))}),e.nrm(8,"i",20),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(),e.Y8G("src",t.previewUrl,e.B4B)("alt",t.selectedFile.name),e.R7$(3),e.JRh(t.selectedFile.name),e.R7$(2),e.JRh(t.formatFileSize(t.selectedFile.size))}}function E(i,u){1&i&&(e.j41(0,"div",21),e.nrm(1,"i",22),e.j41(2,"h5"),e.EFF(3,"Subir Imagen"),e.k0s(),e.j41(4,"p"),e.EFF(5,"Arrastra una imagen aqu\xed o click para seleccionar"),e.k0s(),e.j41(6,"small",23),e.EFF(7,"JPG, PNG, GIF, WEBP - M\xe1ximo 10MB"),e.k0s()())}function M(i,u){1&i&&(e.j41(0,"div",24)(1,"div",25)(2,"span",26),e.EFF(3,"Subiendo..."),e.k0s()(),e.j41(4,"p",27),e.EFF(5,"Subiendo imagen..."),e.k0s()())}function b(i,u){if(1&i&&(e.j41(0,"div",30),e.nrm(1,"i",31),e.EFF(2),e.k0s()),2&i){const t=u.$implicit;e.R7$(2),e.SpI(" ",t," ")}}function C(i,u){if(1&i&&(e.j41(0,"div",28),e.DNE(1,b,3,1,"div",29),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.errorMessages)}}function P(i,u){if(1&i&&(e.j41(0,"div",32),e.nrm(1,"i",33),e.EFF(2),e.k0s()),2&i){const t=e.XpG();e.R7$(2),e.SpI(" ",t.successMessage," ")}}function O(i,u){if(1&i){const t=e.RV6();e.j41(0,"div",34)(1,"button",35),e.bIt("click",function(){o.eBV(t);const r=e.XpG();return o.Njj(r.uploadFile())}),e.nrm(2,"i",36),e.EFF(3," Subir Imagen "),e.k0s(),e.j41(4,"button",37),e.bIt("click",function(){o.eBV(t);const r=e.XpG();return o.Njj(r.cancelUpload())}),e.nrm(5,"i",20),e.EFF(6," Cancelar "),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(),e.Y8G("disabled",t.hasError)}}let T=(()=>{class i{imagenService=(0,o.WQX)(U);userStore=(0,o.WQX)(s.w);utils=(0,o.WQX)(c);currentImageUrl;uploadType="articulo";placeholder="Subir imagen";maxSizeMb=10;allowedMimeTypes=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];imageUploaded=new e.bkB;imageRemoved=new e.bkB;selectedFile=null;previewUrl=null;errorMessages=[];successMessage="";isUploading=!1;isDragOver=!1;get hasError(){return this.errorMessages.length>0}onFileSelected(t){const n=t.target.files[0];n&&this.processFile(n)}onDragOver(t){t.preventDefault(),this.isDragOver=!0}onDragLeave(t){t.preventDefault(),this.isDragOver=!1}onDrop(t){t.preventDefault(),this.isDragOver=!1;const n=t.dataTransfer?.files;n&&n.length>0&&this.processFile(n[0])}processFile(t){this.clearMessages();const n={maxSizeMb:this.maxSizeMb,allowedMimeTypes:this.allowedMimeTypes},r=this.utils.validateFile(t,n);if(!r.valid){const m=this.utils.buildErrorMessage(r,n)??"Archivo inv\xe1lido";return void(this.errorMessages=[m])}this.selectedFile=t;const a=new FileReader;a.onload=m=>{this.previewUrl=m.target?.result},a.readAsDataURL(t)}uploadFile(){if(!this.selectedFile)return;const t=this.userStore.snapshot();if(!t)return void(this.errorMessages=["No hay usuario autenticado"]);let n;switch(this.isUploading=!0,this.clearMessages(),this.uploadType){case"articulo":n=this.imagenService.subirImagenArticulo(this.selectedFile,t.idUsuario,t.tipoUsuario);break;case"categoria":n=this.imagenService.subirImagenCategoria(this.selectedFile,t.idUsuario,t.tipoUsuario);break;case"perfil":n=this.imagenService.subirImagenPerfil(this.selectedFile,t.idUsuario,t.tipoUsuario);break;default:return this.errorMessages=["Tipo de subida no v\xe1lido"],void(this.isUploading=!1)}n.subscribe({next:r=>{this.isUploading=!1,r.success?(this.successMessage=r.message,this.imageUploaded.emit(r.imageUrl),this.currentImageUrl=r.imageUrl,this.selectedFile=null,this.previewUrl=null):this.errorMessages=[r.message]},error:r=>{this.isUploading=!1,this.errorMessages=[r.error?.message||"Error al subir la imagen"]}})}removeFile(t){t.stopPropagation(),this.selectedFile=null,this.previewUrl=null,this.clearMessages()}cancelUpload(){this.selectedFile=null,this.previewUrl=null,this.clearMessages()}removeCurrentImage(){this.currentImageUrl&&this.imagenService.eliminarImagen(this.currentImageUrl).subscribe({next:()=>{this.currentImageUrl=void 0,this.imageRemoved.emit(),this.successMessage="Imagen eliminada correctamente"},error:t=>{this.errorMessages=[t.error?.message||"Error al eliminar la imagen"]}})}formatFileSize(t){return this.utils.formatFileSize(t)}clearMessages(){this.errorMessages=[],this.successMessage=""}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-image-upload-panel"]],inputs:{currentImageUrl:"currentImageUrl",uploadType:"uploadType",placeholder:"placeholder",maxSizeMb:"maxSizeMb",allowedMimeTypes:"allowedMimeTypes"},outputs:{imageUploaded:"imageUploaded",imageRemoved:"imageRemoved"},decls:11,vars:11,consts:[["fileInput",""],[1,"image-upload-container"],[1,"upload-zone",3,"click","dragover","dragleave","drop"],["class","current-image",4,"ngIf"],["class","preview-container",4,"ngIf"],["class","upload-prompt",4,"ngIf"],["class","upload-loading",4,"ngIf"],["type","file","accept","image/*",2,"display","none",3,"change"],["class","error-messages mt-2",4,"ngIf"],["class","alert alert-success alert-sm mt-2",4,"ngIf"],["class","action-buttons mt-3",4,"ngIf"],[1,"current-image"],[1,"preview-img",3,"src","alt"],[1,"overlay"],[1,"fas","fa-camera"],[1,"preview-container"],[1,"file-info"],[1,"file-name"],[1,"file-size"],["type","button","title","Quitar imagen",1,"btn","btn-sm","btn-outline-danger","remove-btn",3,"click"],[1,"fas","fa-times"],[1,"upload-prompt"],[1,"fas","fa-cloud-upload-alt","upload-icon"],[1,"text-muted"],[1,"upload-loading"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"error-messages","mt-2"],["class","alert alert-danger alert-sm",4,"ngFor","ngForOf"],[1,"alert","alert-danger","alert-sm"],[1,"fas","fa-exclamation-triangle"],[1,"alert","alert-success","alert-sm","mt-2"],[1,"fas","fa-check-circle"],[1,"action-buttons","mt-3"],["type","button",1,"btn","btn-primary","me-2",3,"click","disabled"],[1,"fas","fa-upload"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(n,r){if(1&n){const a=e.RV6();e.j41(0,"div",1)(1,"div",2),e.bIt("click",function(){o.eBV(a);const d=e.sdS(7);return o.Njj(d.click())})("dragover",function(d){return o.eBV(a),o.Njj(r.onDragOver(d))})("dragleave",function(d){return o.eBV(a),o.Njj(r.onDragLeave(d))})("drop",function(d){return o.eBV(a),o.Njj(r.onDrop(d))}),e.DNE(2,_,6,2,"div",3)(3,I,9,4,"div",4)(4,E,8,0,"div",5)(5,M,6,0,"div",6),e.k0s(),e.j41(6,"input",7,0),e.bIt("change",function(d){return o.eBV(a),o.Njj(r.onFileSelected(d))}),e.k0s(),e.DNE(8,C,2,1,"div",8)(9,P,3,1,"div",9)(10,O,7,1,"div",10),e.k0s()}2&n&&(e.R7$(),e.AVh("drag-over",r.isDragOver)("has-error",r.hasError),e.R7$(),e.Y8G("ngIf",r.currentImageUrl&&!r.selectedFile),e.R7$(),e.Y8G("ngIf",r.selectedFile&&r.previewUrl),e.R7$(),e.Y8G("ngIf",!r.currentImageUrl&&!r.selectedFile),e.R7$(),e.Y8G("ngIf",r.isUploading),e.R7$(3),e.Y8G("ngIf",r.errorMessages.length>0),e.R7$(),e.Y8G("ngIf",r.successMessage),e.R7$(),e.Y8G("ngIf",r.selectedFile&&!r.isUploading))},dependencies:[l.MD,l.Sq,l.bT],styles:[".image-upload-container[_ngcontent-%COMP%]{width:100%}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #dee2e6;border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:all .3s ease;position:relative;min-height:200px;display:flex;align-items:center;justify-content:center}.upload-zone[_ngcontent-%COMP%]:hover{border-color:#28a745;background-color:#f8f9fa}.upload-zone.drag-over[_ngcontent-%COMP%]{border-color:#28a745;background-color:#e8f5e8}.upload-zone.has-error[_ngcontent-%COMP%]{border-color:#dc3545}.current-image[_ngcontent-%COMP%], .preview-container[_ngcontent-%COMP%]{position:relative;width:100%;max-width:300px;margin:0 auto}.preview-img[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover;border-radius:8px;box-shadow:0 2px 8px #0000001a}.current-image[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000b3;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:8px;opacity:0;transition:opacity .3s ease}.current-image[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.overlay[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:10px}.file-info[_ngcontent-%COMP%]{margin-top:10px;text-align:center}.file-name[_ngcontent-%COMP%]{font-weight:500;margin-bottom:5px;word-break:break-all}.file-size[_ngcontent-%COMP%]{color:#6c757d;font-size:.9rem;margin:0}.remove-btn[_ngcontent-%COMP%]{position:absolute;top:-10px;right:-10px;border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;background:#fff;border:2px solid #dc3545}.upload-prompt[_ngcontent-%COMP%]{color:#6c757d}.upload-icon[_ngcontent-%COMP%]{font-size:3rem;color:#28a745;margin-bottom:15px}.upload-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.error-messages[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]{padding:8px 12px;margin-bottom:5px;font-size:.9rem}.alert-sm[_ngcontent-%COMP%]{padding:8px 12px;font-size:.9rem}.action-buttons[_ngcontent-%COMP%]{text-align:center}@media (max-width: 576px){.upload-zone[_ngcontent-%COMP%]{padding:15px;min-height:150px}.preview-img[_ngcontent-%COMP%]{height:150px}.upload-icon[_ngcontent-%COMP%]{font-size:2rem}}"]})}return i})()},6562:(v,f,p)=>{p.d(f,{o:()=>h});var o=p(2615),e=p(9330),l=p(5479);let h=(()=>{class g{http=(0,o.WQX)(e.Qq);getProductorPorUsuario(s){return this.http.get(l.Sn.PRODUCTORES.GET_BY_USER_ID(s))}updateProductor(s,c){return this.http.put(l.Sn.PRODUCTORES.UPDATE_BY_USER_ID(s),c)}getArticulosProductor(s){return this.http.get(l.Sn.PRODUCTORES.GET_ARTICULOS_BY_PRODUCTOR(s))}createArticulo(s,c){return this.http.post(l.Sn.PRODUCTORES.CREATE_ARTICULO_BY_PRODUCTOR(s),c)}updateArticulo(s,c,_){return this.http.put(l.Sn.PRODUCTORES.UPDATE_ARTICULO_BY_PRODUCTOR(s,c),_)}deleteArticulo(s,c){return this.http.delete(l.Sn.PRODUCTORES.DELETE_ARTICULO_BY_PRODUCTOR(s,c))}getCategorias(){return this.http.get(l.Sn.CATEGORIAS.GET_ALL)}createCategoria(s){return this.http.post(l.Sn.CATEGORIAS.CREATE,s)}updateCategoria(s,c){return this.http.put(l.Sn.CATEGORIAS.UPDATE(s),c)}deleteCategoria(s){return this.http.delete(l.Sn.CATEGORIAS.DELETE(s))}getEstadisticasProductor(s){return this.http.get(`${l.Sn.PRODUCTORES.BASE}/${s}/estadisticas`)}getPedidosProductor(s){return this.http.get(l.Sn.ORDENES_VENTA_PRODUCTOR.GET_BY_PRODUCTOR(s))}static \u0275fac=function(c){return new(c||g)};static \u0275prov=o.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})()}}]);