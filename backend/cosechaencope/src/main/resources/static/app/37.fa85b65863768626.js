"use strict";(self.webpackChunkcosecha_en_cope=self.webpackChunkcosecha_en_cope||[]).push([[37],{5037:(y,p,d)=>{d.r(p),d.d(p,{PerfilProductorComponent:()=>R});var a=d(2615),s=d(2200),l=d(9417),f=d(6802),m=d(980),_=d(9675),g=d(6562),u=d(4123),n=d(3664);function C(e,c){1&e&&(n.j41(0,"span"),n.EFF(1,"El nombre es obligatorio"),n.k0s())}function P(e,c){1&e&&(n.j41(0,"span"),n.EFF(1,"El nombre debe tener al menos 2 caracteres"),n.k0s())}function b(e,c){if(1&e&&(n.j41(0,"div",13),n.nVh(1,C,2,0,"span"),n.nVh(2,P,2,0,"span"),n.k0s()),2&e){let o,t;const r=n.XpG(2);n.R7$(),n.vxM(null!=(o=r.form.get("nombre"))&&null!=o.errors&&o.errors.required?1:-1),n.R7$(),n.vxM(null!=(t=r.form.get("nombre"))&&null!=t.errors&&t.errors.minlength?2:-1)}}function x(e,c){1&e&&(n.j41(0,"span"),n.EFF(1,"La direcci\xf3n es obligatoria"),n.k0s())}function h(e,c){if(1&e&&(n.j41(0,"div",13),n.nVh(1,x,2,0,"span"),n.k0s()),2&e){let o;const t=n.XpG(2);n.R7$(),n.vxM(null!=(o=t.form.get("direccion"))&&null!=o.errors&&o.errors.required?1:-1)}}function M(e,c){1&e&&(n.j41(0,"span"),n.EFF(1,"El tel\xe9fono es obligatorio"),n.k0s())}function O(e,c){1&e&&(n.j41(0,"span"),n.EFF(1,"Introduce un tel\xe9fono v\xe1lido (9 d\xedgitos)"),n.k0s())}function v(e,c){if(1&e&&(n.j41(0,"div",13),n.nVh(1,M,2,0,"span"),n.nVh(2,O,2,0,"span"),n.k0s()),2&e){let o,t;const r=n.XpG(2);n.R7$(),n.vxM(null!=(o=r.form.get("telefono"))&&null!=o.errors&&o.errors.required?1:-1),n.R7$(),n.vxM(null!=(t=r.form.get("telefono"))&&null!=t.errors&&t.errors.pattern?2:-1)}}function E(e,c){if(1&e&&(n.j41(0,"div",7)(1,"h2"),n.EFF(2,"Informaci\xf3n de la Cuenta"),n.k0s(),n.j41(3,"div",23)(4,"div",24)(5,"label"),n.EFF(6,"Email de la cuenta"),n.k0s(),n.j41(7,"p"),n.EFF(8),n.k0s()(),n.j41(9,"div",24)(10,"label"),n.EFF(11,"Fecha de registro"),n.k0s(),n.j41(12,"p"),n.EFF(13),n.nI1(14,"date"),n.k0s()(),n.j41(15,"div",24)(16,"label"),n.EFF(17,"Tipo de usuario"),n.k0s(),n.j41(18,"span",25),n.EFF(19),n.k0s()(),n.j41(20,"div",24)(21,"label"),n.EFF(22,"ID del productor"),n.k0s(),n.j41(23,"p"),n.EFF(24),n.k0s()()()()),2&e){const o=n.XpG(2);n.R7$(8),n.JRh(null==o.currentUser?null:o.currentUser.email),n.R7$(5),n.JRh(n.i5U(14,4,o.productor.fechaRegistro,"dd/MM/yyyy")),n.R7$(6),n.JRh(null==o.currentUser?null:o.currentUser.tipoUsuario),n.R7$(5),n.SpI("#",o.productor.idProductor)}}function k(e,c){1&e&&n.nrm(0,"i",21)}function F(e,c){1&e&&n.nrm(0,"div",22)}function j(e,c){if(1&e){const o=n.RV6();n.j41(0,"div",4)(1,"form",6),n.bIt("ngSubmit",function(){a.eBV(o);const r=n.XpG();return a.Njj(r.onSubmit())}),n.j41(2,"div",7)(3,"h2"),n.EFF(4,"Imagen de la Empresa"),n.k0s(),n.j41(5,"app-image-upload-panel",8),n.bIt("imageUploaded",function(r){a.eBV(o);const i=n.XpG();return a.Njj(i.onImageUploaded(r))})("imageRemoved",function(){a.eBV(o);const r=n.XpG();return a.Njj(r.onImageRemoved())}),n.k0s()(),n.j41(6,"div",7)(7,"h2"),n.EFF(8,"Informaci\xf3n de la Empresa"),n.k0s(),n.j41(9,"div",9)(10,"div",10)(11,"label",11),n.EFF(12,"Nombre de la Empresa *"),n.k0s(),n.nrm(13,"input",12),n.nVh(14,b,3,2,"div",13),n.k0s()(),n.j41(15,"div",9)(16,"div",10)(17,"label",14),n.EFF(18,"Direcci\xf3n *"),n.k0s(),n.nrm(19,"textarea",15),n.nVh(20,h,2,1,"div",13),n.k0s()(),n.j41(21,"div",9)(22,"div",10)(23,"label",16),n.EFF(24,"Tel\xe9fono de Contacto *"),n.k0s(),n.nrm(25,"input",17),n.nVh(26,v,3,2,"div",13),n.k0s()()(),n.nVh(27,E,25,7,"div",7),n.j41(28,"div",18)(29,"button",19),n.bIt("click",function(){a.eBV(o);const r=n.XpG();return a.Njj(r.goBack())}),n.EFF(30,"Cancelar"),n.k0s(),n.j41(31,"button",20),n.nVh(32,k,1,0,"i",21),n.nVh(33,F,1,0,"div",22),n.EFF(34),n.k0s()()()()}if(2&e){let o,t,r;const i=n.XpG();n.R7$(),n.Y8G("formGroup",i.form),n.R7$(4),n.Y8G("currentImageUrl",i.form.value.imagenUrl||void 0),n.R7$(9),n.vxM(null!=(o=i.form.get("nombre"))&&o.touched&&null!=(o=i.form.get("nombre"))&&o.errors?14:-1),n.R7$(6),n.vxM(null!=(t=i.form.get("direccion"))&&t.touched&&null!=(t=i.form.get("direccion"))&&t.errors?20:-1),n.R7$(6),n.vxM(null!=(r=i.form.get("telefono"))&&r.touched&&null!=(r=i.form.get("telefono"))&&r.errors?26:-1),n.R7$(),n.vxM(i.productor?27:-1),n.R7$(4),n.Y8G("disabled",i.form.invalid||i.saving),n.R7$(),n.vxM(i.saving?-1:32),n.R7$(),n.vxM(i.saving?33:-1),n.R7$(),n.SpI(" ",i.saving?"Guardando...":"Guardar Cambios"," ")}}function U(e,c){1&e&&(n.j41(0,"div",5),n.nrm(1,"div",26),n.j41(2,"p"),n.EFF(3,"Cargando perfil..."),n.k0s()())}let R=(()=>{class e{fb=(0,a.WQX)(l.ok);userStore=(0,a.WQX)(_.w);productorService=(0,a.WQX)(g.o);router=(0,a.WQX)(f.Ix);productor=null;loading=!0;saving=!1;currentUser=this.userStore.snapshot();form=this.fb.nonNullable.group({nombre:["",[l.k0.required,l.k0.minLength(2)]],direccion:["",[l.k0.required]],telefono:["",[l.k0.required,l.k0.pattern(/^[0-9]{9}$/)]],imagenUrl:[""]});ngOnInit(){this.currentUser&&"PRODUCTOR"===this.currentUser.tipoUsuario?this.loadProductor():this.router.navigateByUrl("/login/productores")}loadProductor(){this.currentUser&&this.productorService.getProductorPorUsuario(this.currentUser.idUsuario).subscribe({next:o=>{this.productor=o,this.form.patchValue({nombre:o.nombre,direccion:o.direccion,telefono:o.telefono,imagenUrl:o.imagenUrl}),this.loading=!1},error:()=>{this.loading=!1}})}onImageUploaded(o){this.form.patchValue({imagenUrl:o})}onImageRemoved(){this.form.patchValue({imagenUrl:""})}onSubmit(){if(this.form.invalid||!this.productor)return;this.saving=!0;const o=this.form.getRawValue();this.productorService.updateProductor(this.currentUser.idUsuario,{idUsuario:this.currentUser.idUsuario,nombre:o.nombre,direccion:o.direccion,telefono:o.telefono,imagenUrl:o.imagenUrl}).pipe((0,m.j)(()=>this.saving=!1)).subscribe({next:r=>{this.productor=r,alert("Perfil actualizado correctamente")},error:r=>{console.error("Error updating profile:",r),alert("Error al actualizar el perfil. Int\xe9ntalo de nuevo.")}})}goBack(){this.router.navigateByUrl("/productor/dashboard")}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=n.VBU({type:e,selectors:[["app-perfil-productor"]],decls:9,vars:1,consts:[[1,"perfil-container"],[1,"perfil-header"],[1,"btn-back",3,"click"],[1,"fas","fa-arrow-left"],[1,"perfil-content"],[1,"loading-container"],[1,"perfil-form",3,"ngSubmit","formGroup"],[1,"form-section"],["uploadType","perfil",3,"imageUploaded","imageRemoved","currentImageUrl"],[1,"form-row"],[1,"form-group"],["for","nombre"],["type","text","id","nombre","formControlName","nombre","placeholder","Ej: Huerta Los Olivos",1,"form-control"],[1,"field-error"],["for","direccion"],["id","direccion","formControlName","direccion","rows","3","placeholder","Direcci\xf3n completa de la empresa o finca",1,"form-control"],["for","telefono"],["type","tel","id","telefono","formControlName","telefono","placeholder","123456789",1,"form-control"],[1,"form-actions"],["type","button",1,"btn","btn--outline",3,"click"],["type","submit",1,"btn","btn--primary",3,"disabled"],[1,"fas","fa-save"],[1,"button-spinner"],[1,"info-grid"],[1,"info-item"],[1,"badge","badge--green"],[1,"spinner"]],template:function(t,r){1&t&&(n.j41(0,"div",0)(1,"div",1)(2,"button",2),n.bIt("click",function(){return r.goBack()}),n.nrm(3,"i",3),n.EFF(4," Volver al Dashboard "),n.k0s(),n.j41(5,"h1"),n.EFF(6,"Mi Perfil de Productor"),n.k0s()(),n.nVh(7,j,35,10,"div",4)(8,U,4,0,"div",5),n.k0s()),2&t&&(n.R7$(7),n.vxM(r.loading?8:7))},dependencies:[s.MD,l.X1,l.qT,l.me,l.BC,l.cb,l.j4,l.JD,u._,s.vh],styles:[".perfil-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#f5f5f5;padding:20px}.perfil-header[_ngcontent-%COMP%]{margin-bottom:30px}.perfil-header[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]{background:none;border:none;color:#64748b;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:8px;margin-bottom:15px;padding:8px 0;transition:color .3s ease}.perfil-header[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]:hover{color:#4caf50}.perfil-header[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.perfil-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#1a202c;margin:0}.perfil-content[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.perfil-form[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 4px 6px #00000012;overflow:hidden}.form-section[_ngcontent-%COMP%]{padding:30px;border-bottom:1px solid rgba(34,34,34,.12)}.form-section[_ngcontent-%COMP%]:last-child{border-bottom:none}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#222;margin:0 0 25px;padding-bottom:10px;border-bottom:2px solid #574b51;display:inline-block}.image-upload-container[_ngcontent-%COMP%]{display:flex;gap:30px;align-items:flex-start}@media (max-width: 768px){.image-upload-container[_ngcontent-%COMP%]{flex-direction:column;gap:20px}}.image-preview[_ngcontent-%COMP%]{position:relative;width:200px;height:200px;border-radius:12px;overflow:hidden;border:3px solid rgba(34,34,34,.12);background-color:#f5f5f5}.image-preview[_ngcontent-%COMP%]   .preview-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.image-preview[_ngcontent-%COMP%]   .upload-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#000000b3;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff}.image-preview[_ngcontent-%COMP%]   .upload-overlay[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:30px;height:30px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:10px}.image-preview[_ngcontent-%COMP%]   .upload-overlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;margin:0}.upload-controls[_ngcontent-%COMP%]{flex:1}.upload-controls[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{display:none}.upload-controls[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;cursor:pointer;margin-bottom:15px}.upload-controls[_ngcontent-%COMP%]   .upload-hint[_ngcontent-%COMP%]{font-size:14px;color:#64748b;margin:0;line-height:1.4}.form-row[_ngcontent-%COMP%]{margin-bottom:25px}.form-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:600;color:#222;margin-bottom:8px}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:2px solid rgba(34,34,34,.12);border-radius:8px;font-size:16px;transition:all .25s ease-in-out;background-color:#fff}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#574b51;box-shadow:0 0 0 3px #574b511a}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:#2226}.form-group[_ngcontent-%COMP%]   .form-control.error[_ngcontent-%COMP%]{border-color:#d32f2f}.form-group[_ngcontent-%COMP%]   .form-control.error[_ngcontent-%COMP%]:focus{border-color:#d32f2f;box-shadow:0 0 0 3px #d32f2f1a}.form-group[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:100px;font-family:inherit}.field-error[_ngcontent-%COMP%]{margin-top:8px;font-size:14px;color:#d32f2f;font-weight:500}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:600;color:#64748b;margin-bottom:5px}.info-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#1a202c;margin:0;font-weight:500}.badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:4px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.badge--green[_ngcontent-%COMP%]{background-color:#2e7d321a;color:#133214}.form-actions[_ngcontent-%COMP%]{padding:25px 30px;background-color:#f5f5f5;display:flex;gap:15px;justify-content:flex-end}@media (max-width: 768px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}}.btn[_ngcontent-%COMP%]{padding:12px 24px;border-radius:8px;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;gap:4px;border:none;cursor:pointer;transition:all .25s ease-in-out;justify-content:center;min-width:120px}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn--primary[_ngcontent-%COMP%]{background:#574b51;color:#fff}.btn--primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#41383d;transform:translateY(-1px)}.btn--outline[_ngcontent-%COMP%]{background:transparent;color:#574b51;border:2px solid #574b51}.btn--outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#574b51;color:#fff}.button-spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px}.loading-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid rgba(34,34,34,.12);border-top:3px solid #574b51;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#2229;font-size:16px;margin:0}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.perfil-container[_ngcontent-%COMP%]{padding:15px}.perfil-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:28px}.form-section[_ngcontent-%COMP%], .form-actions[_ngcontent-%COMP%]{padding:20px}.info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}return e})()}}]);