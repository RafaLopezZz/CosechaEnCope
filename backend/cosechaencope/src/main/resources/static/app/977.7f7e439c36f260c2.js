"use strict";(self.webpackChunkcosecha_en_cope=self.webpackChunkcosecha_en_cope||[]).push([[977],{5977:(D,f,i)=>{i.r(f),i.d(f,{PerfilClienteComponent:()=>T});var l=i(2615),s=i(2200),t=i(9417),p=i(6802),g=i(980),u=i(9675),_=i(4730),n=i(3664);function m(o,r){if(1&o&&(n.j41(0,"div",12)(1,"label"),n.EFF(2,"Miembro desde:"),n.k0s(),n.j41(3,"span"),n.EFF(4),n.nI1(5,"date"),n.k0s()()),2&o){const e=n.XpG(2);n.R7$(4),n.JRh(n.i5U(5,1,e.cliente.fechaRegistro,"dd/MM/yyyy"))}}function C(o,r){if(1&o&&(n.j41(0,"div",41),n.EFF(1),n.k0s()),2&o){const e=n.XpG(2);n.R7$(),n.SpI(" ",e.successMessage," ")}}function b(o,r){if(1&o&&(n.j41(0,"div",42),n.EFF(1),n.k0s()),2&o){const e=n.XpG(2);n.R7$(),n.SpI(" ",e.errorMessage," ")}}function x(o,r){1&o&&(n.j41(0,"span"),n.EFF(1,"El nombre es obligatorio"),n.k0s())}function h(o,r){1&o&&(n.j41(0,"span"),n.EFF(1,"El nombre debe tener al menos 3 caracteres"),n.k0s())}function P(o,r){if(1&o&&(n.j41(0,"div",43),n.DNE(1,x,2,0,"span",44)(2,h,2,0,"span",44),n.k0s()),2&o){const e=n.XpG(2);n.R7$(),n.Y8G("ngIf",null==e.nombreControl||null==e.nombreControl.errors?null:e.nombreControl.errors.required),n.R7$(),n.Y8G("ngIf",null==e.nombreControl||null==e.nombreControl.errors?null:e.nombreControl.errors.minlength)}}function M(o,r){1&o&&(n.j41(0,"span"),n.EFF(1,"La direcci\xf3n es obligatoria"),n.k0s())}function v(o,r){1&o&&(n.j41(0,"span"),n.EFF(1,"La direcci\xf3n debe ser m\xe1s completa (m\xednimo 10 caracteres)"),n.k0s())}function O(o,r){if(1&o&&(n.j41(0,"div",43),n.DNE(1,M,2,0,"span",44)(2,v,2,0,"span",44),n.k0s()),2&o){const e=n.XpG(2);n.R7$(),n.Y8G("ngIf",null==e.direccionControl||null==e.direccionControl.errors?null:e.direccionControl.errors.required),n.R7$(),n.Y8G("ngIf",null==e.direccionControl||null==e.direccionControl.errors?null:e.direccionControl.errors.minlength)}}function E(o,r){1&o&&(n.j41(0,"span"),n.EFF(1,"El tel\xe9fono es obligatorio"),n.k0s())}function F(o,r){1&o&&(n.j41(0,"span"),n.EFF(1,"El tel\xe9fono debe tener 9 d\xedgitos"),n.k0s())}function k(o,r){if(1&o&&(n.j41(0,"div",43),n.DNE(1,E,2,0,"span",44)(2,F,2,0,"span",44),n.k0s()),2&o){const e=n.XpG(2);n.R7$(),n.Y8G("ngIf",null==e.telefonoControl||null==e.telefonoControl.errors?null:e.telefonoControl.errors.required),n.R7$(),n.Y8G("ngIf",null==e.telefonoControl||null==e.telefonoControl.errors?null:e.telefonoControl.errors.pattern)}}function j(o,r){1&o&&n.nrm(0,"i",45)}function I(o,r){1&o&&n.nrm(0,"i",46)}function y(o,r){if(1&o){const e=n.RV6();n.j41(0,"div",7)(1,"div",8)(2,"div",9),n.nrm(3,"i",10),n.j41(4,"h2"),n.EFF(5,"Informaci\xf3n de Cuenta"),n.k0s()(),n.j41(6,"div",11)(7,"div",12)(8,"label"),n.EFF(9,"Email:"),n.k0s(),n.j41(10,"span"),n.EFF(11),n.k0s()(),n.j41(12,"div",12)(13,"label"),n.EFF(14,"Tipo de cuenta:"),n.k0s(),n.j41(15,"span",13),n.EFF(16,"Cliente"),n.k0s()(),n.DNE(17,m,6,4,"div",14),n.k0s()(),n.j41(18,"div",15)(19,"div",16),n.nrm(20,"i",17),n.j41(21,"h2"),n.EFF(22,"Datos Personales"),n.k0s()(),n.DNE(23,C,2,1,"div",18)(24,b,2,1,"div",19),n.j41(25,"form",20),n.bIt("ngSubmit",function(){l.eBV(e);const a=n.XpG();return l.Njj(a.onSubmit())}),n.j41(26,"div",21)(27,"label",22),n.nrm(28,"i",23),n.EFF(29," Nombre Completo * "),n.k0s(),n.nrm(30,"input",24),n.DNE(31,P,3,2,"div",25),n.k0s(),n.j41(32,"div",21)(33,"label",26),n.nrm(34,"i",27),n.EFF(35," Direcci\xf3n de Env\xedo * "),n.k0s(),n.nrm(36,"textarea",28),n.DNE(37,O,3,2,"div",25),n.j41(38,"small",29),n.nrm(39,"i",10),n.EFF(40," Esta direcci\xf3n se usar\xe1 para las entregas de tus pedidos "),n.k0s()(),n.j41(41,"div",21)(42,"label",30),n.nrm(43,"i",31),n.EFF(44," Tel\xe9fono de Contacto * "),n.k0s(),n.nrm(45,"input",32),n.DNE(46,k,3,2,"div",25),n.j41(47,"small",29),n.nrm(48,"i",10),n.EFF(49," Solo n\xfameros, sin espacios (9 d\xedgitos) "),n.k0s()(),n.j41(50,"div",33)(51,"button",34),n.bIt("click",function(){l.eBV(e);const a=n.XpG();return l.Njj(a.goBack())}),n.nrm(52,"i",35),n.EFF(53," Cancelar "),n.k0s(),n.j41(54,"button",36),n.DNE(55,j,1,0,"i",37)(56,I,1,0,"i",38),n.EFF(57),n.k0s()()()(),n.j41(58,"div",39),n.nrm(59,"i",40),n.j41(60,"h3"),n.EFF(61,"Consejos"),n.k0s(),n.j41(62,"ul")(63,"li"),n.EFF(64,"Mant\xe9n tu direcci\xf3n actualizada para recibir tus pedidos sin problemas"),n.k0s(),n.j41(65,"li"),n.EFF(66,"El tel\xe9fono es importante para que el productor pueda contactarte"),n.k0s(),n.j41(67,"li"),n.EFF(68,"Tu email no se puede cambiar desde aqu\xed por seguridad"),n.k0s()()()()}if(2&o){const e=n.XpG();n.R7$(11),n.JRh(null==e.currentUser?null:e.currentUser.email),n.R7$(6),n.Y8G("ngIf",e.cliente),n.R7$(6),n.Y8G("ngIf",e.successMessage),n.R7$(),n.Y8G("ngIf",e.errorMessage),n.R7$(),n.Y8G("formGroup",e.form),n.R7$(5),n.AVh("is-invalid",(null==e.nombreControl?null:e.nombreControl.invalid)&&(null==e.nombreControl?null:e.nombreControl.touched)),n.R7$(),n.Y8G("ngIf",(null==e.nombreControl?null:e.nombreControl.invalid)&&(null==e.nombreControl?null:e.nombreControl.touched)),n.R7$(5),n.AVh("is-invalid",(null==e.direccionControl?null:e.direccionControl.invalid)&&(null==e.direccionControl?null:e.direccionControl.touched)),n.R7$(),n.Y8G("ngIf",(null==e.direccionControl?null:e.direccionControl.invalid)&&(null==e.direccionControl?null:e.direccionControl.touched)),n.R7$(8),n.AVh("is-invalid",(null==e.telefonoControl?null:e.telefonoControl.invalid)&&(null==e.telefonoControl?null:e.telefonoControl.touched)),n.R7$(),n.Y8G("ngIf",(null==e.telefonoControl?null:e.telefonoControl.invalid)&&(null==e.telefonoControl?null:e.telefonoControl.touched)),n.R7$(5),n.Y8G("disabled",e.saving),n.R7$(3),n.Y8G("disabled",e.form.invalid||e.saving),n.R7$(),n.Y8G("ngIf",e.saving),n.R7$(),n.Y8G("ngIf",!e.saving),n.R7$(),n.SpI(" ",e.saving?"Guardando...":"Guardar Cambios"," ")}}function R(o,r){1&o&&(n.j41(0,"div",47),n.nrm(1,"div",48),n.j41(2,"p"),n.EFF(3,"Cargando tu perfil..."),n.k0s()())}let T=(()=>{class o{fb=(0,l.WQX)(t.ok);userStore=(0,l.WQX)(u.w);clienteService=(0,l.WQX)(_.M);router=(0,l.WQX)(p.Ix);cliente=null;loading=!0;saving=!1;successMessage="";errorMessage="";currentUser=this.userStore.snapshot();form=this.fb.nonNullable.group({nombre:["",[t.k0.required,t.k0.minLength(3)]],direccion:["",[t.k0.required,t.k0.minLength(10)]],telefono:["",[t.k0.required,t.k0.pattern(/^[0-9]{9}$/)]]});ngOnInit(){this.currentUser&&"CLIENTE"===this.currentUser.tipoUsuario?this.loadCliente():this.router.navigateByUrl("/cliente/login")}loadCliente(){this.currentUser&&this.clienteService.getClientePorUsuario(this.currentUser.idUsuario).subscribe({next:e=>{this.cliente=e,this.form.patchValue({nombre:e.nombre||"",direccion:e.direccion,telefono:e.telefono}),this.loading=!1},error:e=>{console.error("Error al cargar cliente:",e),this.errorMessage="Error al cargar tus datos. Int\xe9ntalo de nuevo.",this.loading=!1}})}onSubmit(){if(this.form.invalid||!this.cliente)return;this.saving=!0,this.successMessage="",this.errorMessage="";const e=this.form.getRawValue();this.clienteService.updateCliente(this.currentUser.idUsuario,{idUsuario:this.currentUser.idUsuario,nombre:e.nombre,direccion:e.direccion,telefono:e.telefono}).pipe((0,g.j)(()=>this.saving=!1)).subscribe({next:a=>{this.cliente=a,this.successMessage="\u2705 Perfil actualizado correctamente",setTimeout(()=>this.successMessage="",5e3)},error:a=>{console.error("Error updating profile:",a),this.errorMessage="\u274c Error al actualizar el perfil. Int\xe9ntalo de nuevo.",setTimeout(()=>this.errorMessage="",5e3)}})}goBack(){this.router.navigateByUrl("/cliente/dashboard")}get nombreControl(){return this.form.get("nombre")}get direccionControl(){return this.form.get("direccion")}get telefonoControl(){return this.form.get("telefono")}static \u0275fac=function(c){return new(c||o)};static \u0275cmp=n.VBU({type:o,selectors:[["app-perfil-cliente"]],decls:11,vars:2,consts:[["loadingTemplate",""],[1,"perfil-container"],[1,"perfil-header"],[1,"btn-back",3,"click"],[1,"fas","fa-arrow-left"],[1,"fas","fa-user-edit"],["class","perfil-content",4,"ngIf","ngIfElse"],[1,"perfil-content"],[1,"info-card"],[1,"info-card__header"],[1,"fas","fa-info-circle"],[1,"info-card__body"],[1,"info-item"],[1,"badge","badge--primary"],["class","info-item",4,"ngIf"],[1,"form-card"],[1,"form-card__header"],[1,"fas","fa-edit"],["class","alert alert--success",4,"ngIf"],["class","alert alert--error",4,"ngIf"],[1,"form-card__body",3,"ngSubmit","formGroup"],[1,"form-group"],["for","nombre"],[1,"fas","fa-user"],["type","text","id","nombre","formControlName","nombre","placeholder","Ej: Juan Garc\xeda L\xf3pez"],["class","form-error",4,"ngIf"],["for","direccion"],[1,"fas","fa-map-marker-alt"],["id","direccion","formControlName","direccion","rows","3","placeholder","Ej: Calle Mayor 123, Bajo A, 28001 Madrid"],[1,"form-hint"],["for","telefono"],[1,"fas","fa-phone"],["type","tel","id","telefono","formControlName","telefono","placeholder","Ej: 612345678","maxlength","9"],[1,"form-actions"],["type","button",1,"btn","btn--outline",3,"click","disabled"],[1,"fas","fa-times"],["type","submit",1,"btn","btn--primary",3,"disabled"],["class","fas fa-spinner fa-spin",4,"ngIf"],["class","fas fa-save",4,"ngIf"],[1,"help-card"],[1,"fas","fa-lightbulb"],[1,"alert","alert--success"],[1,"alert","alert--error"],[1,"form-error"],[4,"ngIf"],[1,"fas","fa-spinner","fa-spin"],[1,"fas","fa-save"],[1,"loading-container"],[1,"spinner"]],template:function(c,a){if(1&c){const d=n.RV6();n.j41(0,"div",1)(1,"div",2)(2,"button",3),n.bIt("click",function(){return l.eBV(d),l.Njj(a.goBack())}),n.nrm(3,"i",4),n.EFF(4," Volver al Panel "),n.k0s(),n.j41(5,"h1"),n.nrm(6,"i",5),n.EFF(7," Mi Perfil "),n.k0s()(),n.DNE(8,y,69,19,"div",6)(9,R,4,0,"ng-template",null,0,n.C5r),n.k0s()}if(2&c){const d=n.sdS(10);n.R7$(8),n.Y8G("ngIf",!a.loading)("ngIfElse",d)}},dependencies:[s.MD,s.bT,t.X1,t.qT,t.me,t.BC,t.cb,t.tU,t.j4,t.JD,s.vh],styles:['@charset "UTF-8";.perfil-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#f5f5f5;padding:40px 20px}.perfil-header[_ngcontent-%COMP%]{max-width:800px;margin:0 auto 30px}.perfil-header[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]{background:transparent;border:1px solid rgba(34,34,34,.12);color:#222222b3;padding:10px 20px;border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;font-weight:500;transition:all .25s ease-in-out;margin-bottom:20px}.perfil-header[_ngcontent-%COMP%]   .btn-back[_ngcontent-%COMP%]:hover{background:#fff;color:#574b51}.perfil-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#222;font-size:32px;font-weight:700;margin:0}.perfil-content[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;display:flex;flex-direction:column;gap:20px}.info-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 4px 6px #00000012;overflow:hidden}.info-card__header[_ngcontent-%COMP%]{background:#2e8a99;color:#fff;padding:20px;display:flex;align-items:center;gap:8px}.info-card__header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600}.info-card__body[_ngcontent-%COMP%]{padding:24px;display:flex;flex-direction:column;gap:16px}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px;background:#f5f5f5;border-radius:8px}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#222222b3;font-size:14px}.info-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#222;font-size:15px}.badge[_ngcontent-%COMP%]{padding:6px 14px;border-radius:9999px;font-size:13px;font-weight:600}.badge--primary[_ngcontent-%COMP%]{background:#2e8a991a;color:#2e8a99}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 4px 6px #00000012;overflow:hidden}.form-card__header[_ngcontent-%COMP%]{background:#574b51;color:#fff;padding:20px;display:flex;align-items:center;gap:8px}.form-card__header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600}.form-card__body[_ngcontent-%COMP%]{padding:30px}.alert[_ngcontent-%COMP%]{padding:14px 18px;border-radius:8px;margin-bottom:20px;display:flex;align-items:center;gap:10px;font-weight:500}.alert--success[_ngcontent-%COMP%]{background:#2e7d321a;color:#133214;border:1px solid rgba(46,125,50,.3)}.alert--error[_ngcontent-%COMP%]{background:#d32f2f1a;color:#ab2424;border:1px solid rgba(211,47,47,.3)}.form-group[_ngcontent-%COMP%]{margin-bottom:24px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#222;margin-bottom:8px;font-size:14px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:12px 16px;border:2px solid rgba(34,34,34,.12);border-radius:8px;font-size:15px;transition:all .25s ease-in-out;font-family:inherit}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#574b51;box-shadow:0 0 0 3px #574b511a}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:#2226}.form-group[_ngcontent-%COMP%]   input.is-invalid[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea.is-invalid[_ngcontent-%COMP%]{border-color:#d32f2f}.form-group[_ngcontent-%COMP%]   input.is-invalid[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea.is-invalid[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #d32f2f1a}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.form-error[_ngcontent-%COMP%]{color:#d32f2f;font-size:13px;margin-top:6px}.form-hint[_ngcontent-%COMP%]{color:#2229;font-size:13px;margin-top:6px}.form-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;margin-top:30px;padding-top:24px;border-top:2px solid rgba(34,34,34,.12)}.btn[_ngcontent-%COMP%]{padding:12px 24px;border-radius:8px;font-weight:600;font-size:15px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;transition:all .25s ease-in-out;border:none}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn--primary[_ngcontent-%COMP%]{background:#574b51;color:#fff}.btn--primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#41383d;transform:translateY(-1px)}.btn--outline[_ngcontent-%COMP%]{background:transparent;color:#222222b3;border:2px solid rgba(34,34,34,.12)}.btn--outline[_ngcontent-%COMP%]:hover:not(:disabled){border-color:#574b51;color:#574b51;background:#574b510d}.help-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 4px 6px #00000012;padding:24px;border-left:4px solid #F57C00}.help-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#222;margin:0 0 16px}.help-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.help-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:10px 0 10px 20px;color:#222222b3;font-size:14px;line-height:1.5;position:relative}.help-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:"\\2022";position:absolute;left:0;color:#2e7d32;font-weight:700;font-size:20px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:80px 20px}.loading-container[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid rgba(34,34,34,.12);border-top:4px solid #574b51;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:20px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#222222b3;font-size:18px;font-weight:500}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.perfil-container[_ngcontent-%COMP%]{padding:20px 15px}.perfil-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:26px}.info-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:6px}.form-card__body[_ngcontent-%COMP%]{padding:20px}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%;justify-content:center}}']})}return o})()}}]);