"use strict";(self.webpackChunkcosecha_en_cope=self.webpackChunkcosecha_en_cope||[]).push([[652],{2173:(M,v,p)=>{p.d(v,{_:()=>C});var o=p(2615),e=p(3664),s=p(2200),E=p(4965),i=p(9675),g=p(5373);function r(l,f){if(1&l&&(e.j41(0,"div",11),e.nrm(1,"img",12),e.j41(2,"div",13),e.nrm(3,"i",14),e.j41(4,"p"),e.EFF(5,"Click para cambiar imagen"),e.k0s()()()),2&l){const t=e.XpG();e.R7$(),e.Y8G("src",t.currentImageUrl,e.B4B)("alt","Imagen actual")}}function a(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",15),e.nrm(1,"img",12),e.j41(2,"div",16)(3,"p",17),e.EFF(4),e.k0s(),e.j41(5,"p",18),e.EFF(6),e.k0s()(),e.j41(7,"button",19),e.bIt("click",function(n){o.eBV(t);const m=e.XpG();return o.Njj(m.removeFile(n))}),e.nrm(8,"i",20),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("src",t.previewUrl,e.B4B)("alt",t.selectedFile.name),e.R7$(3),e.JRh(t.selectedFile.name),e.R7$(2),e.JRh(t.formatFileSize(t.selectedFile.size))}}function u(l,f){1&l&&(e.j41(0,"div",21),e.nrm(1,"i",22),e.j41(2,"h5"),e.EFF(3,"Subir Imagen"),e.k0s(),e.j41(4,"p"),e.EFF(5,"Arrastra una imagen aqu\xed o click para seleccionar"),e.k0s(),e.j41(6,"small",23),e.EFF(7,"JPG, PNG, GIF, WEBP - M\xe1ximo 10MB"),e.k0s()())}function d(l,f){1&l&&(e.j41(0,"div",24)(1,"div",25)(2,"span",26),e.EFF(3,"Subiendo..."),e.k0s()(),e.j41(4,"p",27),e.EFF(5,"Subiendo imagen..."),e.k0s()())}function U(l,f){if(1&l&&(e.j41(0,"div",30),e.nrm(1,"i",31),e.EFF(2),e.k0s()),2&l){const t=f.$implicit;e.R7$(2),e.SpI(" ",t," ")}}function P(l,f){if(1&l&&(e.j41(0,"div",28),e.DNE(1,U,3,1,"div",29),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.errorMessages)}}function I(l,f){if(1&l&&(e.j41(0,"div",32),e.nrm(1,"i",33),e.EFF(2),e.k0s()),2&l){const t=e.XpG();e.R7$(2),e.SpI(" ",t.successMessage," ")}}function O(l,f){if(1&l){const t=e.RV6();e.j41(0,"div",34)(1,"button",35),e.bIt("click",function(){o.eBV(t);const n=e.XpG();return o.Njj(n.uploadFile())}),e.nrm(2,"i",36),e.EFF(3," Subir Imagen "),e.k0s(),e.j41(4,"button",37),e.bIt("click",function(){o.eBV(t);const n=e.XpG();return o.Njj(n.cancelUpload())}),e.nrm(5,"i",20),e.EFF(6," Cancelar "),e.k0s()()}if(2&l){const t=e.XpG();e.R7$(),e.Y8G("disabled",t.hasError)}}let C=(()=>{class l{imagenService=(0,o.WQX)(E.D);userStore=(0,o.WQX)(i.w);utils=(0,o.WQX)(g.P);currentImageUrl;uploadType="articulo";placeholder="Subir imagen";maxSizeMb=10;allowedMimeTypes=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];imageUploaded=new e.bkB;imageRemoved=new e.bkB;selectedFile=null;previewUrl=null;errorMessages=[];successMessage="";isUploading=!1;isDragOver=!1;get hasError(){return this.errorMessages.length>0}onFileSelected(t){const c=t.target.files[0];c&&this.processFile(c)}onDragOver(t){t.preventDefault(),this.isDragOver=!0}onDragLeave(t){t.preventDefault(),this.isDragOver=!1}onDrop(t){t.preventDefault(),this.isDragOver=!1;const c=t.dataTransfer?.files;c&&c.length>0&&this.processFile(c[0])}processFile(t){this.clearMessages();const c={maxSizeMb:this.maxSizeMb,allowedMimeTypes:this.allowedMimeTypes},n=this.utils.validateFile(t,c);if(!n.valid){const h=this.utils.buildErrorMessage(n,c)??"Archivo inv\xe1lido";return void(this.errorMessages=[h])}this.selectedFile=t;const m=new FileReader;m.onload=h=>{this.previewUrl=h.target?.result},m.readAsDataURL(t)}uploadFile(){if(!this.selectedFile)return;const t=this.userStore.snapshot();if(!t)return void(this.errorMessages=["No hay usuario autenticado"]);let c;switch(this.isUploading=!0,this.clearMessages(),this.uploadType){case"articulo":c=this.imagenService.subirImagenArticulo(this.selectedFile,t.idUsuario,t.tipoUsuario);break;case"categoria":c=this.imagenService.subirImagenCategoria(this.selectedFile,t.idUsuario,t.tipoUsuario);break;case"perfil":c=this.imagenService.subirImagenPerfil(this.selectedFile,t.idUsuario,t.tipoUsuario);break;default:return this.errorMessages=["Tipo de subida no v\xe1lido"],void(this.isUploading=!1)}c.subscribe({next:n=>{this.isUploading=!1,n.success?(this.successMessage=n.message,this.imageUploaded.emit(n.imageUrl),this.currentImageUrl=n.imageUrl,this.selectedFile=null,this.previewUrl=null):this.errorMessages=[n.message]},error:n=>{this.isUploading=!1,this.errorMessages=[n.error?.message||"Error al subir la imagen"]}})}removeFile(t){t.stopPropagation(),this.selectedFile=null,this.previewUrl=null,this.clearMessages()}cancelUpload(){this.selectedFile=null,this.previewUrl=null,this.clearMessages()}removeCurrentImage(){this.currentImageUrl&&this.imagenService.eliminarImagen(this.currentImageUrl).subscribe({next:()=>{this.currentImageUrl=void 0,this.imageRemoved.emit(),this.successMessage="Imagen eliminada correctamente"},error:t=>{this.errorMessages=[t.error?.message||"Error al eliminar la imagen"]}})}formatFileSize(t){return this.utils.formatFileSize(t)}clearMessages(){this.errorMessages=[],this.successMessage=""}static \u0275fac=function(c){return new(c||l)};static \u0275cmp=e.VBU({type:l,selectors:[["app-image-upload-panel"]],inputs:{currentImageUrl:"currentImageUrl",uploadType:"uploadType",placeholder:"placeholder",maxSizeMb:"maxSizeMb",allowedMimeTypes:"allowedMimeTypes"},outputs:{imageUploaded:"imageUploaded",imageRemoved:"imageRemoved"},decls:11,vars:11,consts:[["fileInput",""],[1,"image-upload-container"],[1,"upload-zone",3,"click","dragover","dragleave","drop"],["class","current-image",4,"ngIf"],["class","preview-container",4,"ngIf"],["class","upload-prompt",4,"ngIf"],["class","upload-loading",4,"ngIf"],["type","file","accept","image/*",2,"display","none",3,"change"],["class","error-messages mt-2",4,"ngIf"],["class","alert alert-success alert-sm mt-2",4,"ngIf"],["class","action-buttons mt-3",4,"ngIf"],[1,"current-image"],[1,"preview-img",3,"src","alt"],[1,"overlay"],[1,"fas","fa-camera"],[1,"preview-container"],[1,"file-info"],[1,"file-name"],[1,"file-size"],["type","button","title","Quitar imagen",1,"btn","btn-sm","btn-outline-danger","remove-btn",3,"click"],[1,"fas","fa-times"],[1,"upload-prompt"],[1,"fas","fa-cloud-upload-alt","upload-icon"],[1,"text-muted"],[1,"upload-loading"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"error-messages","mt-2"],["class","alert alert-danger alert-sm",4,"ngFor","ngForOf"],[1,"alert","alert-danger","alert-sm"],[1,"fas","fa-exclamation-triangle"],[1,"alert","alert-success","alert-sm","mt-2"],[1,"fas","fa-check-circle"],[1,"action-buttons","mt-3"],["type","button",1,"btn","btn-primary","me-2",3,"click","disabled"],[1,"fas","fa-upload"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(c,n){if(1&c){const m=e.RV6();e.j41(0,"div",1)(1,"div",2),e.bIt("click",function(){o.eBV(m);const _=e.sdS(7);return o.Njj(_.click())})("dragover",function(_){return o.eBV(m),o.Njj(n.onDragOver(_))})("dragleave",function(_){return o.eBV(m),o.Njj(n.onDragLeave(_))})("drop",function(_){return o.eBV(m),o.Njj(n.onDrop(_))}),e.DNE(2,r,6,2,"div",3)(3,a,9,4,"div",4)(4,u,8,0,"div",5)(5,d,6,0,"div",6),e.k0s(),e.j41(6,"input",7,0),e.bIt("change",function(_){return o.eBV(m),o.Njj(n.onFileSelected(_))}),e.k0s(),e.DNE(8,P,2,1,"div",8)(9,I,3,1,"div",9)(10,O,7,1,"div",10),e.k0s()}2&c&&(e.R7$(),e.AVh("drag-over",n.isDragOver)("has-error",n.hasError),e.R7$(),e.Y8G("ngIf",n.currentImageUrl&&!n.selectedFile),e.R7$(),e.Y8G("ngIf",n.selectedFile&&n.previewUrl),e.R7$(),e.Y8G("ngIf",!n.currentImageUrl&&!n.selectedFile),e.R7$(),e.Y8G("ngIf",n.isUploading),e.R7$(3),e.Y8G("ngIf",n.errorMessages.length>0),e.R7$(),e.Y8G("ngIf",n.successMessage),e.R7$(),e.Y8G("ngIf",n.selectedFile&&!n.isUploading))},dependencies:[s.MD,s.Sq,s.bT],styles:[".image-upload-container[_ngcontent-%COMP%]{width:100%}.upload-zone[_ngcontent-%COMP%]{border:2px dashed #dee2e6;border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:all .3s ease;position:relative;min-height:200px;display:flex;align-items:center;justify-content:center}.upload-zone[_ngcontent-%COMP%]:hover{border-color:#28a745;background-color:#f8f9fa}.upload-zone.drag-over[_ngcontent-%COMP%]{border-color:#28a745;background-color:#e8f5e8}.upload-zone.has-error[_ngcontent-%COMP%]{border-color:#dc3545}.current-image[_ngcontent-%COMP%], .preview-container[_ngcontent-%COMP%]{position:relative;width:100%;max-width:300px;margin:0 auto}.preview-img[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover;border-radius:8px;box-shadow:0 2px 8px #0000001a}.current-image[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000b3;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:8px;opacity:0;transition:opacity .3s ease}.current-image[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.overlay[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:10px}.file-info[_ngcontent-%COMP%]{margin-top:10px;text-align:center}.file-name[_ngcontent-%COMP%]{font-weight:500;margin-bottom:5px;word-break:break-all}.file-size[_ngcontent-%COMP%]{color:#6c757d;font-size:.9rem;margin:0}.remove-btn[_ngcontent-%COMP%]{position:absolute;top:-10px;right:-10px;border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;background:#fff;border:2px solid #dc3545}.upload-prompt[_ngcontent-%COMP%]{color:#6c757d}.upload-icon[_ngcontent-%COMP%]{font-size:3rem;color:#28a745;margin-bottom:15px}.upload-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.error-messages[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]{padding:8px 12px;margin-bottom:5px;font-size:.9rem}.alert-sm[_ngcontent-%COMP%]{padding:8px 12px;font-size:.9rem}.action-buttons[_ngcontent-%COMP%]{text-align:center}@media (max-width: 576px){.upload-zone[_ngcontent-%COMP%]{padding:15px;min-height:150px}.preview-img[_ngcontent-%COMP%]{height:150px}.upload-icon[_ngcontent-%COMP%]{font-size:2rem}}"]})}return l})()},4965:(M,v,p)=>{p.d(v,{D:()=>E});var o=p(2615),e=p(9330),s=p(5293);let E=(()=>{class i{http=(0,o.WQX)(e.Qq);subirImagenArticulo(r,a,u){const d=new FormData;return d.append("file",r),d.append("idUsuario",a.toString()),d.append("tipoUsuario",u),this.http.post(s.Sn.IMAGENES.UPLOAD_ARTICULO,d)}subirImagenCategoria(r,a,u){const d=new FormData;return d.append("file",r),d.append("idUsuario",a.toString()),d.append("tipoUsuario",u),this.http.post(s.Sn.IMAGENES.UPLOAD_CATEGORIA,d)}subirImagenPerfil(r,a,u){const d=new FormData;return d.append("file",r),d.append("idUsuario",a.toString()),d.append("tipoUsuario",u),this.http.post(s.Sn.IMAGENES.UPLOAD_PERFIL,d)}eliminarImagen(r){return this.http.delete(`${s.Sn.IMAGENES.DELETE}?imageUrl=${encodeURIComponent(r)}`)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=o.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})()},5373:(M,v,p)=>{p.d(v,{P:()=>e});var o=p(2615);let e=(()=>{class s{DEFAULT_MAX_SIZE_MB=10;DEFAULT_MIME_TYPES=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];validateFile(i,g={}){const r=[];if(!i)return{valid:!1,errors:["Debe seleccionar un archivo"]};0===i.size&&r.push("El archivo est\xe1 vac\xedo");const a=g.maxSizeMb??this.DEFAULT_MAX_SIZE_MB;i.size>1024*a*1024&&r.push(`El archivo no puede exceder ${a}MB`);const d=g.allowedMimeTypes??this.DEFAULT_MIME_TYPES;if(!d.includes(i.type)){const U=d.map(P=>P.split("/")[1]?.toUpperCase()).join(", ");r.push(`Solo se permiten archivos: ${U}`)}return{valid:0===r.length,errors:r}}formatFileSize(i){if(!Number.isFinite(i)||i<=0)return"0 KB";const g=["Bytes","KB","MB","GB","TB"];let r=i,a=0;for(;r>=1024&&a<g.length-1;)r/=1024,a++;return`${r.toFixed(0===a?0:1)} ${g[a]}`}verificarImagenValida(i){return new Promise(g=>{const r=new Image;r.onload=()=>g(!0),r.onerror=()=>g(!1),r.src=i})}buildErrorMessage(i,g){return i.valid||!i.errors?null:i.errors.includes("size")&&"number"==typeof g.maxSizeMb?`El archivo no puede superar los ${g.maxSizeMb}MB`:i.errors.includes("type")&&g.allowedMimeTypes&&g.allowedMimeTypes.length>0?`Solo se permiten archivos: ${g.allowedMimeTypes.map(a=>a.split("/")[1]?.toUpperCase()??a).join(", ")}`:i.errors.includes("empty")?"Selecciona un archivo":"Archivo inv\xe1lido"}static \u0275fac=function(g){return new(g||s)};static \u0275prov=o.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})()},6562:(M,v,p)=>{p.d(v,{o:()=>E});var o=p(2615),e=p(9330),s=p(5479);let E=(()=>{class i{http=(0,o.WQX)(e.Qq);getProductorPorUsuario(r){return this.http.get(s.Sn.PRODUCTORES.GET_BY_USER_ID(r))}updateProductor(r,a){return this.http.put(s.Sn.PRODUCTORES.UPDATE_BY_USER_ID(r),a)}getArticulosProductor(r){return this.http.get(s.Sn.PRODUCTORES.GET_ARTICULOS_BY_PRODUCTOR(r))}createArticulo(r,a){return this.http.post(s.Sn.PRODUCTORES.CREATE_ARTICULO_BY_PRODUCTOR(r),a)}updateArticulo(r,a,u){return this.http.put(s.Sn.PRODUCTORES.UPDATE_ARTICULO_BY_PRODUCTOR(r,a),u)}deleteArticulo(r,a){return this.http.delete(s.Sn.PRODUCTORES.DELETE_ARTICULO_BY_PRODUCTOR(r,a))}getCategorias(){return this.http.get(s.Sn.CATEGORIAS.GET_ALL)}createCategoria(r){return this.http.post(s.Sn.CATEGORIAS.CREATE,r)}updateCategoria(r,a){return this.http.put(s.Sn.CATEGORIAS.UPDATE(r),a)}deleteCategoria(r){return this.http.delete(s.Sn.CATEGORIAS.DELETE(r))}getEstadisticasProductor(r){return this.http.get(`${s.Sn.PRODUCTORES.BASE}/${r}/estadisticas`)}getPedidosProductor(r){return this.http.get(s.Sn.ORDENES_VENTA_PRODUCTOR.GET_BY_PRODUCTOR(r))}static \u0275fac=function(a){return new(a||i)};static \u0275prov=o.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})()}}]);