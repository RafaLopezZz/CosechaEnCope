"use strict";(self.webpackChunkcosecha_en_cope=self.webpackChunkcosecha_en_cope||[]).push([[846],{1846:(F,l,s)=>{s.r(l),s.d(l,{CarritoViewComponent:()=>E});var e=s(2615),_=s(2200),d=s(6176),m=s(6334),C=s(8605),u=s(7468),t=s(3664);const M=(o,a)=>a.idArticulo;function O(o,a){1&o&&(t.rj2(0,"span",4),t.EFF(1,"Usuario invitado"),t.eux())}function P(o,a){1&o&&(t.rj2(0,"div",5)(1,"p"),t.EFF(2,"Cargando carrito..."),t.eux()())}function p(o,a){if(1&o){const n=t.RV6();t.rj2(0,"div",6)(1,"p"),t.EFF(2),t.eux(),t.rj2(3,"button",9),t.VwU("click",function(){e.eBV(n);const r=t.XpG();return e.Njj(r.cargarCarrito())}),t.EFF(4,"Reintentar"),t.eux()()}if(2&o){const n=t.XpG();t.R7$(2),t.JRh(n.error)}}function h(o,a){1&o&&(t.rj2(0,"div",7)(1,"p"),t.EFF(2,"Tu carrito est\xe1 vac\xedo"),t.eux(),t.rj2(3,"a",10),t.EFF(4,"Ver productos"),t.eux()())}function f(o,a){if(1&o){const n=t.RV6();t.rj2(0,"div",12)(1,"div",19),t.Hgh(2,"img",20),t.eux(),t.rj2(3,"div",21)(4,"h3"),t.EFF(5),t.eux(),t.rj2(6,"p",22),t.EFF(7),t.nI1(8,"currency"),t.eux()(),t.rj2(9,"div",23)(10,"button",24),t.VwU("click",function(){const r=e.eBV(n).$implicit,c=t.XpG(2);return e.Njj(c.decrementarItem(r.idArticulo))}),t.EFF(11," - "),t.eux(),t.rj2(12,"span",25),t.EFF(13),t.eux(),t.rj2(14,"button",26),t.VwU("click",function(){const r=e.eBV(n).$implicit,c=t.XpG(2);return e.Njj(c.incrementarItem(r.idArticulo))}),t.EFF(15," + "),t.eux()(),t.rj2(16,"div",27)(17,"p"),t.EFF(18),t.nI1(19,"currency"),t.eux()()()}if(2&o){const n=a.$implicit;t.R7$(2),t.Avn("src",n.imagenUrl||"assets/placeholder.png",t.B4B)("alt",n.nombreArticulo),t.R7$(3),t.JRh(n.nombreArticulo),t.R7$(2),t.JRh(t.ii3(8,7,n.precioUnitario,"EUR","symbol","1.2-2")),t.R7$(3),t.Avn("disabled",n.cantidad<=1),t.R7$(3),t.JRh(n.cantidad),t.R7$(5),t.JRh(t.ii3(19,12,n.totalLinea,"EUR","symbol","1.2-2"))}}function b(o,a){1&o&&t.EFF(0," Iniciar sesi\xf3n para comprar ")}function v(o,a){1&o&&t.EFF(0," Proceder al pago ")}function x(o,a){if(1&o){const n=t.RV6();t.rj2(0,"div",8)(1,"div",11),t.Z7z(2,f,20,17,"div",12,M),t.eux(),t.rj2(4,"div",13)(5,"div",14)(6,"span"),t.EFF(7,"Subtotal:"),t.eux(),t.rj2(8,"span"),t.EFF(9),t.nI1(10,"currency"),t.eux()(),t.rj2(11,"div",15)(12,"span")(13,"strong"),t.EFF(14,"Total:"),t.eux()(),t.rj2(15,"span")(16,"strong"),t.EFF(17),t.nI1(18,"currency"),t.eux()()(),t.rj2(19,"div",16)(20,"button",17),t.VwU("click",function(){e.eBV(n);const r=t.XpG();return e.Njj(r.vaciarCarrito())}),t.EFF(21," Vaciar carrito "),t.eux(),t.rj2(22,"button",18),t.VwU("click",function(){e.eBV(n);const r=t.XpG();return e.Njj(r.irACheckout())}),t.nVh(23,b,1,0)(24,v,1,0),t.eux()()()()}if(2&o){const n=t.XpG();t.R7$(2),t.Dyx(null==n.carrito?null:n.carrito.items),t.R7$(7),t.JRh(t.ii3(10,3,null==n.carrito?null:n.carrito.subtotal,"EUR","symbol","1.2-2")),t.R7$(8),t.JRh(t.ii3(18,8,null==n.carrito?null:n.carrito.total,"EUR","symbol","1.2-2")),t.R7$(6),t.vxM(n.isUsuarioInvitado?23:24)}}let E=(()=>{class o{carritoService=(0,e.WQX)(m.a);articuloService=(0,e.WQX)(C.n);router=(0,e.WQX)(d.Ix);carrito=null;loading=!1;error=null;isUsuarioInvitado=!1;ngOnInit(){this.verificarTipoUsuario(),this.cargarCarrito()}verificarTipoUsuario(){const n=sessionStorage.getItem("authToken");this.isUsuarioInvitado=!n}cargarCarrito(){this.loading=!0,this.error=null,this.isUsuarioInvitado?this.cargarCarritoInvitado():this.carritoService.obtenerCarrito().subscribe({next:n=>{this.carrito=n,this.loading=!1},error:n=>{this.error="Error al cargar el carrito. Intenta nuevamente.",this.loading=!1,console.error(n)}})}cargarCarritoInvitado(){const n=this.carritoService.obtenerCarritoInvitado();if(0===n.length)return this.carrito=null,void(this.loading=!1);const i=n.map(r=>this.articuloService.getArticuloPorId(r.idArticulo));(0,u.p)(i).subscribe({next:r=>{this.carrito={id:0,items:n.map((c,g)=>({id:g,idArticulo:c.idArticulo,nombreArticulo:r[g].nombre,cantidad:c.cantidad,precioUnitario:r[g].precio,totalLinea:r[g].precio*c.cantidad,imagenUrl:r[g].imagenUrl})),subtotal:0,impuestos:0,gastosEnvio:0,total:0},this.carrito.subtotal=this.carrito.items.reduce((c,g)=>c+g.totalLinea,0),this.carrito.impuestos=.21*this.carrito.subtotal,this.carrito.gastosEnvio=this.carrito.subtotal>50?0:4.99,this.carrito.total=this.carrito.subtotal+this.carrito.impuestos+this.carrito.gastosEnvio,this.loading=!1},error:r=>{this.error="Error al cargar detalles del carrito.",this.loading=!1,console.error(r)}})}incrementarItem(n){if(this.isUsuarioInvitado){const i=this.carritoService.obtenerCarritoInvitado(),r=i.find(c=>c.idArticulo===n);r&&(r.cantidad++,localStorage.setItem("carritoInvitado",JSON.stringify(i)),this.cargarCarritoInvitado())}else this.carritoService.agregarItem(n,1).subscribe({next:i=>{this.carrito=i},error:i=>{this.error="Error al actualizar la cantidad.",console.error(i)}})}decrementarItem(n){this.isUsuarioInvitado?(this.carritoService.decrementarItemInvitado(n),this.cargarCarritoInvitado()):this.carritoService.decrementarItem(n).subscribe({next:i=>{this.carrito=i},error:i=>{this.error="Error al actualizar la cantidad.",console.error(i)}})}vaciarCarrito(){confirm("\xbfEst\xe1s seguro de que deseas vaciar el carrito?")&&(this.isUsuarioInvitado?(this.carritoService.vaciarCarritoInvitado(),this.carrito=null):this.carritoService.vaciarCarrito().subscribe({next:()=>{this.carrito=null},error:n=>{this.error="Error al vaciar el carrito.",console.error(n)}}))}irACheckout(){this.carrito&&this.carrito.items.length>0&&(this.isUsuarioInvitado?confirm("Debes iniciar sesi\xf3n para continuar con la compra. \xbfDeseas ir al login?")&&this.router.navigate(["/auth"]):this.router.navigate(["/app/checkout"]))}get totalItems(){return this.carrito?.items.reduce((n,i)=>n+i.cantidad,0)||0}get carritoVacio(){return!this.carrito||0===this.carrito.items.length}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=t.VBU({type:o,selectors:[["app-carrito-view"]],decls:12,vars:6,consts:[[1,"carrito-container"],[1,"carrito-header"],[1,"d-flex","align-items-center","gap-3"],[1,"item-count"],[1,"badge","bg-warning","text-dark"],[1,"loading"],[1,"error-message"],[1,"carrito-vacio"],[1,"carrito-content"],[3,"click"],["routerLink","/app/articulos",1,"btn-primary"],[1,"items-list"],[1,"carrito-item"],[1,"carrito-resumen"],[1,"resumen-linea"],[1,"resumen-linea","total"],[1,"carrito-acciones"],[1,"btn-vaciar",3,"click"],[1,"btn-checkout",3,"click"],[1,"item-image"],[3,"src","alt"],[1,"item-info"],[1,"precio-unitario"],[1,"item-cantidad"],[1,"btn-cantidad",3,"click","disabled"],[1,"cantidad"],[1,"btn-cantidad",3,"click"],[1,"item-subtotal"]],template:function(i,r){1&i&&(t.rj2(0,"div",0)(1,"div",1)(2,"h1"),t.EFF(3,"Mi Carrito"),t.eux(),t.rj2(4,"div",2)(5,"span",3),t.EFF(6),t.eux(),t.nVh(7,O,2,0,"span",4),t.eux()(),t.nVh(8,P,3,0,"div",5),t.nVh(9,p,5,1,"div",6),t.nVh(10,h,5,0,"div",7),t.nVh(11,x,25,13,"div",8),t.eux()),2&i&&(t.R7$(6),t.SpI("",r.totalItems," art\xedculos"),t.R7$(),t.vxM(r.isUsuarioInvitado?7:-1),t.R7$(),t.vxM(r.loading?8:-1),t.R7$(),t.vxM(r.error?9:-1),t.R7$(),t.vxM(r.loading||r.error||!r.carritoVacio?-1:10),t.R7$(),t.vxM(r.loading||r.error||r.carritoVacio?-1:11))},dependencies:[_.MD,_.oe],styles:[".carrito-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.carrito-container[_ngcontent-%COMP%]   .carrito-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;border-bottom:2px solid #e0e0e0;padding-bottom:1rem}.carrito-container[_ngcontent-%COMP%]   .carrito-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;color:#333}.carrito-container[_ngcontent-%COMP%]   .carrito-header[_ngcontent-%COMP%]   .item-count[_ngcontent-%COMP%]{color:#666;font-size:1rem}.carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]{text-align:center;padding:3rem}.carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;color:#666;margin-bottom:1rem}.carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background-color:#4caf50;color:#fff;border:none;border-radius:4px;cursor:pointer;text-decoration:none;display:inline-block}.carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover{background-color:#45a049}.carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{background-color:#ffebee;border-left:4px solid #f44336}.carrito-container[_ngcontent-%COMP%]   .carrito-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:2rem}@media (max-width: 768px){.carrito-container[_ngcontent-%COMP%]   .carrito-content[_ngcontent-%COMP%]{grid-template-columns:1fr}}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:100px 1fr auto auto;gap:1rem;align-items:center;padding:1.5rem;background-color:#f9f9f9;border-radius:8px;margin-bottom:1rem;box-shadow:0 2px 4px #0000001a}@media (max-width: 768px){.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]{grid-template-columns:80px 1fr}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-subtotal[_ngcontent-%COMP%]{grid-column:2}}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100px;object-fit:cover;border-radius:4px}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:.5rem;color:#333}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .precio-unitario[_ngcontent-%COMP%]{color:#4caf50;font-weight:700}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .btn-cantidad[_ngcontent-%COMP%]{width:32px;height:32px;border:1px solid #ddd;background-color:#fff;border-radius:4px;cursor:pointer;font-size:1.2rem;display:flex;align-items:center;justify-content:center}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .btn-cantidad[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f0f0f0}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .btn-cantidad[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .cantidad[_ngcontent-%COMP%]{font-weight:700;min-width:30px;text-align:center}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-subtotal[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#333}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:2rem;border-radius:8px;box-shadow:0 2px 4px #0000001a;height:fit-content}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .resumen-linea[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.75rem 0;border-bottom:1px solid #e0e0e0}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .resumen-linea.total[_ngcontent-%COMP%]{margin-top:1rem;padding-top:1rem;border-top:2px solid #333;border-bottom:none;font-size:1.2rem}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-top:2rem}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:1rem;border:none;border-radius:4px;cursor:pointer;font-size:1rem;font-weight:700;transition:background-color .3s}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button.btn-vaciar[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button.btn-vaciar[_ngcontent-%COMP%]:hover{background-color:#d32f2f}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button.btn-checkout[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button.btn-checkout[_ngcontent-%COMP%]:hover{background-color:#45a049}"]})}return o})()}}]);