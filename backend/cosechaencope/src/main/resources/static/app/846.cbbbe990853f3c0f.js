"use strict";(self.webpackChunkcosecha_en_cope=self.webpackChunkcosecha_en_cope||[]).push([[846],{1846:(R,_,l)=>{l.r(_),l.d(_,{CarritoViewComponent:()=>I});var c=l(2615),C=l(2200),u=l(6802),m=l(8132),p=l(6334),M=l(8605),t=l(3664);const O=(r,a)=>a.idArticulo;function P(r,a){1&r&&(t.j41(0,"span",4),t.EFF(1,"Usuario invitado"),t.k0s())}function b(r,a){1&r&&(t.j41(0,"div",5)(1,"p"),t.EFF(2,"Cargando carrito..."),t.k0s()())}function h(r,a){if(1&r){const n=t.RV6();t.j41(0,"div",6)(1,"p"),t.EFF(2),t.k0s(),t.j41(3,"button",9),t.bIt("click",function(){c.eBV(n);const o=t.XpG();return c.Njj(o.cargarCarrito())}),t.EFF(4,"Reintentar"),t.k0s()()}if(2&r){const n=t.XpG();t.R7$(2),t.JRh(n.error)}}function f(r,a){1&r&&(t.j41(0,"div",7)(1,"p"),t.EFF(2,"Tu carrito est\xe1 vac\xedo"),t.k0s(),t.j41(3,"a",10),t.EFF(4,"Ver productos"),t.k0s()())}function v(r,a){if(1&r&&(t.j41(0,"span",27),t.EFF(1),t.k0s()),2&r){const n=t.XpG().$implicit,i=t.XpG(2);t.R7$(),t.JRh(i.obtenerMensajeStock(n))}}function x(r,a){if(1&r){const n=t.RV6();t.j41(0,"div",12)(1,"div",19),t.nrm(2,"img",20),t.k0s(),t.j41(3,"div",21)(4,"h3"),t.EFF(5),t.k0s(),t.j41(6,"p",22),t.EFF(7),t.nI1(8,"currency"),t.k0s()(),t.j41(9,"div",23)(10,"button",24),t.bIt("click",function(){const o=c.eBV(n).$implicit,s=t.XpG(2);return c.Njj(s.decrementarItem(o.idArticulo))}),t.EFF(11," - "),t.k0s(),t.j41(12,"span",25),t.EFF(13),t.k0s(),t.j41(14,"button",26),t.bIt("click",function(){const o=c.eBV(n).$implicit,s=t.XpG(2);return c.Njj(s.incrementarItem(o.idArticulo))}),t.EFF(15," + "),t.k0s(),t.nVh(16,v,2,1,"span",27),t.k0s(),t.j41(17,"div",28)(18,"p"),t.EFF(19),t.nI1(20,"currency"),t.k0s()()()}if(2&r){const n=a.$implicit,i=t.XpG(2);t.R7$(2),t.Y8G("src",n.imagenUrl||"assets/placeholder.png",t.B4B)("alt",n.nombreArticulo),t.R7$(3),t.JRh(n.nombreArticulo),t.R7$(2),t.JRh(t.ii3(8,10,n.precioUnitario,"EUR","symbol","1.2-2")),t.R7$(3),t.Y8G("disabled",n.cantidad<=1),t.R7$(3),t.JRh(n.cantidad),t.R7$(),t.Y8G("disabled",!i.tieneStockDisponible(n))("title",i.tieneStockDisponible(n)?"Incrementar cantidad":"Stock m\xe1ximo alcanzado"),t.R7$(2),t.vxM(i.obtenerMensajeStock(n)?16:-1),t.R7$(3),t.JRh(t.ii3(20,15,n.totalLinea,"EUR","symbol","1.2-2"))}}function k(r,a){1&r&&t.EFF(0," Iniciar sesi\xf3n para comprar ")}function E(r,a){1&r&&t.EFF(0," Proceder al pago ")}function F(r,a){if(1&r){const n=t.RV6();t.j41(0,"div",8)(1,"div",11),t.Z7z(2,x,21,20,"div",12,O),t.k0s(),t.j41(4,"div",13)(5,"div",14)(6,"span"),t.EFF(7,"Subtotal:"),t.k0s(),t.j41(8,"span"),t.EFF(9),t.nI1(10,"currency"),t.k0s()(),t.j41(11,"div",14)(12,"span"),t.EFF(13,"IVA (21%):"),t.k0s(),t.j41(14,"span"),t.EFF(15),t.nI1(16,"currency"),t.k0s()(),t.j41(17,"div",14)(18,"span"),t.EFF(19,"Env\xedo:"),t.k0s(),t.j41(20,"span"),t.EFF(21),t.nI1(22,"currency"),t.k0s()(),t.j41(23,"div",15)(24,"span")(25,"strong"),t.EFF(26,"Total:"),t.k0s()(),t.j41(27,"span")(28,"strong"),t.EFF(29),t.nI1(30,"currency"),t.k0s()()(),t.j41(31,"div",16)(32,"button",17),t.bIt("click",function(){c.eBV(n);const o=t.XpG();return c.Njj(o.vaciarCarrito())}),t.EFF(33," Vaciar carrito "),t.k0s(),t.j41(34,"button",18),t.bIt("click",function(){c.eBV(n);const o=t.XpG();return c.Njj(o.irACheckout())}),t.nVh(35,k,1,0)(36,E,1,0),t.k0s()()()()}if(2&r){const n=t.XpG();t.R7$(2),t.Dyx(null==n.carrito?null:n.carrito.items),t.R7$(7),t.JRh(t.ii3(10,5,null==n.carrito?null:n.carrito.subtotal,"EUR","symbol","1.2-2")),t.R7$(6),t.JRh(t.ii3(16,10,null==n.carrito?null:n.carrito.impuestos,"EUR","symbol","1.2-2")),t.R7$(6),t.JRh(t.ii3(22,15,null==n.carrito?null:n.carrito.gastosEnvio,"EUR","symbol","1.2-2")),t.R7$(8),t.JRh(t.ii3(30,20,null==n.carrito?null:n.carrito.total,"EUR","symbol","1.2-2")),t.R7$(6),t.vxM(n.isUsuarioInvitado?35:36)}}let I=(()=>{class r{carritoService=(0,c.WQX)(p.a);articuloService=(0,c.WQX)(M.n);router=(0,c.WQX)(u.Ix);carrito=null;loading=!1;error=null;isUsuarioInvitado=!1;ngOnInit(){this.verificarTipoUsuario(),this.cargarCarrito()}verificarTipoUsuario(){const n=sessionStorage.getItem("authToken");this.isUsuarioInvitado=!n}cargarCarrito(){this.loading=!0,this.error=null,this.isUsuarioInvitado?this.cargarCarritoInvitado():this.carritoService.obtenerCarrito().subscribe({next:n=>{this.carrito=n,this.loading=!1},error:n=>{this.error="Error al cargar el carrito. Intenta nuevamente.",this.loading=!1,console.error(n)}})}cargarCarritoInvitado(){const n=this.carritoService.obtenerCarritoInvitado();if(0===n.length)return this.carrito=null,void(this.loading=!1);const i=n.map(o=>o.idArticulo);this.articuloService.getArticulosPorIds(i).subscribe({next:o=>{const s=new Map(o.map(e=>[e.idArticulo,e]));this.carrito={id:0,items:n.map((e,d)=>{const g=s.get(e.idArticulo);return g?{id:d,idArticulo:e.idArticulo,nombreArticulo:g.nombre,cantidad:e.cantidad,precioUnitario:g.precio,totalLinea:g.precio*e.cantidad,imagenUrl:g.imagenUrl,stockDisponible:g.stock}:(console.warn(`Art\xedculo ${e.idArticulo} no encontrado`),null)}).filter(e=>null!==e),subtotal:0,impuestos:0,gastosEnvio:0,total:0},this.carrito.subtotal=this.carrito.items.reduce((e,d)=>e+d.totalLinea,0),this.carrito.impuestos=.21*this.carrito.subtotal,this.carrito.gastosEnvio=this.carrito.subtotal>50?0:4.99,this.carrito.total=this.carrito.subtotal+this.carrito.impuestos+this.carrito.gastosEnvio,this.loading=!1},error:o=>{this.error="Error al cargar detalles del carrito.",this.loading=!1,console.error("Error cargando carrito invitado:",o)}})}incrementarItem(n){const i=this.carrito?.items.find(o=>o.idArticulo===n);if(i&&!this.tieneStockDisponible(i))return this.error=`No puedes agregar m\xe1s unidades. Stock m\xe1ximo: ${i.stockDisponible}`,void setTimeout(()=>this.error=null,3e3);if(this.isUsuarioInvitado){const o=this.carritoService.obtenerCarritoInvitado(),s=o.find(e=>e.idArticulo===n);s&&(s.cantidad++,localStorage.setItem("carritoInvitado",JSON.stringify(o)),this.cargarCarritoInvitado())}else this.carritoService.agregarItem(n,1).subscribe({next:o=>{this.carrito=o,this.error=null},error:o=>{this.error=o.error||"Error al actualizar la cantidad.",console.error("Error al incrementar item:",o),this.cargarCarrito()}})}decrementarItem(n){this.isUsuarioInvitado?(this.carritoService.decrementarItemInvitado(n),this.cargarCarritoInvitado()):this.carritoService.decrementarItem(n).subscribe({next:i=>{this.carrito=i},error:i=>{this.error="Error al actualizar la cantidad.",console.error(i)}})}vaciarCarrito(){confirm("\xbfEst\xe1s seguro de que deseas vaciar el carrito?")&&(this.isUsuarioInvitado?(this.carritoService.vaciarCarritoInvitado(),this.carrito=null):this.carritoService.vaciarCarrito().subscribe({next:()=>{this.carrito=null},error:n=>{this.error="Error al vaciar el carrito.",console.error(n)}}))}irACheckout(){this.carrito&&this.carrito.items.length>0&&(this.isUsuarioInvitado?confirm("Debes iniciar sesi\xf3n para continuar con la compra. \xbfDeseas ir al login?")&&this.router.navigate(["/auth"]):this.router.navigate(["/checkout"]))}get totalItems(){return this.carrito?.items.reduce((n,i)=>n+i.cantidad,0)||0}get carritoVacio(){return!this.carrito||0===this.carrito.items.length}tieneStockDisponible(n){return!n.stockDisponible||n.cantidad<n.stockDisponible}obtenerMensajeStock(n){return n.stockDisponible&&n.cantidad>=n.stockDisponible?"Stock insuficiente":null}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=t.VBU({type:r,selectors:[["app-carrito-view"]],decls:12,vars:6,consts:[[1,"carrito-container"],[1,"carrito-header"],[1,"d-flex","align-items-center","gap-3"],[1,"item-count"],[1,"badge","bg-warning","text-dark"],[1,"loading"],[1,"error-message"],[1,"carrito-vacio"],[1,"carrito-content"],[3,"click"],["routerLink","/articulos",1,"btn-articulos"],[1,"items-list"],[1,"carrito-item"],[1,"carrito-resumen"],[1,"resumen-linea"],[1,"resumen-linea","total"],[1,"carrito-acciones"],[1,"btn-vaciar",3,"click"],[1,"btn-checkout",3,"click"],[1,"item-image"],[3,"src","alt"],[1,"item-info"],[1,"precio-unitario"],[1,"item-cantidad"],[1,"btn-cantidad",3,"click","disabled"],[1,"cantidad"],[1,"btn-cantidad",3,"click","disabled","title"],[1,"stock-error"],[1,"item-subtotal"]],template:function(i,o){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"h1"),t.EFF(3,"Mi Carrito"),t.k0s(),t.j41(4,"div",2)(5,"span",3),t.EFF(6),t.k0s(),t.nVh(7,P,2,0,"span",4),t.k0s()(),t.nVh(8,b,3,0,"div",5),t.nVh(9,h,5,1,"div",6),t.nVh(10,f,5,0,"div",7),t.nVh(11,F,37,25,"div",8),t.k0s()),2&i&&(t.R7$(6),t.SpI("",o.totalItems," art\xedculos"),t.R7$(),t.vxM(o.isUsuarioInvitado?7:-1),t.R7$(),t.vxM(o.loading?8:-1),t.R7$(),t.vxM(o.error?9:-1),t.R7$(),t.vxM(o.loading||o.error||!o.carritoVacio?-1:10),t.R7$(),t.vxM(o.loading||o.error||o.carritoVacio?-1:11))},dependencies:[C.MD,m.Wk,C.oe],styles:['@charset "UTF-8";.carrito-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:32px}.carrito-container[_ngcontent-%COMP%]   .carrito-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;border-bottom:2px solid rgba(34,34,34,.12);padding-bottom:16px}.carrito-container[_ngcontent-%COMP%]   .carrito-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.875rem;color:#222}.carrito-container[_ngcontent-%COMP%]   .carrito-header[_ngcontent-%COMP%]   .item-count[_ngcontent-%COMP%]{color:#222222b3;font-size:1rem}.carrito-container[_ngcontent-%COMP%]   .btn-articulos[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:8px 24px;background:#574b51;color:#fff;font-weight:600;border-radius:8px;text-decoration:none;transition:all .25s ease-in-out}.carrito-container[_ngcontent-%COMP%]   .btn-articulos[_ngcontent-%COMP%]:hover{background:#3c3338;transform:translateY(-1px)}.carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]{text-align:center;padding:64px}.carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem;color:#222222b3;margin-bottom:16px}.carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{padding:8px 24px;background-color:#574b51;color:#fff;border:none;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-block;transition:all .25s ease-in-out}.carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .carrito-container[_ngcontent-%COMP%]   .carrito-vacio[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover{background-color:#3c3338}.carrito-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{background-color:#d32f2f1a;border-left:4px solid #D32F2F;border-radius:8px}.carrito-container[_ngcontent-%COMP%]   .carrito-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:32px}@media (max-width: 768px){.carrito-container[_ngcontent-%COMP%]   .carrito-content[_ngcontent-%COMP%]{grid-template-columns:1fr}}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:100px 1fr auto auto;gap:16px;align-items:center;padding:24px;background-color:#f5f5f5;border-radius:8px;margin-bottom:16px;border:1px solid rgba(34,34,34,.12);transition:box-shadow .25s ease-in-out}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]:hover{box-shadow:0 1px 2px #0000000d}@media (max-width: 768px){.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]{grid-template-columns:80px 1fr}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%], .carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-subtotal[_ngcontent-%COMP%]{grid-column:2}}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100px;object-fit:cover;border-radius:4px}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;margin-bottom:8px;color:#222}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-info[_ngcontent-%COMP%]   .precio-unitario[_ngcontent-%COMP%]{color:#574b51;font-weight:700}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap;position:relative}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .btn-cantidad[_ngcontent-%COMP%]{width:32px;height:32px;border:1px solid rgba(34,34,34,.12);background-color:#fff;border-radius:4px;cursor:pointer;font-size:1.125rem;display:flex;align-items:center;justify-content:center;transition:all .15s ease-in-out}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .btn-cantidad[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f5f5f5;border-color:#574b51}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .btn-cantidad[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;background-color:#f5f5f5}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .cantidad[_ngcontent-%COMP%]{font-weight:700;min-width:30px;text-align:center}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-cantidad[_ngcontent-%COMP%]   .stock-error[_ngcontent-%COMP%]{width:100%;font-size:.75rem;color:#d32f2f;font-weight:500;margin-top:4px;display:block}.carrito-container[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   .carrito-item[_ngcontent-%COMP%]   .item-subtotal[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#222}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:32px;border-radius:8px;border:1px solid rgba(34,34,34,.12);height:fit-content}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .resumen-linea[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(34,34,34,.12)}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .resumen-linea.total[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:2px solid #222222;border-bottom:none;font-size:1.25rem}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-top:32px}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:16px;border:none;border-radius:8px;cursor:pointer;font-size:1rem;font-weight:700;transition:all .25s ease-in-out}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button.btn-vaciar[_ngcontent-%COMP%]{background-color:#d32f2f;color:#fff}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button.btn-vaciar[_ngcontent-%COMP%]:hover{background-color:#ab2424}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button.btn-checkout[_ngcontent-%COMP%]{background-color:#2e7d32;color:#fff}.carrito-container[_ngcontent-%COMP%]   .carrito-resumen[_ngcontent-%COMP%]   .carrito-acciones[_ngcontent-%COMP%]   button.btn-checkout[_ngcontent-%COMP%]:hover{background-color:#205823}']})}return r})()}}]);